<!DOCTYPE html>
<html lang="pt-BR">
<head>
<meta charset="UTF-8">
<title>Haikyu Fly High - Team Builder by Devoy Aces</title>
<style>
    #menuBtn {
    width: 60px;
    height: 60px;
    font-size: 2.5em;
    padding: 0;
    border-radius: 10px;
    display: flex;
    align-items: center;
    justify-content: center;
    background-color: #28a745;
    color: white;
    border: none;
    cursor: pointer;
    z-index: 1000;
    position: fixed;
    top: 15px;
    left: 15px;
}

#menuBtn:hover {
    background-color: #218838;
}
    #rotateBtn,
    #saveTeamBtn,
    #clearTeamBtn {
        font-size: 2em;
        padding: 20px 38px;
        min-width: 180px;
        border-radius: 8px;
    }
    body {
        background-color: #222;
        color: #fff;
        font-family: Arial, sans-serif;
        text-align: center;
    }

    h1 {
        margin-top: 20px;
    }

    .team-grid {
        display: flex;
        flex-direction: column;
        gap: 20px;
        align-items: center;
        margin-top: 30px;
    }

    .row {
        display: flex;
        gap: 20px;
    }

    .top-row {
        transform: translateX(6px);
    }

    .player-slot {
        display: flex;
        flex-direction: column;
        align-items: center;
    }

    .hex {
        position: relative;
        width: 150px;
        height: 210px;
        background-color: #444;
        border-radius: 10px;
        display: flex;
        align-items: center;
        justify-content: center;
        cursor: pointer;
        transition: background 0.3s;
        overflow: hidden;
    }

    .hex:hover {
        background-color: #555;
    }

    .hex img {
        width: 100%;
        height: 100%;
object-fit: Save;
    }

    .player-info {
        margin-top: 5px;
        font-size: 14px;
        color: #fff;
        text-align: center;
        max-width: 150px;
        word-wrap: break-word;
    }

    .bench-slot {
        width: 50px;
        height: 67px;
        background-color: #444;
        border-radius: 5px;
        display: flex;
        align-items: center;
        justify-content: center;
        cursor: pointer;
        overflow: hidden;
    }

    .bench-slot img {
        width: 100%;
        height: 100%;
         object-fit: Save;
    }

    .add-slot-btn {
        background-color: #28a745;
        border: none;
        color: white;
        padding: 5px 10px;
        margin-left: 10px;
        cursor: pointer;
        border-radius: 5px;
    }

    .add-slot-btn:hover {
        background-color: #218838;
    }
.bench-quick{
  display:flex; gap:6px; margin:0 10px;
}
.bench-quick-btn{
  background:#222; color:#fff; border:1px solid #555;
  border-radius:6px; padding:4px 6px; font-size:12px; cursor:pointer;
}
.bench-quick-btn:hover{ background:#333; }
    #saveTeamBtn {
        background-color: #28a745;
        border: none;
        color: white;
        padding: 6px 10px;
        margin-right: 10px;
        cursor: pointer;
        border-radius: 5px;
        font-size: 16px;
        vertical-align: middle;
    }

    #saveTeamBtn:hover {
        background-color: #218838;
    } 



    #synergy-panel {
        margin-top: 50px;
        background-color: #333;
        padding: 15px;
        border-radius: 10px;
        max-width: 600px;
        margin-left: auto;
        margin-right: auto;
        text-align: left;
    }

    .scroll-menu {
        display: none;
        margin-top: 10px;
        max-height: 200px;
        overflow-y: auto;
        background-color: #333;
        padding: 10px;
        border-radius: 8px;
        flex-wrap: wrap;
    }

    .scroll-menu img {
        width: 80px;
        height: auto;
        cursor: grab;
        margin: 5px;
        border: 2px solid transparent;
    }

    .scroll-menu img:hover {
        border: 2px solid yellow;
    }

    /* Painel lateral */
    .sidebar {
        position: fixed;
        top: 0;
        left: 0;
        width: 300px;
        height: 100%;
        background-color: #333;
        overflow-x: hidden;
        transition: transform 0.3s ease, opacity 0.3s ease;
        transform: translateX(-100%);
        padding: 20px;
        box-shadow: 2px 0 5px rgba(0,0,0,0.5);
        z-index: 999;
        opacity: 0;
        pointer-events: none;
        display: flex;
        flex-direction: column;
    }

    .sidebar.open {
        transform: translateX(0);
        opacity: 1;
        pointer-events: auto;
    }

    .sidebar h2 {
        color: #fff;
        margin-bottom: 20px;
    }

    .sidebar button.close-btn {
        background: none;
        border: none;
        color: #fff;
        font-size: 20px;
        cursor: pointer;
        position: absolute;
        top: 15px;
        right: 15px;
    }

    #menuBtn {
        position: fixed;
        top: 15px;
        left: 15px;
        background-color: #28a745;
        color: white;
        border: none;
        padding: 10px 15px;
        font-size: 18px;
        cursor: pointer;
        border-radius: 5px;
        z-index: 1000;
    }

    #menuBtn:hover {
        background-color: #218838;
    }
    /* Aumenta o botão no mobile / telas touch */
@media (max-width: 768px), (pointer: coarse) {
  #menuBtn {
    /* alvo de toque grande (recomendado 48–64px) */
    width: 64px;
    height: 64px;

    /* centraliza o ícone ☰ dentro do quadrado */
    display: inline-flex;
    align-items: center;
    justify-content: center;

    /* o ícone fica maior */
    font-size: 32px;

    /* remove o padding para não “esticar” além do width/height */
    padding: 0;

    /* arredondamento um pouco maior (opcional) */
    border-radius: 12px;
  }
}

    /* Lista de characters no menu */
    .char-list {
        display: flex;
        flex-wrap: wrap;
        gap: 10px;
    }

    .char-card {
        width: 80px;
        text-align: center;
        cursor: pointer;
    }

    .char-card img {
        width: 100%;
        border-radius: 5px;
    }

    /* Conteúdo do menu com rolagem */
    #sidebar {
    scroll-behavior: smooth;    
    position: fixed;
    right: 0;
    top: 0;
    width: 300px; /* ajuste conforme seu layout */
    height: 100vh; /* ocupa a tela inteira */
    background-color: #222;
    color: white;
    overflow-y: auto; /* ativa rolagem vertical */
    padding: 10px;
    box-sizing: border-box;


    /* Oculta a barra no Chrome, Edge, Safari */
    scrollbar-width: none; /* Firefox */
    -ms-overflow-style: none; /* IE e Edge antigos */
}
    #sidebar::-webkit-scrollbar {
    display: none; /* Chrome, Safari, Edge */
}

    .filtros {
        display: flex;
        flex-direction: column;
        gap: 8px;
        margin-bottom: 10px;
    }

    .filtros label {
        font-size: 14px;
        font-weight: bold;
        margin-bottom: 3px;
        display:block;
        text-align:left;
    }

    .filtros select {
        width: 100%;
        padding: 5px;
        font-size: 14px;
        border-radius: 5px;
        border: none;
    }

    #limparFiltros {
        background-color: #ff4d4d;
        color: white;
        border: none;
        padding: 6px;
        font-size: 14px;
        border-radius: 5px;
        cursor: pointer;
        width:100%;
    }

    #limparFiltros:hover {
        background-color: #e60000;
    }

    .saved-list button {
        margin-left: 8px;
        padding: 4px 8px;
        font-size: 13px;
        border-radius: 4px;
        cursor: pointer;
        border: none;
    }
    .saved-list .load-btn { background:#28a745; color:#fff; }
    .saved-list .del-btn { background:#ff4d4d; color:#fff; }

    .bond-btn {
    background-color: #444;
    color: white;
    border: 1px solid #666;
    border-radius: 6px;
    padding: 4px 8px;
    font-size: 14px;
    cursor: pointer;
    transition: background-color 0.2s, transform 0.2s;
}

.bond-btn:hover {
    background-color: #666;
    transform: scale(1.05);
}

.bond-btn:active {
    background-color: #888;
    transform: scale(0.98);
}
    .skill-btn {
    background-color: #555;
    color: white;
    border: 1px solid #777;
    border-radius: 6px;
    padding: 4px 8px;
    font-size: 14px;
    cursor: pointer;
    transition: background-color 0.2s, transform 0.2s;
}

.skill-btn:hover {
    background-color: #777;
    transform: scale(1.05);
}

.skill-btn:active {
    background-color: #999;
    transform: scale(0.98);
}
    .char-info {
    text-align: center;
    margin-top: 4px;
}

.char-name {
    font-weight: bold;
    font-size: 14px;
    color: #fff;
    margin: 0;
}

.char-Stats {
    font-size: 12px;
    color: #ccc;
    margin: 0;
}

.char-Stats span {
    font-weight: bold;
    color: #ffcc00; /* cor destaque do valor */
}
    #scrollMenu {
    scrollbar-width: none; /* Firefox */
    -ms-overflow-style: none; /* IE e Edge antigos */
}

#scrollMenu::-webkit-scrollbar {
    display: none; /* Chrome, Safari, Edge */
}
    #scrollMenu {
    overflow-y: auto; /* já está, mas reforçando */
}
   /* header de filtros dentro do scrollMenu (bench) */
#scrollMenu .bench-quick-inside{
  display:flex; gap:6px; padding:6px 6px 8px; flex-wrap:wrap;
}
#scrollMenu .bench-quick-inside button{
  background:#222; color:#fff; border:1px solid #555;
  border-radius:6px; padding:4px 6px; font-size:12px; cursor:pointer;
}
#scrollMenu .bench-quick-inside button.active{ outline:2px solid #999; }
    
#sidebar-content ul {
    list-style: none;       /* remove bullets */
    padding-left: 0;        /* remove recuo padrão */
    margin-left: 0;         /* evita deslocamento */
    text-align: center;     /* centraliza texto */
}

#sidebar-content li {
    margin-bottom: 4px;     /* espaço entre linhas */
}
    .filtros {
    background-color: #333;
    padding: 12px;
    border-radius: 8px;
    display: flex;
    flex-direction: column;
    gap: 12px;
}

.filtros label {
    font-size: 13px;
    font-weight: bold;
    margin-bottom: 4px;
}

.filtros select {
    width: 100%;
    padding: 6px;
    border: 1px solid #555;
    border-radius: 6px;
    background-color: #222;
    color: white;
}

#limparFiltros {
    background-color: #ff4d4d;
    border: none;
    padding: 8px;
    border-radius: 6px;
    font-weight: bold;
    cursor: pointer;
}

#limparFiltros:hover {
    background-color: #e60000;
}
    /* Remove bolinhas e aplica espaçamento no Side Menu */
#sidebar-content ul,
#sidebar-content li {
    list-style: none !important;  /* força remover bullets */
    padding-left: 0 !important;
    margin-left: 0 !important;
}

#sidebar-content ul {
    display: flex;
    flex-direction: column;
    gap: 10px; /* mesmo espaçamento da aba Info */
}
    .sidebar > ul {
    list-style: none;      /* remove bullets */
    padding: 0;            /* elimina recuo padrão */
    margin: 0 0 16px 0;    /* margem inferior opcional */
    display: flex;         /* empilha verticalmente */
    flex-direction: column;
    gap: 10px;             /* espaçamento entre os itens */
}

.sidebar > ul > li {
    margin: 0;             /* garante que não tenha margens extras */
}
    .person-symbols {
    display: flex;
    justify-content: center;
    gap: 6px;
    margin-top: 6px;
}

.symbol-icon {
    width: 40px;
    height: 40px;
    object-fit: contain;
}
    .card-sub{
  font-size: 12px;
  opacity: 0.85;
  margin-top: 2px;
}

/* === LISTA NO Side Menu === */
#charList{
  display: grid;
  grid-template-columns: repeat(2, minmax(50px, 1fr)); /* 2 colunas no menu */
  gap: 10px;
  padding: 0;
  margin: 0;
  list-style: none;
}
/* nova classe para esconder */
#charList.is-hidden { display: none !important; }

/* escalar a imagem ao tamanho da coluna */
#charList .person-card img{
  width: 100%;
  height: auto;          /* mantém proporção */
  display: block;
  border-radius: 8px;
}

/* texto */
#charList .card-name{ margin-top:6px; font-weight:600; text-align:center; }
#charList .card-sub{  font-size:12px; opacity:.85; margin-top:2px; text-align:center; }

/* quando houver mais espaço, aumente o nº de colunas */
@media (min-width: 420px){
  #charList{ grid-template-columns: repeat(3, minmax(50px, 1fr)); }
}
@media (min-width: 560px){
  #charList{ grid-template-columns: repeat(4, minmax(50px, 1fr)); }
}
    #bench-row-wrapper{
  display: flex;
  flex-direction: column;   /* empilha título, slots e toolbar */
  gap: 8px;
}
#bench-row{ order: 1; }
#bench-toolbar{
  order: 2;
  display: flex;
  gap: 10px;
  justify-content: flex-end; /* ou center/space-between */
  margin-top: 45px;
}
/* === ITEMS (Memory + Potential Sets) === */
.item-badge {
  position:absolute; bottom:4px; right:6px;
  background:#111; border:1px solid #666; color:#fff;
  font-size:11px; padding:2px 6px; border-radius:6px; opacity:.9;
  max-width: 90%; overflow: hidden; white-space: nowrap; text-overflow: ellipsis;
}
.item-modal-backdrop{
  position:fixed; inset:0; background:rgba(0,0,0,.6);
  display:flex; align-items:center; justify-content:center; z-index:5000;
}
.item-modal{
  background:#2b2b2b; color:#fff; width:min(640px,92vw);
  border-radius:12px; padding:14px; box-shadow:0 12px 32px rgba(0,0,0,.5);
}
.item-row{ display:grid; grid-template-columns: 140px 1fr; gap:10px; align-items:center; margin:10px 0; }
.item-modal select{
  width:100%; background:#1f1f1f; color:#fff; border:1px solid #555; border-radius:8px; padding:8px;
}
.item-actions{ display:flex; gap:8px; justify-content:flex-end; margin-top:12px; }
.item-btn{
  background:#444; border:1px solid #666; color:#fff;
  padding:8px 10px; border-radius:8px; cursor:pointer;
}
.item-btn:hover{ background:#555; }
.item-stats{
  background:#1e1e1e; border:1px solid #444; border-radius:10px; padding:8px; font-size:13px;
}
.item-stats code{ font-family: ui-monospace, Menlo, Consolas, monospace; }
.item-desc{ opacity:.85; font-size:12px; margin-top:6px; line-height:1.35; }
.hex, .bench-slot { position: relative; } /* ancora do badge/engrenagem */
.item-gear{
  position:absolute; top:4px; right:4px; z-index:5;
  width:22px; height:22px; display:flex; align-items:center; justify-content:center;
  border-radius:999px; background:rgba(20,20,20,.85); border:1px solid #666;
  font-size:14px; cursor:pointer; color:#fff;
}
.item-gear:hover{ background:rgba(40,40,40,.95); }
.item-badge img { width:14px; height:14px; vertical-align:-2px; margin-right:4px; border-radius:3px; }
.item-choice img {
  width:28px; height:28px; border-radius:6px; object-fit:cover;
}
.item-choice.empty { opacity:.6; }
/* Linha no formato: [label] [IMG] [select]  */
.item-row-inline{
  display: grid;
  grid-template-columns: 140px 52px 1fr; /* label | img | select */
  gap: 10px;
  align-items: center;
  margin: 10px 0;
}

/* thumb quadrada */
.item-thumb{
  width: 48px; height: 48px;
  border-radius: 8px;
  background: #2a2a2a;
  object-fit: cover;
  box-shadow: inset 0 0 0 1px #444;
}

/* select estilo “pill” (opcional) */
.item-select{
  width: 100%;
  background:#1f1f1f; color:#fff;
  border:1px solid #555; border-radius:999px;
  padding: 8px 12px;
}

/* descrição fica alinhada sob IMG+select (colunas 2..3) */
.item-subdesc{
  grid-column: 2 / span 2;
  font-size: 12px; opacity: .85; margin-top: 6px;
}
/* --- mais espaço no modal de Items --- */
.item-row-inline{
  display: grid;
  grid-template-columns: 170px 56px 1fr; /* label | IMG | select  (era 140px 52px 1fr) */
  column-gap: 16px;                      /* era 10px */
  row-gap: 8px;
  align-items: start;                    /* evita que label fique baixo */
  margin: 14px 0;                        /* era 10px */
}

/* o texto do rótulo alinhado ao topo da linha (Memory / Potential...) */
.item-row-inline > div:first-child{
  align-self: start;
  padding-top: 4px;
}

/* a miniatura um pouco maior */
.item-thumb{
  width: 150px; height: 150px;             /* se quiser mais: 56x56 */
  border-radius: 8px;
  background: #2a2a2a;
  object-fit: cover;
  box-shadow: inset 0 0 0 1px #444;
}

/* select mais “fofo” e com respiro */
.item-select{
  width: 100%;
  background:#1f1f1f; color:#fff;
  border:1px solid #555; border-radius:999px;
  padding: 10px 14px;                    /* era 8px 12px */
}

/* descrição com mais espaço e alinhada sob IMG+select */
.item-subdesc{
  grid-column: 2 / span 2;               /* ocupa coluna da IMG + select */
  margin-top: 8px;                        /* era 6px */
  font-size: 12px; opacity: .85;
}

/* dá um espaço extra entre os blocos */
.item-modal .item-row-inline + .item-row-inline{
  margin-top: 120px;
}
/* === Grid de 2 colunas no modal === */
.item-modal .items-grid{
  display:grid;
  grid-template-columns: 1fr 1fr;           /* coluna esquerda | direita */
  column-gap: 28px;                          /* espaço entre colunas */
  row-gap: 18px;
  align-items:start;
  margin-top: 6px;
}

/* coluna direita ganha um divisor sutil à esquerda */
.item-modal .items-col + .items-col{ position:relative; }
.item-modal .items-col + .items-col::before{
  content:"";
  position:absolute; left:-14px; top:0; bottom:0; width:1px;
  background: rgba(255,255,255,.08);
}

/* linhas internas no formato: label | IMG | select */
.item-row-inline{
  display:grid;
  grid-template-columns: 150px 56px 1fr;     /* label | img | select */
  column-gap: 16px; row-gap: 8px;
  align-items:center;
  margin: 6px 0;
}
.item-row-inline > div:first-child{          /* o rótulo (Memory / Potential...) */
  align-self:start; padding-top: 6px;
}
.item-thumb{
  width: 75px; height: 75px; border-radius: 10px;
  background:#2a2a2a; object-fit:cover;
  box-shadow: inset 0 0 0 1px #444;
}
.item-select{
  width:100%; background:#1f1f1f; color:#fff;
  border:1px solid #555; border-radius:999px;
  padding:10px 14px;
}
.item-subdesc{
  grid-column: 2 / span 2;                   /* fica alinhado sob IMG+select */
  font-size:12px; opacity:.85; margin-top:8px;
}

/* linha “Stats preview” continua em 2 colunas padrão (label | conteúdo) */
.item-row{
  display:grid; grid-template-columns: 150px 1fr;
  column-gap: 16px; align-items:start; margin: 6px 0;
}
/* --- Badge só com ícones --- */
/* === Badge com ícones que se ajustam ao tamanho === */
.item-badge{
  --icon: 37px;                 /* ajuste aqui o tamanho do ícone (18–28px) */
  display:flex; gap:6px; align-items:center;
  position:absolute; bottom:4px; right:6px;
  background:rgba(0,0,0,.60);
  border:1px solid rgba(255,255,255,.25);
  border-radius:8px; padding:3px 6px; z-index:4;
}

/* cada “slot” de ícone */
.item-badge .ico{
  position:relative;
  width:var(--icon); height:var(--icon);
  border-radius:4px; overflow:hidden;
  box-shadow: inset 0 0 0 1px rgba(255,255,255,.35);
  background:#222;
}

/* a imagem cobre 100% do slot, sem distorcer */
.item-badge .ico img{
  position:absolute; inset:0;
  width:100% !important;
  height:100% !important;
  object-fit:cover;
  display:block;
}

/* etiqueta “M/4/2” (opcional) escala com o tamanho do ícone */
.item-badge .tag{
  position:absolute; right:-2px; bottom:-2px;
  padding:0 2px;
  font-size:calc(var(--icon) * 0.42);
  line-height:1.05;
  background:rgba(0,0,0,.85); color:#fff;
  border:1px solid rgba(255,255,255,.35); border-radius:3px;
}
/* --- Layout 3 colunas: label | IMG | select --- */
.items-3col{ display:grid; row-gap:18px; }

.row-3col{
  display:grid;
  grid-template-columns: 120px 120px 1fr; /* label | img | select */
  column-gap:18px; align-items:center;
}

.row-3col .label{ align-self:center; padding-top:4px; }

.big-thumb{
  width:120px; height:80px;           /* ajuste como preferir */
  border-radius:10px;
  background:#2a2a2a;
  box-shadow:inset 0 0 0 1px #444;
  object-fit:cover;
}

.select-wide{
  width:100%; background:#1f1f1f; color:#fff;
  border:1px solid #555; border-radius:10px;
  padding:10px 12px;
}

.subdesc{ font-size:12px; opacity:.85; margin-top:8px; }

/* Stats em lista vertical */
.stats-list{ list-style:none; margin:0; padding:0; }
.stats-list li{
  margin:6px 0;
  font-family:ui-monospace, Menlo, Consolas, monospace;
  background:#1e1e1e; border:1px solid #444; border-radius:10px;
  padding:6px 10px;
}
.stats-list li b{ margin-right:6px; }
.hex.drop-ok, .bench-slot.drop-ok { outline: 2px dashed #9cf; }
.hex.drop-bad, .bench-slot.drop-bad { outline: 2px dashed #f66; }
</style>
</head>
<body>

<button id="menuBtn">☰</button>
<div class="sidebar" id="sidebar">
    <button class="close-btn" id="closeSidebar">×</button>
    <h2>Side Menu</h2>
    <ul>
        <!-- substituí EStatísticas por Save/Load -->
        <li><button class="menu-link bond-btn" data-section="save">💾 Save & Load Teams</button></li>
        <li><button class="menu-link bond-btn" data-section="characters">🔍 Characters</button></li>
        <li><button class="menu-link bond-btn" data-section="schools">🏫 Schools</button></li>
        <li><button class="menu-link bond-btn" data-section="help">ℹ️ Info</button></li>
    </ul>
    <div id="sidebar-content">
        <p>Select an option above.</p>
    </div>
</div>

<h1>Haikyu Fly High - Team Builder by Devoy Aces</h1>

<div class="team-grid">
    <div class="row top-row">
        <div class="player-slot"><div class="hex" data-role="S"></div><div class="player-info">S</div></div>
        <div class="player-slot"><div class="hex" data-role="MB"></div><div class="player-info">MB</div></div>
        <div class="player-slot"><div class="hex" data-role="WS"></div><div class="player-info">WS</div></div>
    </div>
    <div class="row">
        <div class="player-slot"><div class="hex" data-role="L"></div><div class="player-info">L</div></div>
        <div class="player-slot"><div class="hex" data-role="WS"></div><div class="player-info">WS</div></div>
        <div class="player-slot"><div class="hex" data-role="MB"></div><div class="player-info">MB</div></div>
        <div class="player-slot"><div class="hex" data-role="OP"></div><div class="player-info">OP</div></div>
    </div>

    <!-- linha onde fica o botão SALVAR e os bench slots -->
    <div class="row" id="bench-row-wrapper" style="align-items:center;">

        <div class="row" id="bench-row" style="gap:10px;">
            <div class="player-slot bench"><div class="bench-slot" data-role="bench"></div><div class="player-info">Bench</div></div>
            <div class="player-slot bench"><div class="bench-slot" data-role="bench"></div><div class="player-info">Bench</div></div>
            <div class="player-slot bench"><div class="bench-slot" data-role="bench"></div><div class="player-info">Bench</div></div>
            <button class="add-slot-btn" onclick="addBenchSlot()">+</button>
        </div>
         <div id="bench-toolbar" style="display:flex; align-items:center; gap:10px; margin-top:8px;">
    <button id="rotateBtn" title="Rotate clockwise" style="background-color:#222222;color:white;padding:6px 10px; border:none; border-radius:5px; font-size:16px; cursor:pointer;margin-right:8px;">↻</button>
    <button id="saveTeamBtn" title="Save Team" style="background-color:#222222;margin-right:8px;">⬇️</button>
    <button id="clearTeamBtn" title="Clear Team" style="background-color:#222222; color:white; padding:6px 10px; border:none; border-radius:5px; font-size:16px; cursor:pointer;margin-right:55px;">🗑️</button>
    <button id="recommendBtn" title="Recommend based on highest synergies possible"style="background-color:#222222; color:white; padding:6px 10px; border:none; border-radius:5px; font-size:16px; cursor:pointer;margin-right:55px;">⭐</button>
</div>
    </div>
</div>

<div class="scroll-menu" id="scrollMenu"></div>

<div id="synergy-panel">
    <h2>Synergies</h2>
    <ul id="synergy-list"><li>Only Deployment Synergies are displayed.Synergies will only work when players are in court inside the game.</li></ul>
</div>

<script>
/* ====== DADOS (mantidos) ====== */
const characters = [
{ nome: "Kageyama UR",data: "01/12/26", funcao: "S", img: "img/kageyamaUR.png", School: "Karasuno", vinculo: ["Eccentric Duo", "Karasuno Geniuses"], Stats:{Serve:1782,Spike:1948,Set:1911,Receive:1625,Block:1709,Save:1539}, habilidades:[{nome:"Genius Setter",descricao:"Kageyama Tobio sets with a power of [Set] x 120/135/150%. When he sets, the [Quick Attack] of the member who spikes is increased by his [Set] x 15%. This effect lasts until the ball goes over the net."},{nome:"Murder Serve",descricao:"Kageyama Tobio performs a powerful jump serve with a power of 130/145/160% of his [Serve]. If this play is a perfect serve, his teammates’ [Attack Technique] is increased by 10%. This effect lasts until the ball has crossed the net 6 times."},{nome:"Silent King",descricao:"Increases Kageyama Tobio’s [Attack Technique] by 8/10/12%. When he is on the court and the opponent’s Serve, Quick Attack, or Spike is a nice play, he gains 1 stack of the [Competitive Spirit] effect. Up to 5 stacks. When he is on the court and an ally Serves, Quick Attacks, or Spikes, 1 stack of [Competitive Spirit] effect is consumed, and the [Awareness] of the member performing the Serve, Quick Attack, or Spike is increased by 20/25/30%. This effect lasts until the ball goes over the net twice. At the start of a rally, he will gain one stack of the [Competitive Spirit] effect."},{nome:"Dominate the Game",descricao:"Kageyama Tobio performs a Quick Attack with a power equal to 240/255/270/285/300% of the set. The Quick Attack cannot be blocked. The cooldown of the opponent’s frontline block skill during the cooldown increases by 4 times the number of times the ball goes over the net."}], symbols: [ "img/quicksymbol.png", "img/servesymbol.png", "img/settersymbol.png" ] },
{ nome: "Kageyama SSR", funcao: "S", img: "img/kageyamaSR.png", School: "Karasuno", vinculo: [],Stats:{Serve:1314,Spike:1246,Set:1378,Receive:1115,Block:1246,Save:1047},habilidades:[{nome:"Manipulate the Moment",descricao:"When Hinata Shoyo (Flower Viewing) is on the court, the [Defensive Technique] of all front line players is increased by 10/13/16%. When Hinata Shoyo makes a nice play, his [Offensive Technique] is increased by 3/3.5/4%. Up to 4 stacks."},{nome:"Stepping Stone",descricao:"Hinata Shoyo (Flower Viewing) receives a ball with 140/160/180% of his receive Stat, and allies’ base Stats increase by 12%. This effect for 6 net crossings."},{nome:"Counterattack",descricao:"When Hinata Shoyo (Flower Viewing) is in the back row, the [Defensive Technique] of allied back row players is increased by 10/13/16%. When Hinata Shoyo (Flower Viewing) is on the court and the team’s receive result is not BAD, his [Quick Attack] Stat is increased by 12/16/20% for the next two net crossings. If the teammate’s receive is a PERFECT play, Hinata Shoyo’s (Flower Viewing) quick attack after this play occurs is increased by 100%."},{nome:"Jump High",descricao:"Hinata Shoyo (Flower Viewing) performs a quick attack with 260/275/290% of [Quick Attack] as power. If this play is a nice play, the power increases by an additional [Quick Attack] x 40/45/50%."}], symbols: [ "img/quicksymbol.png", "img/servesymbol.png", "img/settersymbol.png" ] },
{ nome: "Hinata SP",data: "01/27/26", funcao: "MB", img: "img/hinataSP.png", School: "Karasuno", vinculo: ["Eccentric Duo", "Cherry Blossom Viewing" , "Sun vs Moon"],Stats:{Serve:1673,Spike:1950,Set:1656,Receive:1913,Block:1774,Save:1656},habilidades:[{nome:"Manipulate the Moment",descricao:"When Hinata Shoyo (Hanami) is on the court, the [Defensive Technique] of all front line players is increased by 10/13/16%. When Hinata Shoyo's play result is Perfect, his [Offensive Technique] is increased by 3/3.5/4% with a maximum of 4 stacks."},{nome:"A Foot Hold (such a sick reference to his receive)",descricao:"Hinata Shoyo (Hanami) receives a ball with 140/160/180% of [Receive] as power, and your team's base Stats increase by 12%. This effect for 6 net crossings."},{nome:"Counterattack",descricao:"When Hinata Shoyo (Hanami) is in the back row, the [Defensive Technique] of allied back row players is increased by 10/13/16%. When Hinata Shoyo (Hanami) is on the court and the team's receive result is not BAD, his [Quick Attack] Stat is increased by 12/16/20% for the next two net crossings. If the teammate's receive is a PERFECT play, Hinata Shoyo's (Hanami) quick attack after this play occurs is increased by 100%."},{nome:"High Jump",descricao:"Hinata Shoyo (Hanami) performs a quick attack with 260/275/290% of [Quick Attack] as power. If this play is Perfect, the power increases by an additional 40/45/50% of [Quick Attack]."}], symbols: [ "img/quicksymbol.png", "img/receivesymbol.png" ] },
{ nome: "Hinata SSR", funcao: "MB", img: "img/hinataSR.png", School: "Karasuno", vinculo: ["Eccentric Duo"],Stats:{Serve:1173,Spike:1383,Set:1118,Receive:1195,Block:1250,Save:1253},habilidades:[{nome: "THE GREATEST DECOY", descricao:"While SHOYO HINATA is present, increases Power/Quick Attack Stat of players on your side by 7%"}, {nome: "QUICK DUO", descricao:"When SHOYO HINATA performs a Quick Attack and the setter is a Quick Attack-type player, increases this spike's power by 15% of that setter's Quick Attack Stat."}, {nome: "ON THE BALL", descricao:"Increases SHOYO HINATA's Awareness by 6%. When HINATA lands a Critical hit, additionally increases Awareness by 4%, stacking up to 1 times."}, {nome: "SOARING TEEN", descricao:"SHOYO HINATA performs a Quick Attack with 235% of his Quick Attack Stat as power. If this spike is a Critical hit, increases its power by an additional 20% of his Quick Attack Stat."}], symbols: [ "img/quicksymbol.png" ] },
{ nome: "Nishinoya SP",data: "03/13/26", funcao: "L", img: "img/nishinoyaSP.png", School: "Karasuno", vinculo: ["Karasuno Geniuses", "After School"],Stats:{Serve:1615,Spike:1615,Set:1851,Receive:1969,Block:1577,Save:1854},habilidades:[{nome:"World-Class Acceleration",descricao:"Nishinoya Yu (After School)'s [Reflex] is increased by 10%/13%/16%. When an opposing team member makes a Perfect play, Nishinoya Yu (After School)'s [Reflex] is increased by 1.5%. Stacks up to 10 times. This effect lasts until the ball goes over the net 6 times."},{nome:"A-Pass",descricao:"Nishinoya Yu (After School) sets the ball with 140%/160%/180% of [Set] as power. Nishinoya Yu (After School)'s [Attention] increases by 100% of [Reflex] as power. This effect lasts for two net crossings."},{nome:"Save the Team in Crisis",descricao:"Nishinoya Yu (After School)'s [Spirit] is increased by 20%/25%/30%. When an ally makes a perfect play, the cooldown of Foot Receive is reduced by one time the ball goes over the net."},{nome:"Foot Receive",descricao:"Nishinoya Yu (After School) performs a receive with 260%/275%/290% of [Receive] as power. Nishinoya Yu (After School)'s [Receive] is increased by 20%. This effect lasts for two net crossings."}], symbols: [ "img/receivesymbol.png", "img/settersymbol.png" ] },
{ nome: "Nishinoya SSR", funcao: "L", img: "img/nishinoyaSR.png", School: "Karasuno", vinculo: ["Guardian God and Wing Spiker" , "Kiyoko Squad"],Stats: { Serve:1131, Spike:1131, Set:1254, Receive:1389, Block:1098, Save:1327 },habilidades:[{nome: "GUARDIAN DEITY", descricao:"When YU NISHINOYA's Save result is not BAD, increases the power of the next Power Spike skill used by your Power-type player by 15% of his Power Attack Stat"}, {nome: "LIBERO SUPREME", descricao:"YU NISHINOYA performs a Save with 120% of Save Stat as power"}, {nome: "INSPIRE MORALE", descricao:"When YU NISHINOYA enters the court, increases your Team Morale by 18"}, {nome: "ROLLING THUNDER", descricao:"YU NISHINOYA consumes 20 additional Stamina to perform a Receive with 220% of Receive Stat power; if the Receive result is not BAD, reduces the cooldown of your side's next Power Spike skill by 6 net crossings"}], symbols: [ "img/receivesymbol.png" ] },
{ nome: "Tanaka SSR", funcao: "WS", img: "img/tanakaSR.png", School: "Karasuno", vinculo: ["Kiyoko Squad"],Stats: { Serve:1190, Spike:1385, Set:1120, Receive:1316, Block:1248, Save:1129 }, habilidades:[{nome: "THE ACE ARRIVES", descricao:"Increases the power of RYUNOSUKE TANAKA's 1st Power Spike in each match by 25% of Power Attack Stat"}, {nome: "TENACIOUS SPIRIT", descricao:"RYUNOSUKE TANAKA performs a Receive with 115% of Receive Stat as power; for this Receive, TANAKA's Reflex increases by 10%"}, {nome: "BURNING PASSION", descricao:"Increases RYUNOSUKE TANAKA's Power Spike power by 10% of Power Attack Stat; his Power Spike reduces opponent's blocking and receiving players' Stamina by 5"}, {nome: "SUPER INNER CROSS", descricao:"RYUNOSUKE TANAKA consumes 5 extra Stamina to perform a Short Diagonal Spike with 250% of Power Attack Stat as power; when this is TANAKA's first spike in this set, increases spike power by an additional 30% of TANAKA's Power Attack Stat"}], symbols: [ "img/powersymbol.png" ] },
{ nome: "Tsuki SP", funcao: "MB", img: "img/tsukiSP.png", School: "Karasuno", vinculo: ["Sun vs Moon"],Stats:{Serve:1685,Spike:1968,Set:1669,Receive:1759,Block:1789,Save:1774}, habilidades:[{nome:"Great Brain",descricao:"When a member on the opponent's court is under an unfavorable effect, Tsukishima Kei (Fireworks Festival)'s [Awareness] and [Reflex] are increased by 15%/20%/25%, and allied members' [Offensive Technique] and [Defensive Technique] are increased by 10%. This effect lasts for 1 rally. When an ally activates a block skill, Tsukishima Kei's (Fireworks Festival) [Quick Attack] is increased by 3%. Up to 10 stacks. When an ally's quick attack skill is activated, Tsukishima Kei's (Fireworks Festival) [Block] is increased by 3%. Up to 10 stacks."},{nome:"Block is a System",descricao:"Tsukishima Kei (Fireworks Festival) Blocks with the power of [Lock] x 300%/325%/350%. Increases the [Reflex] of allied rear guards by 10% and [Spirit] by 20%. This effect lasts until the ball crosses the net twice."},{nome:"Calmly Watch the Battle Situation",descricao:"At the start of the match, if Tsukishima Kei (Fireworks Festival)'s [Attack Technique] is equal to or greater than [Defensive Technique], he gains the [Attack I/II/III] effect. If [Defensive Technique] is greater than [Attack Technique], he gains the [Defensive I/II/III] effect. If you have the [Attack I/II/III] effect, the cooldown of 'Block is a System' is reduced by 4 times the number of times the ball has gone over the net. The power of 'Block is a System' is reduced by [Block] x 100%/80%/60%. [Quick Attack] is reduced by 20/30/40."},{nome:"Spikes that make use of his height",descricao:"Tsukishima Kei (Fireworks Festival) performs a quick attack with a power of [Quick Attack] x 260%/280%/300%/320%/340%. If a member on the opponent's court has an adverse effect, the power of this quick attack increases by [Quick Attack] x 60%."}], symbols: [ "img/quicksymbol.png", "img/blocksymbol.png" ] },
{ nome: "Tsuki SSR", funcao: "MB", img: "img/tsukiSR.png", School: "Karasuno", vinculo: [],Stats: { Serve:1210, Spike:1314, Set:1153, Receive:1173, Block:1389, Save:1102 }, habilidades:[{nome: "KARASUNO'S COMPOSURE", descricao:"While KEI TSUKISHIMA is on the court, increases the Strength of your Quick Attack-type players by 10%"}, {nome: "TACTICAL QUICK ATTACK", descricao:"KEI TSUKISHIMA performs a Quick Attack with 115% of his Quick Attack Stat. The next time a teammate casts a Spike skill, their Awareness is increased by 5%"}, {nome: "MOONRISE", descricao:"While KEI TSUKISHIMA is present, increases Block power of your side's front row players by 8% of their Block Stat"}, {nome: "KEI'S RETORT", descricao:"KEI TSUKISHIMA performs a Block with 195% of his Block Stat as power. Applies the \"Enrage\" debuff to the opposing spiker (reducing their Power/Quick Attack Stats by 10%)"}], symbols: [ "img/quicksymbol.png", "img/blocksymbol.png" ] },
{ nome: "Daichi SSR", funcao: "OP", img: "img/daichiSR.png", School: "Karasuno", vinculo: [],Stats: { Serve:1182, Spike:1250, Set:1123, Receive:1385, Block:1248, Save:1191 }, habilidades:[{nome: "STEADY RECEPTION", descricao:"When DAICHI SAWAMURA performs a Receive, restores 3 Stamina to the teammate with the lowest Stamina."}, {nome: "SLEDGEHAMMER SPIKE", descricao:"DAICHI SAWAMURA performs a Power Spike with 120% of his Power Attack Stat."}, {nome: "TEAM BACKBONE", descricao:"While DAICHI SAWAMURA is present, increases receive power of your side's back row players by 10% of their Receive Stat"}, {nome: "RELIABLE DEFENSE", descricao:"DAICHI SAWAMURA performs a Receive with 220% of his Receive Stat. If your side's next Spike is a Power Spike, increases that spike's power by 15% of the spiker's Power Attack Stat."}], symbols: [ "img/receivesymbol.png" ] },
{ nome: "Azumane SSR", funcao: "WS", img: "img/azumaneSR.png", School: "Karasuno", vinculo: ["Guardian God and Wing Spiker"],Stats: { Serve:1322, Spike:1387, Set:1118, Receive:1254, Block:1190, Save:1122 }, habilidades:[{nome: "PROFICIENT DEFENSE", descricao:"ASAHI AZUMANE performs a Receive with 120% of Receive Stat as power"}, {nome: "BULLET SERVE", descricao:"ASAHI AZUMANE performs a Jump Serve with 120% of Serve Stat as power"}, {nome: "ACE'S AURA", descricao:"When ASAHI AZUMANE's Stamina is above 70, increases his Power Spike's power by 15% of Power Attack Stat"}, {nome: "CHARGED SPIKE", descricao:"ASAHI AZUMANE consumes 30 additional Stamina to perform a Power Spike with 235% of Power Attack Stat as power, receives 1 stacks of \"Power Charge\"; when casting [CHARGED SPIKE] skill, each stack of \"Power Charge\" increases Power Spike power by 50% of Power Attack Stat"}], symbols: [ "img/powersymbol.png", "img/servesymbol.png" ] },
{ nome: "Sugawara SP",data: "04/12/26", funcao: "S", img: "img/sugawaraSP.png", School: "Karasuno", vinculo: ["After School"],Stats:{Serve:1849,Spike:1758,Set:1950,Receive:1667,Block:1774,Save:1605},habilidades:[{nome:"Support the Attack",descricao:"When Sugawara Koshi (After School) is on the court and a frontline ally activates a block skill, the blocking member's [Block] is increased by 5%/6.25%/7.5% × the total value of the other frontline ally's [Block]. A maximum increase of 1000/1250/1500 is possible. This effect lasts until the ball goes over the net twice. When Sugawara Koshi (After School) is on the court and a backline ally receives the ball, the receiving member's [Receive] is increased by 5%/6.25%/7.5% × the total value of the other backline ally's [Receive]. A maximum increase of 1000/1250/1500 is possible. This effect lasts until the ball goes over the net twice."},{nome:"A skillful serve that exploit weaknesses",descricao:"Sugawara Koushi (After School) Serves with power equal to [Serve] × 140%/160%/180%. Increases team morale by 10. Increases Basic stats of allied members by 12%/14%/16%. This effect lasts for 1 rally."},{nome:"Careful setup",descricao:"Sugawara Koushi (After School) Increases stamina by 13%/16%/20%. When Sugawara Koushi (After School) first participates, allied members will consume 50% of their current stamina, and for every 6 stamina consumed, allied members' Basic stats will increase by 1%/1.3%/1.6%. After Sugawara Koushi (After School)'s first participation, allied members' stamina will reSave 15 at the end of each rally. This effect lasts for 4 rallies."},{nome:"Sign Play",descricao:"Sugawara Koushi (After School) consumes an additional 15 stamina and performs a set with 60% ([Set] × 2) / 80% ([Set] × 2) / 300% / 20% ([Set] × 3) / 40% power ([Set] × 3). The first member to spike (Power Attack/Quick Attack) after this play increases the [Attack Technique] by 2.0%. This effect lasts until the ball goes over the net twice."}] , symbols: [ "img/blocksymbol.png", "img/servesymbol.png", "img/settersymbol.png" ] },
{ nome: "Kenma SP",data: "02/26/26", funcao: "S", img: "img/kenmaSP.png", School: "Nekoma", vinculo: ["Cherry Blossom Viewing"],Stats:{Serve:1580,Spike:1700,Set:1990,Receive:1710,Block:1600,Save:1590}, habilidades:[{nome:"Leadership",descricao:"When Kozume Kenma (Hanami) is on the court, allied members' [Reflex] is increased by 10/13/16%. When he is on the court and an allied member receives or Saves, he gains one stack of the [Defense that Eliminates Openings] effect, allied members' [Reflex] is increased by 1.5%. Up to 10 stacks. If the results of an allied member's receive or Save is not BAD, he gains one more stack of the [Defense that Eliminates Openings] effect."},{nome:"Set With No Wasted Movement",descricao:"Kozume Kenma (Hanami) performs a set with 140/160/180% of [Set] as power. If the player who attacks (Power Attack/Quick Attack) after this play occurs is in the back row, the power of the attack will be increased by 20%."},{nome:"Look For Flaws",descricao:"When Kozume Kenma (Hanami) performs a Set or Setter Dump, his [Awareness] increases by 40/60/80% of [Reflex] as power. If he is on the court and his teammate's block result is not BAD, the power of the opponent's current spike (Power Attack/Quick Attack) is increased by the corresponding member's [Power Attack/Quick Attack] by 10/13/16%."},{nome:"Play That Confuses The Opponent",descricao:"Kozume Kenma (Hanami) performs a Setter Dump with 255/270/285/300/315% of [Set] as power. Setter Dump cannot be blocked. After this play occurs, the first time an opposing player spikes (Power Attack/Quick Attack), the [Power] of that player is reduced by 40%. This effect lasts for 2 net crossings."}], symbols: [ "img/receivesymbol.png", "img/settersymbol.png" ] },
{ nome: "Kenma SSR", funcao: "S", img: "img/kenmaSR.png", School: "Nekoma", vinculo: ["Brain and Commander"],Stats:{Serve:1182,Spike:1387,Set:1387,Receive:1122,Block:1303,Save:1060}, habilidades:[{nome:"DIVINE VISION", descricao:"While KENMA KOZUME is on the court, increases your side's players' Receive power by 8% of their Receive Stat. When Kozume's Set or your side's Receive results in PERFECT, gain 1 stack(s) of 'Keep It Alive'. Each stack increases Receive power of your side's players by 3%, up to 6 stacks."}, {nome:"STEADY SETTING", descricao:"KENMA KOZUME performs a Set with 120% of his Set Stat."}, {nome:"THE BRAIN", descricao:"While KENMA KOZUME is on the court, increases your side's players' Receive power by 6% of their Receive Stat. If 'Keep It Alive' exceeds 5 stacks, additionally increases their Receive power by 150% and Save power by 150%. When your side's Receive or Save fails, consumes 6 stacks of 'Keep It Alive' to convert the result to PERFECT."}, {nome:"DECEPTIVE DUMP", descricao:"KENMA KOZUME performs an unblockable Setter Dump with 220% of his Set Stat."}], symbols: [ "img/receivesymbol.png", "img/settersymbol.png" ] },
{ nome: "Yaku SSR", funcao: "L", img: "img/yakuSR.png", School: "Nekoma", vinculo: ["Educational Guidance"],Stats:{Serve:1131,Spike:1131,Set:1253,Receive:1391,Block:1098,Save:1323}, habilidades:[{nome:"Key To Defense",descricao:"When Morisuke Yaku is on the court and a teammate's receiving result is not BAD, Morisuke Yaku's [Receive] and [Save] are increased by 3/4/5% with a maximum of 5 stacks."},{nome:"Reliable Defense",descricao:"When Morisuke Yaku is on the court, the Quick Attack of your Quick Attack Specialist on the court is increased by 8/10/12% of that player's [Quick Attack] Stat as power."},{nome:"Super Libero",descricao:"Morisuke Yaku's [Receive] is increased by 11/13/15%. If the result is NORMAL, it changes to PERFECT."},{nome:"Perfect Receive",descricao:"Morisuke Yaku performs a Receive with 240/255/270/285/300% of [Receive] as power."}], symbols: [ "img/quicksymbol.png", "img/receivesymbol.png" ] },
{ nome: "Kuro SSR", funcao: "MB", img: "img/kuroSR.png", School: "Nekoma", vinculo: [],Stats:{Serve:1221,Spike:1318,Set:1149,Receive:1186,Block:1389,Save:1123}, habilidades:[{nome:"EXPERT'S AURA", descricao:"While TETSURO KUROO (Practice) is present, increases Strength of Quick Attack-type players on your side by 16%"}, {nome:"STEADY OFFENSE", descricao:"TETSURO KUROO (Practice) performs a Quick Attack with 125% of Quick Attack Stat as power, receives 1 stacks of 'Power Charge'; when casting [Steady Offense] skill, each stack of 'Power Charge' increases spike power by 15% of Quick Attack Stat, up to 2 stacks"}, {nome:"BLOCK CONTROL TOWER", descricao:"While TETSURO KUROO (Practice) is present, increases Block Stat of players on your side by 8%"}, {nome:"LOCKDOWN", descricao:"TETSURO KUROO (Practice) performs a Block with 170% of Block Stat as power; when other front row Block-type players are present, increases this block's power by 15% of Block Stat"}], symbols: [ "img/blocksymbol.png", "img/quicksymbol.png" ] },
{ nome: "Kuro UR", funcao: "MB", img: "img/kuroUR.png", School: "Nekoma", vinculo: ["Brain and Commander"],Stats:{Serve:1558,Spike:1673,Set:1551,Receive:1581,Block:1740,Save:1533}, habilidades:[{nome:"All Rounder",descricao:"Increases Tetsuro Kuroo's [Quick Attack] by 10/12/14%. When he is on the court, his [Block] and [Quick Attack] increase by 5% each time the ball goes over the net. Stacks up to 5 times."},{nome:"A Quick",descricao:"Tetsuro Kuroo performs a quick attack with a power of [Quick Attack] × 125% and gains 1 stack of the [Charge] effect. When A Quick is activated, the power of the quick attack increases by [Quick Attack] × 5% for each [Charge] stack. Up to 3 stacks."},{nome:"Leadership",descricao:"Increases Tetsuro Kuroo's [Block] by 14/16/18%. If his block result is PERFECT, the opposing team member who performs a spike (Power Attack/Quick Attack) will be inflicted with the [Rage] disadvantage ([Power Attack/Quick Attack] will be reduced by 10%)."},{nome:"Lead Block",descricao:"Tetsuro Kuroo blocks with a power of [Block] × 235/250/265/280/295%. If the opposing member who performed the spike (Power Attack/Quick Attack) has a disadvantageous effect, the power of this block increases by an additional [Block] × 20%."}], symbols: [ "img/quicksymbol.png", "img/blocksymbol.png" ] },
{ nome: "Lev SSR", funcao: "MB", img: "img/levSR.png", School: "Nekoma", vinculo: ["Educational Guidance"],Stats:{Serve:1206,Spike:1318,Set:1138,Receive:1166,Block:1378,Save:1100}, habilidades:[{nome:"TRIGGERED BURST", descricao:"While LEV HAIBA is on the court, when your side achieves a PERFECT Receive, his next Quick Attack gains 15% of his Quick Attack Stat as additional power."}, {nome:"MOMENTUM BLOCK", descricao:"LEV HAIBA performs a Block with 105% of his Block Stat."}, {nome:"GIFTED ATHLETE", descricao:"When LEV HAIBA performs a Quick Attack and the opponent's blocker is affected by a debuff, reduces that blocker's Block power by 10% of their Block Stat."}, {nome:"TALENTED SPIKE", descricao:"LEV HAIBA performs a Quick Attack with 245% of his Quick Attack Stat."}], symbols: [ "img/quicksymbol.png", "img/blocksymbol.png" ] },
{ nome: "Aone SP",data: "06/18/26", funcao: "MB", img: "img/aoneSP.png", School: "Dateko", vinculo: ["Swimming"],Stats:{Serve:1848,Spike:1788,Set:1754,Receive:1667,Block:1904,Save:1605}, habilidades:[{nome:"Mighty Wall",descricao:"Aone Takanobu (Beach Boys)'s [Reflex] is increased by 10/13/16%. If Aone Takanobu (Beach Boys)'s Stamina is less than 80, his [Block] and [Serve] are increased by 10%. When Aone Takanobu (Beach Boys) blocks, if this play results in a 2-person or 3-person block, for each member with a block skill among the blocking members, the block power of this play is increased with 20% of Aone Takanobu (Beach Boys)'s [Block] Stat as power."},{nome:"Team Motivating Jump Serve",descricao:"Takanobu Aone (Beach Boys) performs a Jump Serve with 140/160/180% of [Serve] as power. The cooldown of the opposing setter's skill is increased by 4 times the number of times the ball has crossed the net (Example, 2 net crossings × 4 = +8 cooldown). When Takanobu Aone (Beach Boys) leaves the court, if Takanobu Aone (Beach Boys) has activated [Team Motivating Jump Serve] during this match, the [Offensive Technique] and [Defensive Technique] of your players are increased by 5%, and if the number of stacks of the [Tough Block] effect is 3 or more, the [Offensive Technique] and [Defensive Technique] of your players are increased by 5% more. This effect lasts until Takanobu Aone (Beach Boys)'s next match. (Each stack of [Tough Block] increases [Reflex] by 10%, with a maximum of 20 stacks)."}, {nome:"Strong and High Walls",descricao:"When Takanobu Aone (Beach Boys) is on the court, each time an opposing player performs an attack (Power Attack/Quick Attack), the attacker gains 1 stack of [Locked On]. At the start of the match, all opposing players gain 1 stack of [Locked On]. If Takanobu Aone (Beach Boys) is on the court and an opposing player has two stacks of [Locked On], that player will consume all of their stacks of [Locked On], and Aone Takanobu (Beach Boys) will gain [Tough Block]. If Aone Takanobu (Beach Boys) has more than 2 stacks of [Tough Block], his Block is increased by 10% of [Block] as power. If Takanobu Aone (Beach Boys) has more than 4 stacks of [Tough Block], the cooldown of [Sharp, Leading Block] decreases to 8 net crossings (12 net crossings → 8 net crossings). If Takanobu Aone (Beach Boys) has more than 6 stacks of [Tough Block], his [Spirit] increases by 10%. If Takanobu Aone (Beach Boys) has more than 8 stacks of [Tough Block], the cooldown of [Sharp, Leading Block] further decreases to 4 net crossings (8 net crossings → 4 net crossings)."}, {nome:"Sharp, Leading Block",descricao:"Takanobu Aone (Beach Boys) blocks with 260/275/290/305/320% of [Block] Stat as power. Increases team morale by 15."}], symbols: [ "img/blocksymbol.png", "img/servesymbol.png" ] },
{ nome: "Aone SSR", funcao: "MB", img: "img/aoneSR.png", School: "Dateko", vinculo: ["The Silent and the Sarcastic"],Stats:{Serve:1219,Spike:1316,Set:1146,Receive:1173,Block:1389,Save:1102}, habilidades:[{nome:"LOCK DOWN ACE", descricao:"When TAKANOBU AONE achieves a PERFECT Block result, marks the opponent spiker, reducing their next spike's power by 10% of Power/Quick Attack Stat and increasing their Stamina consumption by 30%"}, {nome:"HEAVY STRIKE", descricao:"TAKANOBU AONE performs a Quick Attack with 120% of Quick Attack Stat as power"}, {nome:"TRI-WALL FORMATION", descricao:"When TAKANOBU AONE blocks, for each Block-type player on your side (1), increases Block power by 1% of Block Stat; when all 3 front row players are of Block-type, increases Block power by an additional 4% of Block Stat"}, {nome:"IRON PILLAR", descricao:"TAKANOBU AONE performs a Block with 195% of Block Stat as power; when blocking an opponent's Power Spike, increases this block's power by an additional 9% of Block Stat"}], symbols: [ "img/quicksymbol.png", "img/blocksymbol.png" ] },
{ nome: "Futakuchi SSR", funcao: "WS", img: "img/futakuchiSR.png", School: "Dateko", vinculo: ["The Silent and the Sarcastic" , "The New Captain and the Tall Rookie"],Stats:{Serve:1217,Spike:1316,Set:1147,Receive:1184,Block:1385,Save:1122}, habilidades:[{nome:"CAPTAIN'S AUTHORITY", descricao:"While KENJI FUTAKUCHI is present, increases your side's Block power by 8% of each player's Block Stat"}, {nome:"INITIATE ATTACK", descricao:"KENJI FUTAKUCHI performs a Jump Serve with 120% of Serve Stat as power"}, {nome:"RAISING DEFENSE", descricao:"While KENJI FUTAKUCHI is present, for each Block-type player on your side (1), increases Block power by 0.5% of Block Stat"}, {nome:"UNBREAKABLE IRON WALL", descricao:"KENJI FUTAKUCHI performs a Block with 195% of Block Stat as power; when the opponent's spiking player is affected by a debuff, increases this block's power by an additional 10% of Block Stat"}], symbols: [ "img/blocksymbol.png", "img/servesymbol.png" ] },
{ nome: "Sasaya SSR", funcao: "OP", img: "img/sasayaSR.png", School: "Dateko", vinculo: [],Stats:{Serve:1184,Spike:1378,Set:1120,Receive:1314,Block:1255,Save:1127}, habilidades:[{nome:"CALM RESPONSE", descricao:"Increases TAKEHITO SASAYA's Awareness by 5%; while Sasaya is present, increases Reflex of players on your side by 5%"}, {nome:"IMPENETRABLE DEFENSE", descricao:"TAKEHITO SASAYA performs a Block with 105% of Block Stat as power"}, {nome:"FORTIFIED IRON WALL", descricao:"While TAKEHITO SASAYA is present, when your side is behind, increases your side's Block skill power by an additional 3% of each blocking player's Block Stat and increases blocking players' Reflex by 5%"}, {nome:"AGGRESSIVE PLAY", descricao:"TAKEHITO SASAYA performs a Power Spike with 240% of Power Attack Stat as power"}], symbols: [ "img/powersymbol.png" ] },
{ nome: "Koganegawa SSR", funcao: "S", img: "img/koganegawaSR.png", School: "Dateko", vinculo: ["The New Captain and the Tall Rookie"],Stats:{Serve:1166,Spike:1302,Set:1365,Receive:1100,Block:1306,Save:1031}, habilidades:[{nome: "Rookie Setter", descricao: "KANJI KOGANEGAWA performs a Set with 120% of his Set Stat."}, {nome: "Block Spark", descricao: "KANJI KOGANEGAWA performs a Block with 105% of his Block Stat. While he is on the court, when the opponent performs a Power Spike, your side's blocking players gain 3% additional Block power based on their own Block Stat."}, {nome: "Iron Wall III", descricao: "While KANJI KOGANEGAWA is on the court, increases Block power of your other players' Block skills by 2% of their Block Stat."}, {nome: "Flash Dump", descricao: "KANJI KOGANEGAWA performs an unblockable Setter Dump with 210% of his Set Stat."}], symbols: [ "img/blocksymbol.png", "img/settersymbol.png" ] }, 
{ nome: "Oikawa UR",data: "09/14/25", funcao: "S", img: "img/oikawaUR.png", School: "Aoba Johsai", vinculo: ["Perfect Harmony"],Stats:{Serve:1705,Spike:1533,Set:1627,Receive:1378,Block:1530,Save:1290}, habilidades:[{nome:"The King's Set",descricao:"Oikawa Tooru Sets with 120/135/150% of [Set] as power. If a teammate on the court performs a play, and the result is Perfect, he gains 1 stack of [Offensive Rhythm]. For each stack of [Offensive Rhythm], the [Awareness] of your deployed players increases by 1%, with a maximum of 10 stacks."},{nome:"Unparalleled Talent",descricao:"Oikawa Tooru performs a setter dump with 115% of [Set] as power. The setter dump cannot be blocked. If Oikawa Tooru is on the court, a Power Attack on an allied court member's [Power] is increased by 20%."},{nome:"Conductor",descricao:"When Oikawa Tooru is on the court, the [Awareness] of your players on the court is increased by 10/14/18%. (If Oikawa has 6+ stacks of [Offensive Rhythm]). When one of your players performs a Power Attack skill, consumes 6 stacks of [Offensive Rhythm], and a Perfect result is guaranteed."},{nome:"The Great King's Jump Serve",descricao:"Oikawa Tooru performs a Jump Serve with 260/275/290/305/320% with [Serve] as power. This play increases his [Awareness] by 20% and his [Power] by 20%."}], symbols: [ "img/powersymbol.png", "img/servesymbol.png", "img/settersymbol.png" ] },
{ nome: "Oikawa SSR", funcao: "S", img: "img/oikawaSR.png", School: "Aoba Johsai", vinculo: [],Stats:{Serve:1391,Spike:1327,Set:1327,Receive:1125,Block:1248,Save:1054}, habilidades:[{nome:"COURT VISION",descricao:"Increases TORU OIKAWA (Practice)'s Set Stat by 10%. When your players cast a Spike skill, they gain 1 stack(s) of 'Attack Tempo'. Each stack increases your players' Awareness by 1%, up to 10 stacks."},{nome:"GAME CHANGER",descricao:"While TORU OIKAWA (Practice) is on the court, at the start of each turn, if your side is behind, increases all basic Stats of your players by 6%, lasting for 8 net crossings."},{nome:"CONTROL TOWER",descricao:"While TORU OIKAWA (Practice) is on the court, increases your players’ Awareness by 6%. Each stack of 'Attack Tempo' provides an additional 1% Awareness."},{nome:"DOUBLE-EDGED SERVE",descricao:"TORU OIKAWA (Practice) performs a Power Jump Serve with 240% of his Serve Stat. For this Serve, his Awareness increases by 15%. This Serve has a 5% chance to fail."}], symbols: [ "img/powersymbol.png", "img/servesymbol.png", "img/settersymbol.png" ] },
{ nome: "Iwazumi SSR", funcao: "WS", img: "img/iwazumiSR.png", School: "Aoba Johsai", vinculo: ["Perfect Harmony", "The Pack"],Stats:{Serve:1190,Spike:1385,Set:1118,Receive:1314,Block:1248,Save:1129}, habilidades:[{nome:"Ace's Strength",descricao:"Increases HAJIME IWAIZUMI's Awareness by 5% and Strength by 10%"},{nome:"Focused Defense",descricao:"HAJIME IWAIZUMI performs a Receive with 120% of Receive Stat as power"},{nome:"Vice-Captain's Rally",descricao:"While HAJIME IWAIZUMI is present, increases Strength of players on your side by 6%"},{nome:"Head-to-Head",descricao:"HAJIME IWAIZUMI performs a Power Spike with 240% of Power Attack Stat as power; when this spike achieves Critical result, increases its power by 15% of Power Attack Stat"}], symbols: [ "img/powersymbol.png" ] },
{ nome: "Kentaro MAD DOG SSR", funcao: "OP", img: "img/kentaroSR.png", School: "Aoba Johsai", vinculo: ["The Pack"],Stats:{Serve:1320,Spike:1383,Set:1106,Receive:1235,Block:1179,Save:1109}, habilidades:[{nome:"FIERCE ATTACK", descricao:"Increases KENTARO KYOTANI's Awareness by 8% and Power Attack Stat by 5%"}, {nome:"MAD DOG SERVE", descricao:"KENTARO KYOTANI performs a Serve with 130% of his Serve Stat. For this Serve, his Awareness increases by 15%, with a fixed 10% chance to fail"}, {nome:"STRENGTH BURST", descricao:"Increases KENTARO KYOTANI's Strength by 18%"}, {nome:"MAD DOG'S FANG", descricao:"KENTARO KYOTANI performs a Power Spike with 210% of his Power Attack Stat, reducing the Stamina of the opponent's blocking and receiving players by 10"}], symbols: [ "img/powersymbol.png", "img/servesymbol.png" ] },
{ nome: "Ushijima UR", funcao: "OP", img: "img/ushijimaUR.png", School: "Shiratorizawa", vinculo: ["Besties for Life", "Absolute Champion and Steady Setter"],Stats:{Serve:1499,Spike:1574,Set:1261,Receive:1417,Block:1345,Save:1261}, habilidades:[{nome:"IN THE GROOVE",descricao:"Increases WAKATOSHI USHIJIMA's Awareness by 8%. While he is on the court, his Awareness increases by an additional 3% at the end of each turn."},{nome:"DOMINATING SERVE",descricao:"WAKATOSHI USHIJIMA performs a Jump Serve with 125% of his Serve Stat. If this Serve is a Critical Serve, the receiving players cannot cast skills. When this Serve scores, reduces DOMINATING SERVE's cooldown by 4 net crossings."},{nome:"STRENGTH BURST",descricao:"Increases WAKATOSHI USHIJIMA's Strength by 18%."},{nome:"CRUSHING SPIKE",descricao:"WAKATOSHI USHIJIMA performs a Power Spike with 220% of his Power Attack Stat. This Spike deals an additional 30% damage to the opponent's Libero."},{nome:"Ace Style",descricao:"When your players land Critical Spikes, WAKATOSHI USHIJIMA gains 1.5% to all Basic Stats, stacking up to 8 times. When he scores, removes all debuffs from himself."},{nome:"Undisputed Ace",descricao:"WAKATOSHI USHIJIMA performs a Power Spike with 250% of his Power Attack Stat. If this Spike is a Critical, reduces [UNDISPUTED ACE]'s cooldown by 1 net crossings."}], symbols: [ "img/powersymbol.png", "img/servesymbol.png" ] },
{ nome: "Tendo SSR", funcao: "MB", img: "img/tendoSR.png", School: "Shiratorizawa", vinculo: ["Besties for Life"],Stats:{Serve:1214,Spike:1314,Set:1140,Receive:1177,Block:1387,Save:1100}, habilidades:[{nome:"My own pace",descricao:"Tendo Satoru's [Reflex] increases by 12/17/22%."},{nome:"A surprise attack",descricao:"Tendo Satoru makes a Quick Attack with 120/135/150% of [Quick Attack] Stat as power."},{nome:"Block Psychological Warfare",descricao:"If Satoru Tendo's block results in a good play, the cooldown of Sharp Reading is reduced by 1/2/3 for the number of times the ball goes over the net."},{nome:"Sharp “reading”",descricao:"Satoru Tendo blocks with a power of 220/235/250/265/280% of his [Block]. If the opponent's spike (Powerful or Quick Attack) is a nice play, Satoru Tendo's [Reflex] is increased by 15%."}], symbols: [ "img/blocksymbol.png" ] },
{ nome: "Goshiki SSR", funcao: "WS", img: "img/goshikiSR.png", School: "Shiratorizawa", vinculo: ["Shiratorizawa’s WS"],Stats:{Serve:1188,Spike:1383,Set:1115,Receive:1314,Block:1240,Save:1122}, habilidades:[{nome:"Meet Expectations",descricao:"When Tsutomu Goshiki scores, team morale is increased by 8/10/12."},{nome:"Pure Receive",descricao:"Tsutomu Goshiki receives with 120/135/150% of [Receive] as power."},{nome:"Next Ace",descricao:"At the end of each rally, Tsutomu Goshiki gains one stack of [Sharpness] effect. Each stack of [Sharpness] increases [Power Attack] by 2.5/3.3/5%. Up to 5 stacks."},{nome:"Make a Miracle",descricao:"Tsutomu Goshiki performs a Power Attack with 225/240/255/270/285% of [Power Attack] as power. This move increases [Awareness] by 10%."}], symbols: [ "img/powersymbol.png", "img/servesymbol.png" ] },
{ nome: "Shirabu SSR", funcao: "S", img: "img/shirabuSR.png", School: "Shiratorizawa", vinculo: ["Absolute Champion and Steady Setter"],Stats:{Serve:1303,Spike:1382,Set:1242,Receive:1118,Block:1239,Save:1041}, habilidades:[{nome:"As Usual",descricao:"Increases Kenjiro Shirabu's [Set] by 10/13/16%. If the member who spikes [Power Attack/Quick Attack] is a power hitter, the power of this spike increases by 8% of that member's [Power Attack]."},{nome:"Simple Setter Dump",descricao:"Kenjiro Shirabu performs a setter dump with 120/135/150% of [Set] as power. This cannot be blocked."},{nome:"Correction Ability",descricao:"Kenjiro Shirabu's [Awareness] increases by 9/12/15%."},{nome:"Set That Makes the Most of the Spiker",descricao:"Kenjiro Shirabu sets with 210/225/240/250/270% of [Set] as power. This move increases [Awareness] by 10%."}], symbols: [ "img/powersymbol.png", "img/settersymbol.png" ] },
{ nome: "Semi SSR", funcao: "S", img: "img/semiSR.png", School: "Shiratorizawa", vinculo: [],Stats:{Serve:1476,Spike:1329,Set:1406,Receive:1184,Block:1329,Save:1111}, habilidades:[{nome:"Control",descricao:"When Eita Semi performs a serve, the opposing receiver's Receive is reduced by 13/15.5/18% of that player's [Receive] as power. This effect lasts for 4 net crossings."},{nome:"Prototype Assembly",descricao:"Semi Eita performs a Set with 120/135/150% of [Set] as power."},{nome:"Demonstration of Ability",descricao:"When Eita Semi serves, [Awareness] increases by 5/5/8% and [Power] increases by 10/15/15%."},{nome:"This Much is Free",descricao:"Eita Semi performs a Jump Serve with a power of 220/235/250/265/280% of his [Serve]. If he scores an ace with this serve, his teammates' [Awareness] will increase by 3% and [Reflex] by 6%."}], symbols: [ "img/powersymbol.png", "img/servesymbol.png", "img/settersymbol.png" ] },
{ nome: "Ohira SSR", funcao: "WS", img: "img/ohiraSR.png", School: "Shiratorizawa", vinculo: ["Shiratorizawa’s WS"],Stats:{Serve:1272,Spike:1477,Set:1188,Receive:1399,Block:1332,Save:1197}, habilidades:[{nome:"Strong Defense",descricao:"When Ohira Reon receives, if the opponent's quick attack is a NICE play, the power of this receive is 40/55/70% of [Receive] as power."},{nome:"Defense That Changes The Flow",descricao:"Ohira Reon receives with 120/135/150% of [Receive] as power."},{nome:"The Gentle “Benkei”",descricao:"Ohira Reon's [Awareness] is increased by 5/5/8%, and his [Reflex] is increased by 10/15/15%."},{nome:"Power Spikes",descricao:"Ohira Reon makes a powerful spike with 240/255/270/285/300% of [Power Attack] as power."}], symbols: [ "img/receivesymbol.png" ] },
/* ==missing Stats== */{ nome: "Yamagata SSR", funcao: "L", img: "img/yamagataSR.png", School: "Shiratorizawa", vinculo: [],Stats:{Serve:1,Spike:1,Set:1,Receive:2,Block:1,Save:1}, habilidades:[{nome:"Stable Ability",descricao:"Yamagata Hayato's [Reflex] is increased by 13/20/15%."},{nome:"Wide Range of Defense",descricao:"Yamagata Hayato performs a save with [Save] × 120/135/150% as their power."},{nome:"Reflexes",descricao:"If the opponent's block result is PERFECT, Yamagata Hayato's save increases by [Save] × 40/50/60%."},{nome:"Solid receiving",descricao:"Yamagata Hayato receives with [Receive] × 235/250/265/280/295% as his power."}], symbols: [ "img/receivesymbol.png" ] },
{ nome: "Bokuto UR",data: "08/30/25", funcao: "WS", img: "img/bokutoUR.png", School: "Fukurodani", vinculo: ["Miracle Ace and Caring Setter"],Stats:{Serve:1495,Spike:1572,Set:1262,Receive:1417,Block:1347,Save:1268}, habilidades:[{nome:"Influence of Enthusiasm",descricao:"When Bokuto Kotaro plays, team morale of allies increases by 20%/25%/30%. When Bokuto Kotaro is on the court, team morale of allies increases by 4 when an allied member touches the ball. Effect of team morale awakening for allies changed: Basic stats of all members on the court increase by 32%/36%/40%. Lasts until allies touch the ball four times."},{nome:"Big Server",descricao:"Kotaro Bokuto performs a jump serve with [Serve] × 125%/140%/155% power."},{nome:"Ups and Downs in Mood",descricao:"While under the effect of [Excellent Condition], Kotaro Bokuto's [Power Attack] is increased by 12%/15%/18% and his [Power] is increased by 18%/22.5%/27%. While under the effect of [Depressed Mode], Kotaro Bokuto cannot activate Power Attack skills. When an ally activates Team Morale Awakening, Kotaro Bokuto gains the [Excellent Condition] effect. When the team morale awakening of an ally ends, Kotaro Bokuto will gain the [Depressed Mode] effect. At the end of each rally, Kotaro Bokuto loses the [Sad Mode] effect."},{nome:"Ace Thanks to Everyone",descricao:"Kotaro Bokuto performs a Power Attack with the power of [Power Attack] × 260%/275%/290%/305%/320%. If this hit is a nice play, Kotaro Bokuto's [Power] increases by 12%/14%/16%/18%/20% and his team's morale increases by 16."}], symbols: [ "img/powersymbol.png", "img/servesymbol.png" ] },
{ nome: "Bokuto SP",data: "05/12/26", funcao: "WS", img: "img/bokutoSP.png", School: "Fukurodani", vinculo: ["Swimming", "Ace Miraculous and Caring Setter"],Stats:{Serve:1673, Spike:1950, Set:1574, Receive:1856, Block:1760, Save:1572}, habilidades:[{nome:"Enliven",descricao:"Kotaro Bokuro (Beach Boys)’s [Power Attack] increases by 13%/16%/19%. When Kotaro Bokuto (Beach Boys) is on the court, the effects of team morale boosts for allies other than 'Encourage' are reduced by 100%, and for every 10 morale boost reduced, the player gains 1 stack of the 'United' effect. For each stack of the 'United' effect, the Basic stats of allied members increase by 0.16%. Up to 199 stacks. When Kotaro Bokuto (Swimming) is on the court, his teammates will..."},{nome:"Defensive Participation",descricao:"Kotaro Bokuto (Sea Bathing) receives with [Receive] × 140%/160%/180% as power. Gain 3 stacks of the [Unity] effect."},{nome:"Always Cheerful!",descricao:"If you have the [Best Condition] effect, when Kotaro Bokuto (Beach Boys) activates his Ultimate, his [Power Attack] is increased by 1% for each stack of [United] effect. Up to a maximum of 70% increase is possible. This effect lasts until the ball goes over the net twice. Also, for each stack of [United] effect, the power of his Power Attack is increased by [Power Attack] × 1.5%. Up to a maximum of 120% increase is possible. This effect lasts until the ball goes over the net twice. After Kotaro Bokuto (Swimming in the Sea) activates his Ultimate, Kotaro Bokuto (Swimming in the Sea) will gain [Ups and Downs]."},{nome:"Miracle Spike",descricao:"Kotaro Bokuto (Beach Boys) will perform a spike with power equal to 260%/280%/300%/320%/340% of his [Power Attack]. For each stack of [United] effect, Kotaro Bokuto (Beach Boys)’s [Attack Technique] will increase by 0.75%. Up to a maximum of 30% increase is possible. This effect lasts until the ball goes over the net twice."}], symbols: [ "img/powersymbol.png", "img/servesymbol.png" ] },
/* ==missing skills== */{ nome: "Akaashi SP",data: "06/11/26", funcao: "S", img: "img/akaashiSP.png", School: "Fukurodani", vinculo: ["Swimming", "Ace Miraculous and Caring Setter"],Stats:{Serve:1848, Spike:1754, Set:1949, Receive:1581, Block:1758, Save:1489}, habilidades:[ {nome: "No info yet", descricao:"No info yet"}, {nome: "No info yet", descricao:"No info yet"},{nome: "No info yet", descricao:"No info yet"},{nome: "No info yet", descricao:"No info yet"}], symbols: [ "img/powersymbol.png", "img/settersymbol.png" ] },
{ nome: "Akaashi SSR", funcao: "S", img: "img/akaashiSR.png", School: "Fukurodani", vinculo: ["Miracle Ace and Caring Setter"],Stats:{Serve:1396,Spike:1331,Set:1476,Receive:1191,Block:1334,Save:1123}, habilidades:[{nome:"Instant Insight",descricao:"When Keiji Akaashi is on the court and an ally achieves a PERFECT block or receive, all of that ally’s adverse effects are reset. Keiji Akaashi’s [Awareness] increases by 8/10/12% and allies’ team morale increases by 3."},{nome:"The Brain of Fukurodani",descricao:"Keiji Akaashi performs a setter dump with 120/135/150% of [Set] as power. This attack cannot be blocked. If a point is scored with this setter dump, the power of the first teammate’s serve after this play is increased by 10% of that teammate’s [Serve] as power."},{nome:"Devoted Set",descricao:"Increases Keiji Akaashi’s [Set] by 8/10/12%. While Team Morale Awakening is active, for every 4 increase in team morale, Keiji Akaashi’s [Awareness] increases by 1.2/1.7/2.3%. If his set results in a nice play, the first spike [Power Attack/Quick Attack] by an ally after this play is guaranteed to be a NICE play."},{nome:"The Usual Set",descricao:"Keiji Akaashi sets with 240/255/270/285/300% of [Set] as power."}], symbols: [ "img/powersymbol.png", "img/settersymbol.png" ] },
{ nome: "Konoha SSR", funcao: "OP", img: "img/konohaSR.png", School: "Fukurodani", vinculo: [],Stats:{Serve:1256,Spike:1462,Set:1196,Receive:1274,Block:1333,Save:1335}, habilidades:[{nome:"Excellent Receive",descricao:"Akinori Konoha [Receive] is increased by 8/10/12%. While Team Morale Awakening is activated, his [Receive] and [Save] are increased by 10%."},{nome:"An Exquisite Combination",descricao:"Akinori Konoha performs a save with 120/135/150% of [Cover] as power."},{nome:"All-Rounder's Block",descricao:"When Akinori Konoha is in the front row, the [Block] and [Power Attack/Quick Attack] of all allies in the front row is increased by 8/10/12%. If he is in the back row, the [Receive] and [Save] of all allies in the back row is increased by 8/10/12%."},{nome:"Mr. Skillful Poor",descricao:"Akinori Konoha receives with 225/240/255/270/285% of [Receive] as power. If the result of this play is not BAD, team morale is increased by 20."}], symbols: [ "img/receivesymbol.png" ] },
/* ==missing Stats== */{ nome: "Haruki SSR", funcao: "L", img: "img/harukiSR.png", School: "Fukurodani", vinculo: [],Stats:{Serve:1,Spike:1,Set:1,Receive:2,Block:1,Save:1}, habilidades:[{nome:"Master of Defense",descricao:"Haruki Komi’s [Receive] is increased by 8/10/12%. If his receive result is not BAD, the opponent’s team morale decreases by 12."},{nome:"Team Lubricant (0_0)",descricao:"Haruki Komi performs a save that uses 110/125/140% of [Save] as power. If the result of this play is not BAD, the main stats of allies increase by 5/6.5/8% for 1 rally."},{nome:"Proven Receiving",descricao:"When Haruki Komi receives a ball and the opponent hits a powerful one, the power of the receive increases by 30/40/50% of [Receive] as power."},{nome:"Center of Defense",descricao:"Haruki Komi performs a receive that uses 235/250/265/280/295% of [Receive] as power."}], symbols: [ "img/receivesymbol.png" ] },
/* ==missing Stats== */{ nome: "Tatsuo SSR", funcao: "MB", img: "img/tatsuoSR.png", School: "Fukurodani", vinculo: [],Stats:{Serve:1,Spike:1,Set:1,Receive:1,Block:2,Save:1}, habilidades:[
{nome:"An Intimidating Block",descricao:"Tatsuki Washio’s [Block] is increased by 8/10/12%. When he blocks, the power of the first teammate’s receive after this play is increased by 20% of [Receive] as power. If his block result is not BAD, the next time he blocks, it is increased by 20% of [Block] as power."},
{nome:"High Scoring Attack",descricao:"Tatsuki Washio performs a quick attack with 120/135/150% of [Quick Attack] as power."},
{nome:"A Worker With Hidden Talent",descricao:"When an opposing team member makes a NICE play, Tatsuki Washio’s [Block] and [Quick Attack] are increased by 2/2.5/3%. Up to 5 stacks."},
{nome:"A Block That Takes Advantage Of Its Tall Body (?lol)",descricao:"Tatsuki Washio blocks with 220/235/250/265/280% of [Block] as power."}], symbols: [ "img/quicksymbol.png", "img/blocksymbol.png" ] },
{ nome: "Terushima SSR", funcao: "WS", img: "img/terushimaSR.png", School: "Jozenji", vinculo: [],Stats:{Serve:1401,Spike:1470,Set:1196,Receive:1335,Block:1263,Save:1196}, habilidades:[{nome:"Free Spirit",descricao:"Increases Terushima Yuji's [Power Attack] by 8%/10%/12%. When he is on the court and the result of a receive, save, or set by an ally is not a BAD result, Terushima Yuji gains 1 stack of the [Play More, Play More] effect. Each stack increases [Power Attack/Quick Attack] by 2.5%. Up to 4 stacks."},{nome:"Fun Serve",descricao:"Terushima Yuji performs a jump serve with 120%/135%/150% of [Serve] as power."},{nome:"Asoviva",descricao:"For each receiving team member on the team's court, Terushima Yuji's [Receive] increases by 4%/5%/6%. If he misses a receive, no points are lost. The cooldown for this effect lasts until the ball has crossed the net 10 times."},{nome:"Exciting Spike",descricao:"Terushima Yuji hits a powerful spike with 235%/250%/265%/280%/295% of [Power Attack] as power. If this scores a point, the [Receive] of allies will increase by 10%. This effect will last until the ball has crossed the net 3 times."}], symbols: [ "img/powersymbol.png", "img/servesymbol.png" ] },
{ nome: "Atsumu UR",data: "10/14/25", funcao: "S", img: "img/atsumuUR.png", School: "Inarizaki", vinculo: ["Twin Power", "Twin Heads"],Stats:{Serve:1705,Spike:1539,Set:1629,Receive:1376,Block:1530,Save:1290}, habilidades:[{nome:"Unpredictable Play",descricao:"When Miya Atsumu performs a serve, if the serve is aimed at a weak spot in the opposing team's defense, the power of that serve is increased by 30%/40%/50% of [Serve] Stat as power. When the serve is not aimed at a weak spot in the opposing team's defense, the [Receive] of your back row players increases by 10%/12%/14%. This effect lasts for one rally (one full point)."}, {nome:"Delicate Set",descricao:"Miya Atsumu will set with 125%/140%/155% of [Set] as power. This set resets all debuffs of the player who spikes (Power Attack/Quick Attack)."}, {nome:"Devoted and Sincere Set",descricao:"Increases Miya Atsumu's [Set] by 8%/11%/14%. When one of your players performs an action, and the result is not Perfect, Miya Atsumu gains two stacks of [Perfect Timing]. Each stack of [Perfect Timing] increases [Set] by 2%, with a maximum of 10 stacks. When Miya Atsumu sets, he consumes one stack of [Perfect Timing], increasing the [Attack Technique] and [Quick Attack] Stats of the player who spikes (Power Attack/Quick Attack) by 2.5. This effect lasts for 10 net crossings."}, {nome:"Twin Swords Serve",descricao:"Miya Atsumu alternates between a Jump Serve and a Jump Float Serve. Jump Float Serve: Miya Atsumu performs a Jump Float Serve with 230%/245%/275%/290% of [Serve] as power. Opposing players cannot use [Power Attack] or [Quick Attack] ultimates. This effect lasts for 2 net crossings. Jump Serve: Miya Atsumu performs a Jump Serve with 260%/275%/290%/305%/320% of [Serve] as power. For every 3 Team Morale, Miya Atsumu's [Awareness] will increase by 1%. This effect lasts for 2 net crossings."}], symbols: [ "img/quicksymbol.png", "img/servesymbol.png", "img/settersymbol.png" ] },
{ nome: "Osamu UR",data: "10/29/25", funcao: "OP", img: "img/osamuUR.png", School: "Inarizaki", vinculo: ["Twin Power", "Twin Heads"],Stats:{Serve:1621, Spike:1685, Set:1426, Receive:1459, Block:1428, Save:1373}, habilidades:[{nome:"Flexible Offense",descricao:"Increases Miya Osamu's [Quick Attack] by 10%/12%/14%. Beginning of match: Miya Osamu's [Awareness] decreases to 0%, and for every 1% decrease, Miya Osamu's [Attack Technique] increases by 1%. Note: Stacking Osamu's Awareness should be priority for this skill alone."}, {nome:"Cool Jump Serve",descricao:"Miya Osamu performs a Jump Serve with 120%/135%/150% of [Serve] Stat as power. If the opponent's receiver has the debuff [Suppression], Miya Osamu's [Attack Technique] is increased by 10%. This effect lasts for 8 net crossings."}, {nome:"Multi-talented",descricao:"Increases Miya Osamu's [Attack Technique] by 10%/13%/16%. When Miya Osamu performs an attack or serve, he inflicts one stack of the debuff [Suppression] on the opponent's back row players. (Players with the debuff [Suppression] have their [Receive] Stat reduced by 10%, per stack). This effect lasts for 10 net crossings."}, {nome:"Flexible Counter Attack",descricao:"Miya Osamu performs a quick attack with 260%/275%/290%/305%/320% of [Quick Attack] as power. Miya Osamu's [Quick Attack] Stat is increased by 40% of [Attack Technique]. This effect lasts for 2 net crossings. Note: This is influenced by the [Attack Technique] gained by Flexible Offense. Skill Resonance 2: When Miya Osamu performs a quick attack, if the opponent's receiver has the debuff [Suppression], the attack's power will increase by 60% of [Quick Attack] Stat. Skill Resonance 4: When Miya Osamu performs a quick attack, the next two time one of your side's players activates their ultimate, [Attack Technique] and [Defensive Technique] of that player will increase by 20%."}], symbols: [ "img/quicksymbol.png", "img/servesymbol.png" ] },
{ nome: "Kita SSR", funcao: "WS", img: "img/kitaSR.png", School: "Inarizaki", vinculo: ["Twin Heads"],Stats:{Serve:1238, Spike:1219, Set:1333, Receive:1476, Block:1198, Save:1409}, habilidades:[{nome:"Repetition, continuity, and caution",descricao:"Increases Kita Shinsuke's Basic Stats by 6%/8%/10%. If Kita's [Receive] result is BAD, Kita's [Defensive Technique] is increased by 80% of [Reflex] as power. Note: This is an increase of [Defensive Technique] by the value of [Reflex]."}, {nome:"Calm Play",descricao:"Kita Shinsuke performs a [Save] with 120%/135%/150% of [Save] Stat as power."}, {nome:"I'll Do It Properly",descricao:"Kita Shinsuke's [Receive] Stat is increased by 8%/10%/12%. Kita Shinsuke performs a [Receive]. If the [Receive] result is not Perfect, he gains 1 stack of [Reliable Action]. Each stack of [Reliable Action] increases Kita Shinsuke's [Receive] Stat by 3%, up to a maximum of 3 stacks. If Kita Shinsuke possesses 3 or stacks of [Reliable Action], consume 3 stacks of [Reliable Action] increase [Attack Technique] of your side's front row players by 10%. This effect lasts for 8 net crossings."}, {nome:"Solid Play",descricao:"Kita Shinsuke performs a [Receive] with 235%/250%/265%/280%/295% of [Receive] Stat power."}], symbols: [ "img/receivesymbol.png" ] },
{ nome: "Rintaro SSR", funcao: "MB", img: "img/rintaroSR.png", School: "Inarizaki", vinculo: [],Stats:{Serve:1266, Spike:1476, Set:1186, Receive:1258, Block:1324, Save:1318}, habilidades:[{nome:"Close The Course",descricao:"Increases Rintaro Suna's [Block] by 10%/12%/14%. When he is on the court and an opposing team member who spikes has the disadvantage effect of [Confusion], the power of the team's block increases by 15%/20%/25% of the blocking team member's [Block]."}, {nome:"Skilled Block",descricao:"Rintaro Suna blocks with 20%/35%/50% of the attack's power."}, {nome:"A Play that Catches the Opponent Off Guard",descricao:"Increases Rintaro Suna's [Quick Attack] by 10%/12%/14%. When he is on a quick attack, he inflicts 1 stack of the [Confusion] effect on the opponent's front line. For each stack of [Confusion], their [Block] is reduced by 10%. This effect lasts until the ball has crossed the net 8 times."}, {nome:"Spikes With a Wide Impact Point",descricao:"Rintaro Suna performs a quick attack with 240%/255%/270%/285%/300% of [Quick Attack] as power."}], symbols: [ "img/quicksymbol.png", "img/blocksymbol.png" ] },
/* ==missing Stats== */{ nome: "Oshiro SSR", funcao: "WS", img: "img/oshiroSR.png", School: "Inarizaki", vinculo: [],Stats:{Serve:1,Spike:2,Set:1,Receive:1,Block:1,Save:1}, habilidades:[{nome:"Rhythm Control",descricao:"Every time Oshiro Alan consumes 10 stamina, he gains 1 stack of [Quick Breather]. Each stack of [Quick Breather] effects increases [Attack Technique] by 3%/3.5%/4%. At the end of a rally, all [Quick Breather] effects are consumed. For every stack of [Breathing Time] that is consumed, Oshiro Alan reSaves 4 stamina."}, {nome:"Highly Skilled Serve",descricao:"Ojiro Alan performs a Jump Serve with 110%/125%/140% of [Serve] Stat as power. The opponent receiver will have their [Receive] reduced by 10%. This effect lasts for six net crossings."}, {nome:"Aggressive Assault",descricao:"Increases Oshiro Alan's [Power Attack] by 6%/8%/10% and [Serve] by 6%/8%/10%. When Oshiro Alan performs a Power Attack, 60% of his current stamina is consumed, and this power attack increases by 30%/40%/50% of [Power Attack] as power."}, {nome:"Thunderous Spike",descricao:"Ojiro Alan performs a power attack with 240%/255%/270%/285%/300% of [Power Attack] as power."}], symbols: [ "img/powersymbol.png", "img/servesymbol.png" ] },
/* ==missing Stats== */{ nome: "Akagi SSR", funcao: "L", img: "img/akagiSR.png", School: "Inarizaki", vinculo: [],Stats:{Serve:1,Spike:1,Set:1,Receive:2,Block:1,Save:1}, habilidades:[{nome:"Seriousness boosting save",descricao:"Increases Akagi Michinari's [Receive] and [Save] by 8%/10%/12%. Increases team morale by 10 when Akagi Michinari receives or Saves."}, {nome:"A reliable libero",descricao:"Akagi Michinari will Save with a power equal to 120%/135%/150% of [Save]. Increases the [Defensive Technique] of allies by 4%/6%/8%. This effect lasts until the ball has crossed the net 6 times."}, {nome:"Chase the ball with your hand",descricao:"Akagi Michinari's [Receive] is increased by 10%/12%/14%. When Akagi Michinari is on the court, an opposing member who hits a powerful shot will be inflicted with one stack of the [Approaching] disadvantage. For each stack of the [Approaching] disadvantage, [Approaching] will decrease [Power Attack] by 8%/10%/12%. This effect lasts until the ball goes over the net three times. When Akagi Michinari is on the court and an opposing member who hits a powerful shot already has the [Approaching] disadvantage, allied members' [Defensive Technique] will be increased by 4%/6%/8%. This effect lasts until the ball goes over the net three times."}, {nome:"Gutsy Receive",descricao:"Akagi Michinari receives with 240%/255%/270%/285%/300% of [Receive] as power."}], symbols: [ "img/receivesymbol.png" ] },
/* ==missing Stats== */{ nome: "Yui SSR", funcao: "WS", img: "img/yuiSR.png", School: "Inarizaki", vinculo: [],Stats:{Serve:1,Spike:2,Set:1,Receive:1,Block:1,Save:1}, habilidades:[{nome:"Stable Offense and Defense",descricao:"Increases Ginjima Yui's [Power Attack] by 6%/8%/10% and [Receive] by 6%/8%/10%. When Ginjima Yui receives, if the opponent performs a Power Attack, the power of this receive increases by [Receive] × 15%/25%/35%."}, {nome:"Powerful Receive",descricao:"Ginjima Yui receives with a power of [Receive] × 120%/135%/150%."}, {nome:"An Enthusiastic Attack",descricao:"Whenever there is one receiving member on the team, Ginjima Yui's [Attack Technique] increases by 2%/2.5%/3%. If the receiving result of the team member is not BAD, Ginjima Yui's [Power Attack] increases by 15%. This effect lasts until the ball goes over the net four times."}, {nome:"A Powerful Blow",descricao:"Ginjima Yui will perform a powerful attack with a power of [Power Attack] × 225%/240%/255%/270%/285%. If Ginjima Yui is in the rear guard, the power of this powerful attack will increase by [Power Attack] × 30%."}], symbols: [ "img/powersymbol.png", "img/receivesymbol.png" ] },
{ nome: "Hoshiumi UR",data: "12/13/25", funcao: "WS", img: "img/hoshiumiUR.png", School: "Kamomedai", vinculo: ["Longtime Friends"],Stats:{Serve:1621,Spike:1704,Set:1341,Receive:1541,Block:1581,Save:1305}, habilidades:[{nome:"Break The Chain",descricao:"When Hoshiumi Korai is on the court and an ally blocks, for every 50 of the blocking team members [Block], the power of the opponent's spike (Power Attack/Quick Attack) is reduced by the spiking team members [Power Attack/Quick Attack] × 0.3%/0.4%/0.5% (maximum 30%). For every 1% decrease in the opponent's spike power, the power of Hoshiumi Korai's next skill is increased by 1%."}, {nome:"Great Performance In All Areas",descricao:"Hoshiumi Korai can activate multiple play skills. These skills share a cooldown.\nSpike Serve: Performs a spike serve with the power of [Serve] × 140%/160%/180%.\nReceive: Receives with the power of [Receive] × 140%/160%/180%.\nBlock: Blocks with the power of [Block] × 140%/160%/180%."}, {nome:"No 1 Point Getter",descricao:"Increases Hoshiumi Korai's [Power Attack] by 16%/20%/24%. When <All-Rounded Exploitation> is activated, gain one stack of [All-Rounder]. When Hoshiumi Korai's skill is activated, the [All-Rounder] effect is consumed, and different effects are activated depending on the play.\nPowerful Blow: Increases [Attention] by 14%/17%/20% until the ball goes over the net twice.\nServe: Reduces the opponent's back row player's [Receive] by 14%/17%/20% until the ball goes over the net twice."}, {nome:"Shining Spear",descricao:"Performs a powerful attack with a power of [Power Attack] × 265%/280%/295%/310%/325%. If in the front line, the power of this attack is increased by [Power Attack] × 40%/45%/50%/55%/60%."}], symbols: [ "img/powersymbol.png", "img/servesymbol.png", "img/blocksymbol.png", "img/receivesymbol.png" ] },
{ nome: "Hirugami UR",data: "12/28/25", funcao: "MB", img: "img/hirugamiUR.png", School: "Kamomedai", vinculo: ["Longtime Friends"],Stats:{Serve:1660,Spike:1630,Set:1629,Receive:1540,Block:1742,Save:1493}, habilidades:[{nome:"The Core Of The Kamomedai System",descricao:"When Hirugami Sachiro serves, his [Attention] increases by 12%/16%/20%. When he is on the court, allies gain one stack of the [System] effect when blocking. Each stack increases allies' Basic stats by 8%, up to 5 stacks. Lasts until the ally scores. Each stack also increases Hirugami Sachiro's base Stats by an additional 10%."}, {nome:"A Psychologically Pressing Serve",descricao:"Performs a jump floater serve with a power of 140%/160%/180% of his [Serve]. If this play is a nice play, the opponent's team morale awakening ends, preventing them from gaining team morale with one rally."}, {nome:"Defense Is The Best Attack",descricao:"When Hirugami Sachiro is on the court, gain one stack of the [Strong Block] effect each time the ball goes over the net. When an ally blocks, effects depend on the number of [Strong Block] stacks.\n2 stacks: Block power increases by 15%/20%/25% of the blocking members' [Block] until the ball goes over the net twice.\n3 stacks: Receive power increases by 15%/20%/25% of the receiving members' [Receive]."}, {nome:"The Immovable God of Day",descricao:"Blocks with a power of [Block] × 260%/275%/290%/305%/320%. If the opponent hits a powerful blow, the block's power increases by [Block] × 40%/45%/50%/55%/60%."}], symbols: [ "img/servesymbol.png", "img/blocksymbol.png" ] },
{ nome: "Hayaseiomi UR",data: "08/10/26", funcao: "WS", img: "img/hayaseiomiUR.png", School: "Itachiyama", vinculo: ["Top Spiker and Top Libero"],Stats:{Serve:1774,Spike:2012,Set:1667,Receive:1928,Block:1699,Save:1656}, habilidades:[{nome:"Persistent Attack",descricao:"Kiyoomi Sakusa's [Power Hit] increases by 10%/12.5%/15%, and his [Receive] increases by 20%/22%/25%. When he receives an attack, [Power Attack] increases by 6%, stacking up to 3 times, lasting until his next Power Attack. When he hits a Powerful Shot, [Receive] increases by 15% until his next receive."}, {nome:"Take All Precautions",descricao:"Performs a [Receive] ×1 receive with 50%/70%/90% power. If receiving exceeds [Receiving] × 170%, [Reflex] increases by 10% and <Preparedness> cooldown is reduced by 2× the ball crossings. If receiving exceeds [Receiving] × 200%, [Defensive Technique] increases by 15%. Lasts until the match ends."}, {nome:"Top Spiker",descricao:"When on the court, if allies perform a Nice Play (receive, Save, block), gain a stack of [Perfectionism]. Each stack increases [Receive] and [Power Hit] by 6%, up to 20 stacks. When hitting, [Awareness] increases by 10% per stack. Lasts until the ball crosses the net twice."}, {nome:"Spikes that change trajectory by rotating",descricao:"Performs a [Power Hit] with power × 260%/280%/300%/320%/340%. If in the back row, power increases by [Power Hit] × 40%. If a Nice Play occurs, the opponent's next receive is reduced by [Receive] × 15%."}], symbols: [ "img/receivesymbol.png", "img/powersymbol.png" ] },
{ nome: "Komori UR",data: "09/09/26", funcao: "L", img: "img/komoriUR.png", School: "Itachiyama", vinculo: ["Top Spiker and Top Libero"],Stats:{Serve:1580,Spike:1579,Set:1904,Receive:2012,Block:1580,Save:1866}, habilidades:[{nome:"Key Person Of The Team",descricao:"When on the court, all allied backcourt players' [Defensive Technique] increases by 10%/13%/16%. Gains 6 stacks of [Connect to Next] at rally start; each stack increases [Set] by 3% and [Reflex] by 5%, up to 10 stacks."}, {nome:"Skillful Set",descricao:"Sets with power × 140%/160%/180% of [Set], increasing teammates' morale by 10. The first spike (Power Attack/Quick Attack) by an ally after this increases the spiker's [Attention] by 15% until the ball crosses the net twice."}, {nome:"Create The Flow Of The Game",descricao:"[Receive] increases by 12%/16%/20%. When an ally activates a non-special receive or Komori activates a receive special, consumes 2 stacks of [Connect to Next] to increase receive power by [Receive] × 30% and the first ally spike after this increases that spike's (Power Attack/Quick Attack) power by 20%."}, {nome:"Receive That Creates Momentum",descricao:"Receives with power × 260%/275%/290%/305%/320% of [Receive]. The first ally spike (Power Attack/Quick Attack) after this increases the spiker's [Attack Technique] by 20% until the ball crosses the net twice."}], symbols: [ "img/receivesymbol.png", "img/settersymbol.png" ] },
/* ==missing Stats== */{ nome: "Kuro SP", funcao: "MB", img: "img/kuroSP.png", School: "Nekoma", vinculo: ["Fireworks Festival","Brain and Commander SP"], Stats:{Serve:1,Spike:1,Set:1,Receive:1,Block:2,Save:1}, habilidades:[
  {nome:"The Command Tower That Cannot Be Beaten", descricao:"When Kuroo Tetsuro (Hanabi) is on the court, the [Spirit] of allied members in the same row as Kuroo Tetsuro (Hanabi) is increased by 20/25/30%. After he touches the ball, the power of the next play of the same type as Kuroo Tetsuro (Hanabi) is increased by 40% x the corresponding parameter of the member making the play. If Kuroo Tetsuro (Hanabi)’s play is a critical play, a random member on the opposing court will be given the [Rage] disadvantage (([Power Attack/Quick Attack] will be reduced by 10%)."},
  {nome:"Skillfull Receive", descricao:"Kuroo Tetsuro (Hanabi) performs a receive with power equal to [Receive] x 140/160/180%. If this play is a critical play, the power of this receive is increased by [Receive] x 20%."},
  {nome:"A Flawless, All-Around Player", descricao:"When Kuroo Tetsuro (Hanabi) is in the front/back row and touches the ball, his [Reflex] is increased by 50% x the [Reflex] of each other allied member in the front/back row (maximum 100%), and his [Spirit] is increased by 50% x the [Spirit] of each other allied member in the front/back row (maximum 100%). Furthermore, when Kuroo Tetsuro (Hanabi) is in the front line, the [Attack Technique] of allied members is increased by 14/17/20%, and his block power is increased by [Block] x 45%. Furthermore when Kuroo Tetsuro is in the back row, the [Defensive Technique] of allied members increases by 14/17/20%, and his receiving power increases by [Receive] x 45%."},
  {nome:"Unpleasant Block", descricao:"Kuroo Tetsuro (Hanabi) performs a block with the power of [Block] x 280/300/320/340/360%. If this block does not bounce the ball back into the opponents court, the first ally’s reception after this play will not result in a point. If this block bounces the ball back into the opponents court, the main stats of all allied members will increase by 15%. This effect lasts until the ball goes over the net 8 times."}
], symbols: [ "img/receivesymbol.png", "img/blocksymbol.png" ] }
];

const descricoesSinergia = {
"Karasuno": "Increases ALL players’ Power Attack and Quick Attack Stats by 10%",
"Nekoma": "Increases ALL players’ Receive Stat by 15%",
"Dateko": "Increases ALL players’ Block Stat by 15%",
"Aoba Johsai": "Increases ALL players’ Power Attack Stat by 15%",
"Shiratorizawa": "Increases ALL players’ Awareness and Strength Stats by 10%",
"Fukurodani": "Team Morale will increase by 20",
"Inarizaki": "Increases ALL players’ Strength and Defense Stats by 5%",
"Eccentric Duo": "Increases Hinata and Kageyama’s quick attack power and Awareness.",
"Karasuno Geniuses": "Increases Nishinoya SP’s reflex and Receive. When Nishinoya uses his special move, Kageyama UR gains one stack of Competitive Spirit*. If his special is a perfect play, the power of the first Spike (Power Attack or Quick Attack) after that play is increased by 20% of the attacker’s power",
"Cherry Blossom Viewing": "Increases Kenma SP’s Awareness. Increases Hinata SP’s Quick Attack if it is a perfect play",
"Sun vs Moon": "no info",
"After School": "Increases Nishinoya SP’s reflex; when his stamina is low, increases it even more",
"Guardian God and Wing Spiker": "When Nishinoya SSR or Azumane SSR use a skill, both increase their Attack Technique and Defense Technique",
"Kiyoko Squad": "When scoring, increases Team Morale",
"Brain and Commander": "When Kenma SSR makes a pass, Kuro UR performs a strengthened Quick Attack",
"Educational Guidance": "Increases Yaku SSR’s Receive and Lev SSR’s Quick Attack",
"Swimming": "(Activates with 3 players) Increases team morale. When team morale is active, increases allies’ reflex in double or triple blocks",
"The Silent and the Sarcastic": "Allows Aone SSR and Futakuchi SSR to use the Double Block skill",
"The New Captain and the Tall Rookie": "Increases the Block of players in the front row",
"Perfect Harmony": "When Oikawa UR makes a pass, Iwaizumi SSR Spikes with increased Power Attack. Gains 2 stacks of Attack Rhythm*, each stack increases the team’s Awareness by 1%. Maximum of 10 stacks.",
"The Pack": "Increases Power Attack of Iwaizumi SSR and Kentaro SSR",
"Besties for Life": "Increases Ushijima UR’s Power Attack and Tendo SSR’s Defense Technique",
"Absolute Champion and Steady Setter": "When Shirabu SSR makes a pass, Ushijima UR Spikes with 10% more power",
"Shiratorizawa’s WS": "Increases Power Attack of ALL players present",
"Miracle Ace and Caring Setter": "Bokuto UR comes out of depression. When Akaashi SSR makes a pass and Bokuto UR Spikes, increases his Power Attack for that Spike by 20% and raises team morale by 15",
"Ace Miraculous and Caring Setter": "Increases Akaashi SP’s Passing. When team morale is active, increases Bokuto SP’s Power Attack by 18% and Akaashi SP’s Passing by 5%",
"Twin Power": "When Atsumu UR makes a pass and Osamu UR makes a Minus Tempo Quick Attack, increases the Quick Attack of that play. Increases Attack Technique by 15%. The attack cannot be blocked.",
"Twin Heads": "Increases Osamu UR’s Attack Technique. Increases Kita SSR’s Stats. At the start of the match Atsumu gains 3 stacks of Perfect Hit*, each increasing his Passing by 2%. Max 10 stacks. Kita SSR gains a similar buff that increases his Receive. Max 3 stacks. The twins’ first Quick Attack per set is increased by Quick Attack × 12%",
"Longtime Friends": "Increases Hoshiumi UR’s Stats. Increases Block for front-row players. Hoshiumi UR and Hirugami UR gain a buff (no info)",
"Top Spiker and Top Libero": "Sakusa UR increases his Power Attack. Komori UR increases his Receive. Increases allies’ Receive by 20%",
"Fireworks Festival": "Allies’ main stats increase by 6%.At the end of each rally, inflict [Angry] on the opponent’s front row (their [Power Spike]/[Quick Attack] –10%).This lasts until the ball has crossed the net 8 times.If a target already has [Angry], apply [Distracted] instead (their [Power Spike]/[Quick Attack] –20%).This also lasts until the ball has crossed the net 8 times.[Distracted] cannot be cleansed/removed.",
"Brain and Commander SP": "When Kenma SP and Kuro SP are on court, can activate the quick attack skill Brain and Commander*"
  
};
    
/** Catálogo de MEMÓRIAS (exemplos; ajuste/expanda à vontade) */
const memoryCatalog = [
  {
    id:"mem_op",
    name:"Memória de OP",
    positions:["OP"],
    bonus:{
      Serve:{flat:518}, Spike:{flat:663}, Set:{flat:461},
      Receive:{flat:663}, Block:{flat:605}, Save:{flat:490}
    },
    desc:"When a member with this memory plays for the first time in each set, their [Receive] increases by 24%. This effect lasts for 3 rallies.",
    img:"img/memories/MemoOP.png"
  },
  {
    id:"mem_l",
    name:"Memória de L",
    positions:["L"],
    bonus:{
      Serve:{flat:490}, Spike:{flat:518}, Set:{flat:605},
      Receive:{flat:663}, Block:{flat:461}, Save:{flat:663}
    },
    desc:"The main parameters of the member who has this memory set will increase by 6.4%.If the corresponding member's receive result is not BAD, the power of the next powerful hit of the ally will be increased by [Power Hit] x 24% of the member performing the powerful hit.",
    img:"img/memories/MemoL.png"
  },
  {
    id:"mem_ws",
    name:"Memória de WS",
    positions:["WS"],
    bonus:{
      Serve:{flat:605}, Spike:{flat:663}, Set:{flat:461},
      Receive:{flat:663}, Block:{flat:518}, Save:{flat:490}
    },
    desc:"The member who has this memory set will have their [Power Hit] increased by 12%.When the affected member hits a powerful shot, the opposing member's [Block] will be reduced by 6.4%. This effect will last until the ball goes over the net once.If the opponent's block result for this play is BAD, the opposing team member who blocked will have their [Block] reduced by 6.4%. This effect lasts until the ball goes over the net twice.",
    img:"img/memories/MemoWS.png"
  },
  {
    id:"mem_s",
    name:"Memória de S",
    positions:["S"],
    bonus:{
      Serve:{flat:663}, Spike:{flat:518}, Set:{flat:663},
      Receive:{flat:490}, Block:{flat:605}, Save:{flat:461}
    },
    desc:"When a member with this memory is on the court, the [Toss] of allied members will increase by 8%.Once per set, when a member's stamina drops below 30, that member's stamina will be restored by 24.",
    img:"img/memories/MemoS.png"
  },
  {
    id:"mem_mb",
    name:"Memória de MB",
    positions:["MB"],
    bonus:{
      Serve:{flat:605}, Spike:{flat:663}, Set:{flat:461},
      Receive:{flat:518}, Block:{flat:663}, Save:{flat:490}
    },
    desc:"The [Quick Attack] of the member who has this memory set is increased by 12%.For each Block member in the opponent's front line, that member's [Quick Attack] increases by an additional 6.4%",
    img:"img/memories/MemoMB.png"
  },
  {
    id:"mem_up_consciencia_wakatoshi_ushijima",
    name:"Ushijima UR",
    positions:["OP"],
    bonus:{
      Serve:{flat:570}, Spike:{flat:729}, Set:{flat:507},
      Receive:{flat:729}, Block:{flat:665}, Save:{flat:539}
    },
    desc:"The [Awareness] of the member who sets this memory is increased by 20%. If the member's [Awareness] exceeds 20%, for every 1% increase in [Awareness], [Power] increases by 1% (up to 100%).",
    img:"img/memories/MemoUshijimaUR.png"
  },
  {
    id:"mem_ofensive_up_osamu_miya",
    name:"Osamu UR",
    positions:["OP"],
    bonus:{
      Serve:{flat:570}, Spike:{flat:729}, Set:{flat:507},
      Receive:{flat:729}, Block:{flat:665}, Save:{flat:539}
    },
    desc:"The [Quick Attack] of the member who has this memory set is increased by 24%. If the member's [Attack Technique] exceeds 40%, the [Quick Attack] increases × Quick Attack by 48%.",
    img:"img/memories/MemoOsamuUR.png"
  },
  {
    id:"mem_receba_reforco_hard_hit_daichi_sawamura",
    name:"Daichi SSR",
    positions:["OP"],
    bonus:{
      Serve:{flat:518}, Spike:{flat:663}, Set:{flat:461},
      Receive:{flat:663}, Block:{flat:605}, Save:{flat:490}
    },
    desc:"The [Receive] of the member who has this memory set is increased by 20%. If the member is on the court, gain 1 stack of [Guts] effect every time your Power-type member consumes 20 stamina. Each stack increases Power Spike power by 4% of Power Attack stat, up to 10 stacks",
    img:"img/memories/MemoDaichiSSR.png"
  },
  {
    id:"mem_reacao_para_cima_akinori_konoha",
    name:"Konoha SSR",
    positions:["OP"],
    bonus:{
      Serve:{flat:518}, Spike:{flat:663}, Set:{flat:461},
      Receive:{flat:663}, Block:{flat:605}, Save:{flat:490}
    },
    desc:"The main parameters of the members who set this memory have increased by 12%. The member's [Reflex] increases the morale of × allies' team by 10%. While an ally has activated Team Morale Awakening, that member's [Reflex] is increased by 8%.",
    img:"img/memories/MemoKonohaSSR.png"
  },
  {
    id:"mem_ofensive_up_kentaro_kyotani",
    name:"Kentaro MAD DOG SSR",
    positions:["OP"],
    bonus:{
      Serve:{flat:518}, Spike:{flat:663}, Set:{flat:461},
      Receive:{flat:663}, Block:{flat:605}, Save:{flat:490}
    },
    desc:"If the member with this memory is on the court, the [Power] of the friendly hitting member is increased by 12%. When the member is on the court and the opponent's Stamina is below 60, the opponent's [Block] is reduced by 16%. This effect lasts until the ball crosses the net 3 times, and can be activated once per set per member",
    img:"img/memories/MemoKentaroSSR.png"
  },
  {
    id:"mem_param_main_e_hard_hit_takehito_sasaya",
    name:"Sasaya SSR",
    positions:["OP"],
    bonus:{
      Serve:{flat:518}, Spike:{flat:663}, Set:{flat:461},
      Receive:{flat:663}, Block:{flat:605}, Save:{flat:490}
    },
    desc:"The [Power Attack] and [Block] of the members who set this memory are increased by 12%. If the score is led by the opponent, the member's spike power increases by 28% × [Power Attack].",
    img:"img/memories/MemoSasayaSSR.png"
  },
  {
    id:"mem_defense_up_yu_nishinoya_depois_da_escola",
    name:"Nishinoya SP",
    positions:["L"],
    bonus:{
      Serve:{flat:619}, Spike:{flat:656}, Set:{flat:765},
      Receive:{flat:838}, Block:{flat:583}, Save:{flat:838}
    },
    desc:"The member who has this memory set will have their [Receive] increased by 24%. When the corresponding member's special move is activated, [Reflex] increases by 1.2% and [Spirit] increases by 2.4%. Up to 5 stacks. If the member uses a special move more than twice during a rally, the member's stamina will be restored by 10, and the next time the member uses a special move, their [Defensive Technique] will increase by 16%. This effect will last until the ball goes over the net twice.",
    img:"img/memories/MemoNishinoyaSP.png"
  },
  {
    id:"mem_defense_offensive_up_motoya_komori",
    name:"Komori UR",
    positions:["L"],
    bonus:{
      Serve:{flat:619}, Spike:{flat:656}, Set:{flat:838},
      Receive:{flat:838}, Block:{flat:583}, Save:{flat:765}
    },
    desc:"The member who has this memory set will have their [Receive] increased by 24%. When the corresponding member receives, the [Defensive Technique] of the allied rear guard will increase by 2%. Up to 3 stacks. If the relevant member is on the court, when an ally member activates a receiving skill, the receiving member recovers 2 stamina and increases [Powerful Hit/Quick Attack] by 15%. This effect lasts until the ball goes over the net twice.",
    img:"img/memories/MemoKomoriUR.png"
  },
  {
    id:"mem_defense_up_yu_nishinoya",
    name:"Nishinoya SSR",
    positions:["L"],
    bonus:{
      Serve:{flat:490}, Spike:{flat:518}, Set:{flat:605},
      Receive:{flat:663}, Block:{flat:461}, Save:{flat:663}
    },
    desc:"If the member who has this memory set is on the court, increases your side's back row players' Save stat by 8%. If the equipper's stamina consumption is 8 or more when the receive skill is activated, the equipper's [Receiving] increases by 20% and recovers 2 stamina",
    img:"img/memories/MemoNishinoyaSSR.png"
  },
  {
    id:"mem_receba_morisuke_yaku",
    name:"Yaku SSR",
    positions:["L"],
    bonus:{
      Serve:{flat:490}, Spike:{flat:518}, Set:{flat:605},
      Receive:{flat:663}, Block:{flat:461}, Save:{flat:663}
    },
    desc:"When a member with this memory sets receives, [Receive] increases by 4%. Up to 5 stacks. If the member's receive result is PERFECT, the next quick attack power after an ally increases the [Quick Attack] × of the member who is fast attacking by 32%.",
    img:"img/memories/MemoYakuSSR.png"
  },
  {
    id:"mem_receba_haruki_komi",
    name:"Haruki SSR",
    positions:["L"],
    bonus:{
      Serve:{flat:490}, Spike:{flat:518}, Set:{flat:605},
      Receive:{flat:663}, Block:{flat:461}, Save:{flat:663}
    },
    desc:"The [Receive] and [Save] of the members who set this memory increased by 16%. If the member's receive or cover result is not BAD, the team's morale increases by 10. In addition, the power of the next Power Spike of an ally increases the [Power Spike] of the member × Power Spike' stat by 10%.",
    img:"img/memories/MemoHarukiSSR.png"
  },
  {
    id:"mem_receba_yamagata_hayato",
    name:"Memo Yamagata SSR",
    positions:["L"],
    bonus:{
      Serve:{flat:490}, Spike:{flat:518}, Set:{flat:605},
      Receive:{flat:663}, Block:{flat:461}, Save:{flat:663}
    },
    desc:"The [Receive] of the member who has this memory set is increased by 20%. When the member activates the receiving special move, [Reflex] is increased by 12%.",
    img:"img/memories/MemoYamagataSSR.png"
  },
  {
    id:"mem_defense_up_michinari_akagi",
    name:"Memo Akagi SSR",
    positions:["L"],
    bonus:{
      Serve:{flat:490}, Spike:{flat:518}, Set:{flat:605},
      Receive:{flat:663}, Block:{flat:461}, Save:{flat:663}
    },
    desc:"The [Receive] of the member who has this memory set is increased by 20%. If the member's receiving or save result is not BAD, the friendly member's [Defensive Technique] is increased by 16%. Up to 3 stacks. This effect lasts for 1 rally",
    img:"img/memories/MemoAkagiSSR.png"
  },
  {
    id:"mem_power_up_shouyou_hinata_hanami",
    name:"Hinata SP",
    positions:["MB"],
    bonus:{ Serve:{flat:619}, Spike:{flat:838}, Set:{flat:656}, Receive:{flat:838}, Block:{flat:765}, Save:{flat:583} },
    desc:"Increases the [Power] of the member who has this memory set by 24%. If the member's quick attack is a nice play, increase the [Power] of the member by 2%. Up to 5 stacks. If the team member's quick attack is a good play and the opponent's blocker does not touch the ball, the opponent's front line's [Reflex] and [Spirit] will be reduced by 8% and 8%, respectively. This effect will last until the ball goes over the net 10 times.",
    img:"img/memories/MemoHinataSP.png"
  },
  {
    id:"mem_hast_attack_block_up_tsukishima_firefly_display_de_fogos_de_artificio",
    name:"Tsuki SP",
    positions:["MB"],
    bonus:{ Serve:{flat:619}, Spike:{flat:838}, Set:{flat:656}, Receive:{flat:765}, Block:{flat:838}, Save:{flat:583} },
    desc:"The [Quick Attack] of the member who has this memory set is increased by 24%. If the member makes a nice play, [Block] is increased by 9%. Up to 3 stacks. Randomly inflicts the [Suppress] disadvantage effect on one member on the opponent's court (main stats are reduced by 5%). This effect lasts until the ball goes over the net 8 times.",
    img:"img/memories/MemoTsukiSP.png"
  },
  {
    id:"mem_kurosp",
    name:"Kuro SP",
    positions:["MB"],
    bonus:{ Serve:{flat:765}, Spike:{flat:656}, Set:{flat:619}, Receive:{flat:838}, Block:{flat:838}, Save:{flat:583} },
    desc:"The [Block] is increased by 12%. When the corresponding member blocks or receives, if the member on the opponent's court has a disadvantageous effect, the corresponding member's [Defensive Technique] is increased by 20%. This effect lasts until the ball goes over the net four times",
    img:"img/memories/MemoKuroSP.png"
  },
  {
    id:"mem_tecnica_de_defesa_bloqueio_takashi_aone_banho_de_mar",
    name:"Aone SP",
    positions:["MB"],
    bonus:{ Serve:{flat:838}, Spike:{flat:765}, Set:{flat:656}, Receive:{flat:619}, Block:{flat:838}, Save:{flat:583} },
    desc:"The [Defensive Technique] of the member who has this memory set increases by 12.8%. When this member participates in a 2- or 3-man block, the [Block] of the allied front line is increased by 12%. This effect lasts until the ball goes over the net twice. When the member blocks, if this play results in a 2/3 block, the member's [Block] will be increased by an additional 15%. This effect lasts until the ball goes over the net twice.",

    img:"img/memories/MemoAoneSP.png"
  },
  {
    id:"mem_hast_attack_blockup_tetsuro_kuroo",
    name:"Kuro UR",
    positions:["MB"],
    bonus:{ Serve:{flat:665}, Spike:{flat:729}, Set:{flat:507}, Receive:{flat:570}, Block:{flat:729}, Save:{flat:539} },
    desc:"The member who has this memory set will have their [Block] increased by 24%.Each time the member gains the [Quick Attack] boost from a member skill, they gain one stack of [Tighten]. Each stack of [Tighten] increases [Block] by 2.4%. Up to 10 stacks. When the corresponding member's Block Special Move is activated, 10 stacks of the [Constrict] effect are consumed, and the cooldown of the corresponding member's Block Special Move is reduced by 10 times the ball has gone over the net.",
    img:"img/memories/MemoKuroUR.png"
  },
  {
    id:"mem_block_up_hirugami_yukoro",
    name:"Hirugami UR",
    positions:["MB"],
    bonus:{ Serve:{flat:729}, Spike:{flat:665}, Set:{flat:507}, Receive:{flat:570}, Block:{flat:729}, Save:{flat:539} },
    desc:"The member who has this memory set will have their [Block] increased by 20%. When an ally scores, their [Block] is increased by 4.8%. Up to 3 stacks. If an ally has the [Strong Block] effect, when they block, their [Defensive Technique] increases by 2.4%. This effect lasts until the ball goes over the net four times. Up to 3 stacks.",
    img:"img/memories/MemoHirugamiUR.png"
  },
  {
    id:"mem_increase_consciousness_shoyo_hinata",
    name:"Hinata SSR",
    positions:["MB"],
    bonus:{ Serve:{flat:605}, Spike:{flat:663}, Set:{flat:461}, Receive:{flat:518}, Block:{flat:663}, Save:{flat:490} },
    desc:"The [Awareness] of the members who set this memory is increased by 16%. If the member's [Awareness] is 40% or higher, [Awareness] is increased by an additional 16% and Blocked is reduced by 8%.",
    img:"img/memories/MemoHinataSSR.png"
  },
  {
    id:"mem_block_up_tsukishima",
    name:"Tsuki SSR",
    positions:["MB"],
    bonus:{ Serve:{flat:605}, Spike:{flat:663}, Set:{flat:461}, Receive:{flat:518}, Block:{flat:663}, Save:{flat:490} },
    desc:"The [Block] of the member who has this memory set is increased by 20%. When the member activates the blocking special move, if the opponent member who has made a spike (power/quick attack) has a disadvantageous effect, the power of this block increases by 32% × that member's [Block]",
    img:"img/memories/MemoTsukiSSR.png"
  },
  {
    id:"mem_offensive_up_tetsuro_kuroo_pratica",
    name:"Kuro SSR",
    positions:["MB"],
    bonus:{ Serve:{flat:605}, Spike:{flat:663}, Set:{flat:461}, Receive:{flat:518}, Block:{flat:663}, Save:{flat:490} },
    desc:"The [Awareness] of the members who set this memory is increased by 16%. When the member is blocked, [Defensive Technique] increases by 24% of their Strength.",
    img:"img/memories/MemoKuroSSR.png"
  },
  {
    id:"mem_block_up_tatsuo",
    name:"Tatsuo SSR",
    positions:["MB"],
    bonus:{ Serve:{flat:605}, Spike:{flat:663}, Set:{flat:461}, Receive:{flat:518}, Block:{flat:663}, Save:{flat:490} },
    desc:"The [Block] of the member who has this memory set is increased by 24%. When the member blocks, if the opponent's spike (power/quick attack) becomes a nice play, this block will definitely be a nice play. If the result of this block is not BAD, the member's [Block] will be increased by 5%. Up to 3 stacks",
    img:"img/memories/MemoTatsuoSSR.png"
  },
  {
    id:"mem_receive_up_ataque_rapido_reforco_haiba_lev",
    name:"Lev SSR",
    positions:["MB"],
    bonus:{ Serve:{flat:605}, Spike:{flat:663}, Set:{flat:461}, Receive:{flat:518}, Block:{flat:663}, Save:{flat:490} },
    desc:"If the member who has this memory set is on the court, the [Receive] of the teammate defender is increased by 12%. If the member is on the court and the ally's receive result is PERFECT, the power of the member's next quick attack special move increases by 24% × [Quick Attack] ",
    img:"img/memories/MemoLevSSR.png"
  },
  {
    id:"mem_defense_up_takanobu_aone",
    name:"Aone SSR",
    positions:["MB"],
    bonus:{ Serve:{flat:605}, Spike:{flat:663}, Set:{flat:461}, Receive:{flat:518}, Block:{flat:663}, Save:{flat:490} },
    desc:"The [Defensive Technique] of the members who set this memory has increased by 16%. If the member's block result is not BAD, the opponent's stamina is reduced by 2 after the spike (slam/quick attack). If the opponent's member who made the spike is a Power spike member, they lose 1 more stamina.",
    img:"img/memories/MemoAoneSSR.png"
  },
  {
    id:"mem_block_up_tendo_satoru",
    name:"Tendo SSR",
    positions:["MB"],
    bonus:{ Serve:{flat:605}, Spike:{flat:663}, Set:{flat:461}, Receive:{flat:518}, Block:{flat:663}, Save:{flat:490} },
    desc:"The [block] of the member who has this memory set is increased by 28%. If the member's block becomes a nice play, the cooldown of the block's special move is reduced by 3 times the ball goes over the net",
    img:"img/memories/MemoTendoSSR.png"
  },
  {
    id:"mem_fast_attack_up_rintaro_suna",
    name:"Rintaro SSR",
    positions:["MB"],
    bonus:{ Serve:{flat:605}, Spike:{flat:663}, Set:{flat:461}, Receive:{flat:518}, Block:{flat:663}, Save:{flat:490} },
    desc:"The [Quick Attack] of the member who has this memory set is increased by 20%. If the opponent's blocking member has a disadvantage when the member attacks quickly, the power of this quick attack increases by 40% × that member's [Quick Attack].",
    img:"img/memories/MemoRintaroSSR.png"
  },
    {
id:"mem_akaashi_sp",
name:"Akaashi SP",
positions:["S"],
bonus:{ Serve:{flat:838}, Spike:{flat:656}, Set:{flat:838}, Receive:{flat:619}, Block:{flat:765}, Save:{flat:583} },
desc:"[Set] increases by 24% for the equipper. While an ally's Team Morale Awakening is active, the equipper's [Awareness] increases by 10%. Allies who have the [Excellent Condition] effect gain +15% to their Main Parameter. When an ally loses the [Excellent Condition] effect, all allies' [Reaction] increases by 10% until the ball crosses the net 8 times.",
img:"img/memories/MemoAkaashiSP.png"
},
  {
id:"mem_sugawara_sp",
name:"Sugawara SP",
positions:["S"],
bonus:{ Serve:{flat:838}, Spike:{flat:656}, Set:{flat:838}, Receive:{flat:619}, Block:{flat:765}, Save:{flat:583} },
desc:"The equipper's Main Parameter increases by 16%. When the equipper performs a Set, for every 6 current Stamina they have, the spiker's [Power/Quick Attack] increases by 2% (up to 30%). This effect lasts until the ball crosses the net twice. When the equipper activates a Skill and Stamina is consumed, restore 10 Stamina to the ally with the lowest Stamina.",
img:"img/memories/MemoSugawaraSP.png"
},
  {
id:"mem_kenma_sp",
name:"Kenma SP",
positions:["S"],
bonus:{ Serve:{flat:765}, Spike:{flat:656}, Set:{flat:838}, Receive:{flat:838}, Block:{flat:619}, Save:{flat:583} },
desc:"[Reaction] increases by 16%. When an opponent's Power/Quick Spike is a Nice Play, an ally who activates a Block or Receive skill gains 1 stack of [Stick]; for each stack, [Reaction] increases by 4% (max 3 stacks). If such an ally has 3 stacks, consume them to increase that ally's [Reaction] by 100% until the ball crosses the net once.",
img:"img/memories/MemoKenmaSP.png"
},
  {
id:"mem_oikawa_ur",
name:"Oikawa UR",
positions:["S"],
bonus:{ Serve:{flat:729}, Spike:{flat:570}, Set:{flat:729}, Receive:{flat:539}, Block:{flat:665}, Save:{flat:507} },
desc:"[Serve] increases by 24%. When this member's serve is a [Nice Play], gain 2 stacks of [Rhythm of Attack]. For each stack, allies on the court gain +1% [Awareness], up to 10 stacks. If this serve results in a service ace, gain 4 additional stacks. While this member is on the court, each time [Rhythm of Attack] reaches 6 stacks, allies' [Power] and [Mental] increase by 4%, up to 3 stacks.",
img:"img/memories/MemoOikawaUR.png"
},
  {
id:"mem_kageyama_ur",
name:"Kageyama UR",
positions:["S"],
bonus:{ Serve:{flat:729}, Spike:{flat:570}, Set:{flat:729}, Receive:{flat:539}, Block:{flat:665}, Save:{flat:507} },
desc:"[Set] increases by 24%. When this member activates a Two Attack skill, their [Power] increases by 40% of [Awareness], up to +100%. Also, when this member activates a Two Attack skill, the power of the next ally Spike (Power/Quick) increases by 28% of the spiking member's [Power/Quick Attack].",
img:"img/memories/MemoKageyamaUR.png"
},
  {
id:"mem_atsumu_ur",
name:"Atsumu UR",
positions:["S"],
bonus:{ Serve:{flat:729}, Spike:{flat:570}, Set:{flat:729}, Receive:{flat:539}, Block:{flat:665}, Save:{flat:507} },
desc:"[Set] increases by 24%. While the equipper is on the court, allies on the court whose [Awareness] and [Reaction] are below 20% gain +6.4% to [Attack Technique] and [Defense Technique]. If an ally's play is not a [Nice Play], the equipper's [Attack Technique] and [Defense Technique] increase by 2% per stack (max 5 stacks), lasting for 1 rally.",
img:"img/memories/MemoAtsumuUR.png"
},
  {
id:"mem_kageyama_ssr_serve",
name:"Kageyama SSR",
positions:["S"],
bonus:{ Serve:{flat:663}, Spike:{flat:518}, Set:{flat:663}, Receive:{flat:490}, Block:{flat:605}, Save:{flat:461} },
desc:"[Serve] increases by 20%. When this member activates a Two Attack Ultimate, allies' [Awareness] increases by 20%, and this member's [Awareness] increases by an additional 15%.",
img:"img/memories/MemoKageyamaSSR.png"
},
  {
id:"mem_kenma_ssr",
name:"Kenma SSR",
positions:["S"],
bonus:{ Serve:{flat:663}, Spike:{flat:518}, Set:{flat:663}, Receive:{flat:490}, Block:{flat:605}, Save:{flat:461} },
desc:"[Set] increases by 8%. While the equipper is on the court, back-row allies' [Receive] increases by 12%. While the equipper is on the court, when an ally's [Connect] stacks decrease, allies gain 1 stack of [Connect]; for each stack, allies on the court gain +1% [Receive], up to 6 stacks.",
img:"img/memories/MemoKenmaSSR.png"
},
  {
id:"mem_akaashi_ssr",
name:"Akaashi SSR",
positions:["S"],
bonus:{ Serve:{flat:663}, Spike:{flat:518}, Set:{flat:663}, Receive:{flat:490}, Block:{flat:605}, Save:{flat:461} },
desc:"[Set] increases by 12%. While an ally's Team Morale Awakening is active, when this member performs a Set, the spiking ally (Power/Quick) recovers 4 Stamina and that Spike gains +16% [Attack Technique]. When this member dispels an ally's debuff, also remove that ally's [Slump Mode] effect.",
img:"img/memories/MemoAkaashiSSR.png"
},
  {
id:"mem_oikawa_ssr",
name:"Oikawa SSR",
positions:["S"],
bonus:{ Serve:{flat:663}, Spike:{flat:518}, Set:{flat:663}, Receive:{flat:490}, Block:{flat:605}, Save:{flat:461} },
desc:"[Set] increases by 20%. The first time in each set that allies' [Rhythm of Attack] reaches 10 or more stacks, this member's [Set] increases by an additional 20% (lasts for 1 set). For each stack of [Rhythm of Attack], allies on the court gain +1% [Awareness], up to 10 stacks.",
img:"img/memories/MemoOikawaSSR.png"
},
  {
id:"mem_koganegawa_ssr",
name:"Koganegawa SSR",
positions:["S"],
bonus:{ Serve:{flat:663}, Spike:{flat:518}, Set:{flat:663}, Receive:{flat:490}, Block:{flat:605}, Save:{flat:461} },
desc:"[Set] increases by 16%. While the equipper is on the court, if an ally's Block result is not [BAD], the opponent's next Power Spike power decreases by 20% of the spiking member's [Power Attack]. While the equipper is on the court, if an ally's Block result is [BAD], the power of the next ally Block increases by 32% of the blocking member's [Block].",
img:"img/memories/MemoKoganegawaSSR.png"
},
  {
id:"mem_shirabu_ssr",
name:"Shirabu SSR",
positions:["S"],
bonus:{ Serve:{flat:663}, Spike:{flat:518}, Set:{flat:663}, Receive:{flat:490}, Block:{flat:605}, Save:{flat:461} },
desc:"[Set] increases by 16%. When this member's Set is a [Nice Play], the ally performing a Power Spike gains +32% [Power] until the ball crosses the net once.",
img:"img/memories/MemoShirabuSSR.png"
},
  {
id:"mem_semi_ssr",
name:"Semi SSR",
positions:["S"],
bonus:{ Serve:{flat:663}, Spike:{flat:518}, Set:{flat:663}, Receive:{flat:490}, Block:{flat:605}, Save:{flat:461} },
desc:"When this member serves, [Awareness] increases by 16%. When this member activates a Serve Ultimate, [Serve] increases by 6.4%, up to 3 stacks.",
img:"img/memories/MemoSemiSSR.png"
},
    {
    id:"mem_bokuto_sp",
    name:"Bokuto SP",
    positions:["WS"],
    bonus:{ Serve:{flat:765}, Spike:{flat:838}, Set:{flat:583}, Receive:{flat:838}, Block:{flat:656}, Save:{flat:619} },
    desc:"The [Power] of the member who has this memory set is increased by 24%. When the corresponding member hits hard, [Attack Technique] increases by 5%. If the remaining duration of an ally's Team Morale Awakening is 6 or more ball touches, [Attack Technique] is increased by an additional 20%.",
    img:"img/memories/MemoBokutoSP.png"
},
  {
    id:"mem_offense_defense_up_hoshiumi_ur",
    name:"Hoshiumi UR",
    positions:["WS"],
    bonus:{ Serve:{flat:665}, Spike:{flat:729}, Set:{flat:507}, Receive:{flat:729}, Block:{flat:570}, Save:{flat:539} },
    desc:"[Attack Technique] and [Defense Technique] increase by 6.4%. When the member's Skill/Special is activated, their [Main Parameter] increases by 2% (max 10 stacks). If the play is a [Nice Play], gain 1 additional stack.",
    img:"img/memories/MemoHoshiumiUR.png"
},
  {
    id:"mem_bokuto_ur",
    name:"Bokuto UR",
    positions:["WS"],
    bonus:{ Serve:{flat:665}, Spike:{flat:729}, Set:{flat:507}, Receive:{flat:729}, Block:{flat:570}, Save:{flat:539} },
    desc:"The member who has this memory set will have their [Power Hit] increased by 24%. Each time an ally activates Team Morale Awakening, that member's [Power Attack] increases by 8%, up to 3 stacks. When the relevant member is on the court, the duration of the team morale boost for allies is increased by 2 ball touches.",
    img:"img/memories/MemoBokutoUR.png"
    },
  {
    id:"mem_hayaseomi_ur",
    name:"Hayaseomi UR",
    positions:["WS"],
    bonus:{ Serve:{flat:765}, Spike:{flat:838}, Set:{flat:583}, Receive:{flat:838}, Block:{flat:656}, Save:{flat:619} },
    desc:"The member who has this memory set will have their [Power Hit] increased by 24%. When the corresponding member receives, [Attack Technique] increases by 15% until the ball goes over the net twice. After receiving, the corresponding member's [Mental] increases by 8%, up to 4 stacks.",
    img:"img/memories/MemoHayaseiomiUR.png"
    },
   {
    id:"mem_yui_ssr",
    name:"Yui SSR",
    positions:["WS"],
    bonus:{ Serve:{flat:605}, Spike:{flat:663}, Set:{flat:461}, Receive:{flat:663}, Block:{flat:518}, Save:{flat:490} },
    desc:"[Receive] increases by 20%. When this member receives, [Power Attack] increases by 16% and lasts until the ball has crossed the net six times. If this member's receive is a [Nice Play], their next Power Attack is guaranteed to be a [Nice Play].",
    img:"img/memories/MemoYuiSSR.png"
    },
   {
    id:"mem_oshiro_ssr",
    name:"Oshiro SSR",
    positions:["WS"],
    bonus:{ Serve:{flat:605}, Spike:{flat:663}, Set:{flat:461}, Receive:{flat:663}, Block:{flat:518}, Save:{flat:490} },
    desc:"[Power Attack] increases by 20%. For every 6 Stamina recovered by this member, [Power Attack] increases by 6.3%. This effect lasts until the ball has crossed the net five times. If the Stamina recovered in a single instance exceeds 10, [Attack Technique] increases by 6.4%; this effect lasts until the ball has crossed the net five times.",
    img:"img/memories/MemoOshiroSSR.png"
},
    {
    id:"mem_kita_ssr",
    name:"Kita SSR",
    positions:["WS"],
    bonus:{ Serve:{flat:605}, Spike:{flat:663}, Set:{flat:461}, Receive:{flat:663}, Block:{flat:518}, Save:{flat:490} },
    desc:"[Receive] increases by 20%. If this member's receive is not a [Nice Play], the power of the next ally's receive increases by 40% of the receiving member's [Receive] stat.",
    img:"img/memories/MemoKitaSSR.png"
},
    {
    id:"mem_tanaka_ssr",
    name:"Tanaka SSR",
    positions:["WS"],
    bonus:{ Serve:{flat:605}, Spike:{flat:663}, Set:{flat:461}, Receive:{flat:663}, Block:{flat:518}, Save:{flat:490} },
    desc:"[Power Attack] increases by 20%. For this member, up to the second Power Spike in each set, the finishing power increases by 36% of [Power Attack].",
    img:"img/memories/MemoTanakaSSR.png"
},
    {
id:"mem_azumane_ssr",
name:"Azumane SSR",
positions:["WS"],
bonus:{ Serve:{flat:605}, Spike:{flat:663}, Set:{flat:461}, Receive:{flat:663}, Block:{flat:518}, Save:{flat:490} },
desc:"If the member equipping this memory has 50 or more Stamina, [Power Attack] increases by 36%. When this member activates a Power Spike skill and the Stamina consumed is 20 or more, this Power Spike's power increases by 32% of [Power Attack].",
img:"img/memories/MemoAzumaneSSR.png"
},
    {
id:"mem_iwaizumi_ssr",
name:"Iwaizumi SSR",
positions:["WS"],
bonus:{ Serve:{flat:605}, Spike:{flat:663}, Set:{flat:461}, Receive:{flat:663}, Block:{flat:518}, Save:{flat:490} },
desc:"[Wing Spiker] Exclusive: Increases [Receive] by 10%. When the equipper executes a Critical Power Spike Ultimate, increases [Power Attack] by 8% of [Receive] for 3 net crossings.",
img:"img/memories/MemoIwaizumiSSR.png"
},
    {
id:"mem_futakuchi_ssr",
name:"Futakuchi SSR",
positions:["WS"],
bonus:{ Serve:{flat:605}, Spike:{flat:663}, Set:{flat:461}, Receive:{flat:663}, Block:{flat:518}, Save:{flat:490} },
desc:"[Block] increases by 20%. For each ally Block-type member on the court, this member's Special finishing power increases by 6.4% of the parameter corresponding to that Special.",
img:"img/memories/MemoFutakuchiSSR.png"
},
    {
id:"mem_goshiki_ssr",
name:"Goshiki SSR",
positions:["WS"],
bonus:{ Serve:{flat:605}, Spike:{flat:663}, Set:{flat:461}, Receive:{flat:663}, Block:{flat:518}, Save:{flat:490} },
desc:"[Power Attack] increases by 20%. While an ally's Team Morale Awakening is active, this member's [Power Attack] increases by 32%.",
img:"img/memories/MemoGoshikiSSR.png"
},
   
    {
id:"mem_terushima_ssr",
name:"Terushima SSR",
positions:["WS"],
bonus:{ Serve:{flat:605}, Spike:{flat:663}, Set:{flat:461}, Receive:{flat:663}, Block:{flat:518}, Save:{flat:490} },
desc:"[Power Attack] increases by 24%. When this member activates the [Choose More] effect, gain 2 stacks of [Choose More] and increase back-row allies' [Receive] by 12% for 1 rally. For each stack of [Choose More], [Power Attack]/[Quick Attack] increases by 2.5%, up to 4 stacks.",
img:"img/memories/MemoTerushimaSSR.png"
}   
    
];

/** Catálogo de SETS (POTENTIAL)  * */
const setCatalog = [
  {
  id:"set_rapid_quick_attack",
  name:"Rapid Quick Attack",
  twoPiece:{ Spike:{ pct:15 } },
  fourPiece:{Spike:{ pct:15 }}, // condicional
  img:"img/sets/rapid_quick_attack.png",
  desc2:"2p: Increases Quick Attack stat by 15%.",
  desc4:"2p: Increases Quick Attack stat by 15%. 4p: Each time Quick Spike is used, increases Quick Spike stat by 5%, up to 5 stacks."
},
{
  id:"set_sharp_sense",
  name:"Sharp Sense",
  twoPiece:{ Spike:{ pct:15 } },
  fourPiece:{Spike:{ pct:15 }}, // condicional
  img:"img/sets/sharp_sense.png",
  desc2:"2p: Increases Quick Attack stat by 15%.",
  desc4:"2p: Increases Quick Attack stat by 15%. 4p: Increases Awareness by 15%; when Quick Spike is Critical, increases Strength by 10%."
},
{
  id:"set_power_vibe",
  name:"Power Vibe",
  twoPiece:{ Spike:{ pct:15 } },
  fourPiece:{Spike:{ pct:15 }}, // condicional
  img:"img/sets/power_vibe.png",
  desc2:"2p: Increases Power Attack stat by 15%.",
  desc4:"2p: Increases Power Attack stat by 15%. 4p: Increases Awareness by 15%; when Power Spike is Critical, increases Strength by 10%."
},
{
  id:"set_power_rise",
  name:"Power Rise",
  twoPiece:{ Spike:{ pct:15 } },
  fourPiece:{Spike:{ pct:15 }}, // condicional
  img:"img/sets/power_rise.png",
  desc2:"2p: Increases Power Attack stat by 15%.",
  desc4:"2p: Increases Power Attack stat by 15%. 4p: Increases Attack Technique by 10% when using Power Spike; when scoring with Power Spike, recovers 5 Stamina."
},
{
  id:"set_precise_serve",
  name:"Precise Serve",
  twoPiece:{ Set:{ pct:15 } },
  fourPiece:{Set:{ pct:15 }}, // condicional
  img:"img/sets/precise_serve.png",
  desc2:"2p: Increases Set stat by 15%.",
  desc4:"2p: Increases Set stat by 15%. 4p: Serves never fail and increases Attack Technique by 15% when serving."
},
{
  id:"set_precise_set",
  name:"Precise Set",
  twoPiece:{ Set:{ pct:15 } },
  fourPiece:{Set:{ pct:15 } }, // condicional
  img:"img/sets/precise_set.png",
  desc2:"2p: Increases Set stat by 15%.",
  desc4:"2p: Increases Set stat by 15%. 4p: Increases setting power by 15% of the Set stat." 
},
{
  id:"set_precise_block",
  name:"Precise Block",
  twoPiece:{ Block:{ pct:15 } },
  fourPiece:{Block:{ pct:15 }}, // efeito condicional descrito abaixo
  img:"img/sets/precise_block.png",
  desc2:"2p: Increases Block stat by 15%.",
  desc4:"2p: Increases Block stat by 15%. 4p: When blocking a Power Spike, increases this block's power by 20% of the Block stat."
},
{
  id:"set_block_movement",
  name:"Block Movement",
  twoPiece:{ Block:{ pct:15 } },
  fourPiece:{Block:{ pct:15 }}, // efeito condicional descrito abaixo
  img:"img/sets/block_movement.png",
  desc2:"2p: Increases Block stat by 15%.",
  desc4:"2p: Increases Block stat by 15%. 4p: When blocking a spike with other Block-type players present in the front row, increases this block's power by 20% of the Block stat."
},
 {
    id:"set_assist_receive",
    name:"Assist Receive",
    twoPiece:{ Receive:{ pct:15 } },
    fourPiece:{Receive:{ pct:15 }}, // efeito condicional descrito abaixo
    img:"img/sets/assist_receive.png",
    desc2:"2p: Increases Receive stat by 15%.",
    desc4:"2p: Increases Receive stat by 15%. 4p: When achieving a PERFECT receive, increases your side's next spike power by 30% of the spiker's Power/Quick Attack stat."
  },
  {
    id:"set_supreme_receive",
    name:"Supreme Receive",
    twoPiece:{ Receive:{ pct:15 } },
    fourPiece:{Receive:{ pct:15 }}, // efeito condicional descrito abaixo
    img:"img/sets/supreme_receive.png",
    desc2:"2p: Increases Receive stat by 15%.",
    desc4:"2p: Increases Receive stat by 15%. 4p: When receiving a Quick Spike, increases this reception's power by 30% of the Receive stat."
  }
];
let selecionados = [];

/* ====== FUNÇÕES ORIGINAIS (mantidas) ====== */
function addBenchSlot() {
    const benchRow = document.getElementById("bench-row");
    const slot = document.createElement("div");
    slot.className = "player-slot bench";
    slot.innerHTML = `<div class="bench-slot" data-role="bench"></div><div class="player-info">Bench</div>`;
    benchRow.insertBefore(slot, benchRow.querySelector(".add-slot-btn"));
    attachBenchEvents(slot.querySelector(".bench-slot"));
}

function attachBenchEvents(slot) {
  if (slot.__benchBound) return;         // evita duplicar handlers
  slot.__benchBound = true;

  let clickTimer = null;

  slot.addEventListener("click", (e) => {
    e.stopPropagation();

    // 2º clique dentro da janela => trata como duplo clique
    if (clickTimer) {
      clearTimeout(clickTimer);
      clickTimer = null;

      const nome = slot.dataset.nome;
      if (!nome) {
        // slot vazio: no duplo clique, abrimos o menu mesmo assim
        if (typeof showMenu === "function") showMenu("bench", slot);
        return;
      }

      const p = (typeof characters !== "undefined") && characters.find(x => x.nome === nome);
      if (!p) return;

      const sm = document.getElementById("scrollMenu");
      if (sm) sm.style.display = "none";     // fecha menu de seleção, se aberto

      if (typeof showCharacterDetails === "function") showCharacterDetails(p);

      const sidebar = document.getElementById("sidebar");
      const menuBtn = document.getElementById("menuBtn");
      if (sidebar) sidebar.classList.add("open");
      if (menuBtn) menuBtn.style.display = "none";
      return;
    }

    // 1º clique: se não vier 2º clique rápido, abre o menu do banco
    clickTimer = setTimeout(() => {
      clickTimer = null;
      if (typeof showMenu === "function") showMenu("bench", slot);
    }, 250);
  });

  // botão direito: remover do banco
  slot.addEventListener("contextmenu", (e) => {
    e.preventDefault();
    if (typeof removeCharacter === "function") removeCharacter(slot);
  });
}


function showMenu(role, slot) {
  const scrollMenu = document.getElementById("scrollMenu");
  scrollMenu.innerHTML = '';

  if (role === "bench") {
    // layout em coluna para botões em cima + grid de imagens embaixo
    scrollMenu.style.display = 'flex';
    scrollMenu.style.flexDirection = 'column';

    // --- 5 botões no topo
    const bar = document.createElement('div');
    bar.className = 'bench-quick-inside';
    ['S','MB','WS','OP','L'].forEach(r => {
      const b = document.createElement('button');
      b.textContent = r;
      b.dataset.role = r;
      b.title = `Bench: ${r}`;
      b.addEventListener('click', (e) => {
        e.stopPropagation();
        render(r); // refiltra a lista
      });
      bar.appendChild(b);
    });
    scrollMenu.appendChild(bar);

    // --- container das imagens
    const grid = document.createElement('div');
    grid.style.display = 'flex';
    grid.style.flexWrap = 'wrap';
    grid.style.gap = '8px';
    scrollMenu.appendChild(grid);

    // renderiza a lista (com ou sem filtro de posição)
    function render(roleFilter = null) {
      grid.innerHTML = '';
      // marca o ativo
      bar.querySelectorAll('button').forEach(btn =>
        btn.classList.toggle('active', btn.dataset.role === roleFilter)
      );

      let disponiveis = characters.filter(p =>
        !selecionados.includes(p) && respeitaLimiteBench(p, slot)
      );
      if (roleFilter) disponiveis = disponiveis.filter(p => p.funcao === roleFilter);

      if (disponiveis.length === 0) {
        grid.innerHTML = `<div style="color:#ccc; padding:8px;">
          No available ${roleFilter ? roleFilter : ''} for bench.</div>`;
      } else {
        disponiveis.forEach(p => {
          const img = document.createElement('img');
          img.src = p.img;
          img.alt = p.nome;
          img.title = p.nome;
          img.addEventListener('click', (e) => {
            e.stopPropagation();
            setCharacter(slot, p, 'bench');   // adiciona no banco
            scrollMenu.style.display = 'none';
          });
          grid.appendChild(img);
        });
      }
    }

    // abre já com "todos" (se preferir abrir já em S: troque para render('S'))
    render(null);
    return; // não continuar para o caso "não bench"
  }

  // ==== restante igual ao original (S, MB, WS, OP, L fora do bench) ====
  let disponiveis = characters.filter(p => p.funcao === role && !selecionados.includes(p));
  disponiveis.forEach(p => {
    const img = document.createElement('img');
    img.src = p.img;
    img.alt = p.nome;
    img.title = p.nome;
    img.addEventListener('click', (e) => {
      e.stopPropagation();
      setCharacter(slot, p, role);
      scrollMenu.style.display = 'none';
    });
    scrollMenu.appendChild(img);
  });

  scrollMenu.style.display = 'flex';
}

function respeitaLimiteBench(p, slot) {
    const Bench = Array.from(document.querySelectorAll(".bench-slot"))
        .map(s => s.dataset.nome && characters.find(x => x.nome === s.dataset.nome))
        .filter(Boolean);

    if (slot.dataset.nome === p.nome) return true;

    const contagem = Bench.reduce((acc, cur) => {
        acc[cur.funcao] = (acc[cur.funcao] || 0) + 1;
        return acc;
    }, {});

    if (p.funcao === "MB" && contagem["MB"] >= 6) return false;
    if (p.funcao === "WS" && contagem["WS"] >= 6) return false;
    if (["L",].includes(p.funcao) && contagem[p.funcao] >= 1) return false;

    return true;
}
    function getFirstEmptyBenchSlot() {
  // Procura um slot vazio do banco; se não houver, cria um novo
  const slots = Array.from(document.querySelectorAll(".bench-slot"));
  const empty = slots.find(s => !s.dataset.nome);
  if (empty) return empty;
  if (typeof addBenchSlot === "function") addBenchSlot(); // cria e já liga eventos
  const all = Array.from(document.querySelectorAll(".bench-slot"));
  return all[all.length - 1] || null;
}

function showBenchMenuByRole(role) {
  const slot = getFirstEmptyBenchSlot();
  if (!slot) return;

  const scrollMenu = document.getElementById("scrollMenu");
  scrollMenu.innerHTML = '';

  // Filtra por posição + respeita regras do banco
  const disponiveis = characters.filter(p =>
    p.funcao === role &&
    !selecionados.includes(p) &&
    respeitaLimiteBench(p, slot)   // mesma regra usada quando role === "bench"
  );

  if (disponiveis.length === 0) {
    scrollMenu.innerHTML = `<div style="color:#ccc; padding:8px;">No available ${role} for bench.</div>`;
  } else {
    disponiveis.forEach(p => {
      const img = document.createElement('img');
      img.src = p.img;
      img.alt = p.nome;
      img.title = p.nome;
      img.addEventListener('click', (e) => {
        e.stopPropagation();
        setCharacter(slot, p, 'bench');   // adiciona direto ao banco
        scrollMenu.style.display = 'none';
      });
      scrollMenu.appendChild(img);
    });
  }

  scrollMenu.style.display = 'flex';
}
document.querySelectorAll(".bench-quick-btn").forEach(btn => {
  btn.addEventListener("click", (e) => {
    e.stopPropagation();
    showBenchMenuByRole(btn.dataset.role);
  });
});

// índices dos 6 slots que formam o "anel" (L fica fora, é fixo no índice 3)
const RING_IDX = [0, 1, 2, 6, 5, 4]; // [S, MB, WS, OP, MB, WS] na orientação base

// Rotaciona o anel 'steps' vezes no sentido horário (move conteúdo e data-role)
function rotateRingClockwise(steps){
  const hexes = [...document.querySelectorAll('.hex')];
  const ring = RING_IDX.map(i => hexes[i]);
  const k = ((steps % 6) + 6) % 6;
  if (k === 0) return;
const ids = ring.map(h => getSlotId(h));
  const eq = ids.map(id => equipState.get(id) || null);
  const eqRot = eq.slice(-k).concat(eq.slice(0, -k));
  ids.forEach((id, idx) => {
    if (eqRot[idx]) equipState.set(id, eqRot[idx]); else equipState.delete(id);
  });
  // 1) Captura estado completo (inclui charName!)
  const state = ring.map(h => ({
    html: h.innerHTML,
    nome: h.dataset.nome || null,
    charName: h.dataset.charName || null,
    role: h.dataset.role || h.getAttribute('data-role') || ''
  }));

  // 2) Roda
  const rotated = state.slice(-k).concat(state.slice(0, -k));

  // 3) Aplica e reanexa handlers/badges
  ring.forEach((h, i) => {
    const st = rotated[i];
    h.innerHTML = st.html;                  // isto remove listeners antigos
    if (st.nome) h.dataset.nome = st.nome; else delete h.dataset.nome;
    h.dataset.role = st.role;
    if (st.charName) h.dataset.charName = st.charName; else delete h.dataset.charName; // **novo**

    // atualiza o label do slot
    const info = h.parentElement.querySelector('.player-info');
    if (info) {
      if (st.nome) {
        const p = (typeof characters !== "undefined") && characters.find(x => x.nome === st.nome);
        info.textContent = p ? `${st.nome} - ${p.funcao}` : st.nome;
      } else {
        info.textContent = st.role;
      }
    }
    
    // **importante**: recriar o botão ⚙️ com listener e a badge
    removeItemGear(h);
    ensureItemGear(h);
    updateItemBadge(h);
  });
}

// Ajusta a orientação do grid para coincidir com o time salvo
function orientGridToSavedTeam(team) {
  // pega a função (S/MB/WS/OP/L) em cada índice salvo
  const funcaoEm = (idx) => {
    const nome = team.main[idx];
    if (!nome) return null;
    const p = characters.find(x => x.nome === nome);
    return p ? p.funcao : null;
  };

  // Tentamos ancorar por S; se não existir, ancoramos por OP
  const idxS = RING_IDX.find(i => funcaoEm(i) === 'S');
  if (idxS !== undefined) {
    const posNoAnel = RING_IDX.indexOf(idxS); // onde o S está
    // na base, S está em RING_IDX[0] -> steps = pos atual
    rotateRingClockwise(posNoAnel);
    return;
  }
  const idxOP = RING_IDX.find(i => funcaoEm(i) === 'OP');
  if (idxOP !== undefined) {
    const posNoAnel = RING_IDX.indexOf(idxOP);
    // na base, OP está em RING_IDX[3] -> passos = pos atual - 3
    rotateRingClockwise((posNoAnel - 3 + 6) % 6);
  }
}

    
function setCharacter(slot, personagem, role) {
    // se já tinha alguém nesse slot, remove dos selecionados
    if (slot.dataset.nome) {
        selecionados = selecionados.filter(p => p.nome !== slot.dataset.nome);
    }

    // monta imagem
   slot.innerHTML = `<img src="${personagem.img}" alt="${personagem.nome}">`;
slot.dataset.nome = personagem.nome;
slot.dataset.role = role;

    afterAssignCharacter(slot, personagem.nome);

    // atualiza texto de info (procura .player-info no mesmo player-slot)
    const infoDiv = slot.parentElement.querySelector('.player-info');
    if (infoDiv) infoDiv.textContent = `${personagem.nome} - ${personagem.funcao}`;

    selecionados.push(personagem);
    updateSynergies();
}

function removeCharacter(slot) {
  if (slot.dataset.nome) {
    selecionados = selecionados.filter(p => p.nome !== slot.dataset.nome);

    // CHAME O HOOK ANTES de limpar o slot
    if (typeof window.afterRemoveCharacter === "function") {
      window.afterRemoveCharacter(slot);
    }

    slot.innerHTML = "";
    delete slot.dataset.nome;

    const infoDiv = slot.parentElement.querySelector('.player-info');
    if (slot.classList.contains("bench-slot")) {
      infoDiv.textContent = "Bench";
    } else {
      infoDiv.textContent = slot.dataset.role
        || slot.getAttribute("data-role")
        || slot.parentElement.querySelector('.hex')?.dataset.role || "";
    }

    updateSynergies();
    if (typeof afterRemoveCharacter === "function") afterRemoveCharacter(slot);
  }
}

function updateSynergies() {
    const synergyListEl = document.getElementById("synergy-list");
    synergyListEl.innerHTML = "";

    // === CONFIG: which bonds need 3 to activate ===
    // Put the EXACT vinculo names here (case-sensitive).
    const bondsRequire3 = new Set([
      "Swimming",  
     "Twin Heads", 
    ]);

    const DEFAULT_BOND_MIN = 2; // all bonds default to 2 unless listed above
    const SCHOOL_MIN = 4;       // school synergy rule stays the same

    const SchoolsCount = {};
    const vinculosCount = {};

    // --- Count Schools (starters only) ---
    document.querySelectorAll(".hex").forEach(slot => {
        if (slot.dataset.nome) {
            const p = characters.find(x => x.nome === slot.dataset.nome);
            if (!p) return;
            SchoolsCount[p.School] = (SchoolsCount[p.School] || 0) + 1;
        }
    });

    // --- Count Bonds (starters + bench) ---
    document.querySelectorAll(".hex, .bench-slot").forEach(slot => {
        if (slot.dataset.nome) {
            const p = characters.find(x => x.nome === slot.dataset.nome);
            if (!p) return;

            if (Array.isArray(p.vinculo)) {
                p.vinculo.forEach(v => {
                    vinculosCount[v] = (vinculosCount[v] || 0) + 1;
                });
            } else if (p.vinculo) {
                vinculosCount[p.vinculo] = (vinculosCount[p.vinculo] || 0) + 1;
            }
        }
    });

    let algumaSinergia = false;

    // --- School synergies (>= 4) ---
    for (const school in SchoolsCount) {
        if (SchoolsCount[school] >= SCHOOL_MIN) {
            synergyListEl.innerHTML += `
                <li>
                    <button class="bond-btn school-btn" data-school="${school}">
                        School: ${school}
                    </button>
                </li>
            `;
            algumaSinergia = true;
        }
    }

    // --- Bond synergies (>= per-bond threshold) ---
    for (const vinculo in vinculosCount) {
        const required = bondsRequire3.has(vinculo) ? 3 : DEFAULT_BOND_MIN;
        if (vinculosCount[vinculo] >= required) {
            synergyListEl.innerHTML += `
                <li>
                    <button class="bond-btn synergy-btn" data-bond="${vinculo}">
                        ${vinculo}
                    </button>
                </li>
            `;
            algumaSinergia = true;
        }
    }

    // === Click: School ===
    document.querySelectorAll(".school-btn").forEach(btn => {
        btn.addEventListener("click", (e) => {
            e.stopPropagation();
            const schoolName = btn.dataset.school;

            const relacionados = characters.filter(pers => pers.School === schoolName);

            sidebarContent.innerHTML = `
                <h3>School: ${schoolName}</h3>
                <p>${descricoesSinergia[schoolName] || "Sem descrição disponível"}</p>
                <div class="char-list">
                    ${relacionados.map(r => `
                        <div class="char-card" data-nome="${r.nome}">
                            <img src="${r.img}" alt="${r.nome}">
                            <p>${r.nome}</p>
                        </div>
                    `).join('')}
                </div>
                <button id="backToSynergies" class="bond-btn">← Back</button>
            `;

            sidebar.classList.add("open");
            menuBtn.style.display = "none";

            document.getElementById("backToSynergies").addEventListener("click", (e) => {
                e.stopPropagation();
                updateSynergies();
                sidebar.classList.add("open");
                menuBtn.style.display = "none";
            });

            sidebarContent.querySelectorAll(".char-card").forEach(card => {
                card.addEventListener("click", (e) => {
                    e.stopPropagation();
                    const nome = card.dataset.nome;
                    const personagem = characters.find(x => x.nome === nome);
                    showCharacterDetails(personagem);
                    sidebar.classList.add("open");
                    menuBtn.style.display = "none";
                });
            });
        });
    });

    // === Click: Bond ===
    document.querySelectorAll(".synergy-btn").forEach(btn => {
        btn.addEventListener("click", (e) => {
            e.stopPropagation();
            const bondName = btn.dataset.bond;

            const relacionados = characters.filter(pers => {
                if (Array.isArray(pers.vinculo)) return pers.vinculo.includes(bondName);
                return pers.vinculo === bondName;
            });

            sidebarContent.innerHTML = `
                <h3>Vínculo: ${bondName}</h3>
                <p>${descricoesSinergia[bondName] || "Sem descrição disponível"}</p>
                <div class="char-list">
                    ${relacionados.map(r => `
                        <div class="char-card" data-nome="${r.nome}">
                            <img src="${r.img}" alt="${r.nome}">
                            <p>${r.nome}</p>
                        </div>
                    `).join('')}
                </div>
                <button id="backToSynergies" class="bond-btn">← Back</button>
            `;

            sidebar.classList.add("open");
            menuBtn.style.display = "none";

            document.getElementById("backToSynergies").addEventListener("click", (e) => {
                e.stopPropagation();
                updateSynergies();
                sidebar.classList.add("open");
                menuBtn.style.display = "none";
            });

            sidebarContent.querySelectorAll(".char-card").forEach(card => {
                card.addEventListener("click", (e) => {
                    e.stopPropagation();
                    const nome = card.dataset.nome;
                    const personagem = characters.find(x => x.nome === nome);
                    showCharacterDetails(personagem);
                    sidebar.classList.add("open");
                    menuBtn.style.display = "none";
                });
            });
        });
    });

    if (!algumaSinergia) {
        synergyListEl.innerHTML = "<li>Only Deployment Synergies are displayed.Synergies will only work when players are in court inside the game.</li>";
    }
}
// ====== Eventos iniciais (grid principal com detecção de duplo clique) ======
document.querySelectorAll(".hex").forEach(slot => {
  // Timer por slot para distinguir clique simples x duplo clique
  slot.__clickTimer = null;

  slot.addEventListener("click", (e) => {
    e.stopPropagation();

    // Se já existe um timer, este clique é o 2º -> trata como duplo clique
    if (slot.__clickTimer) {
      clearTimeout(slot.__clickTimer);
      slot.__clickTimer = null;

      // ⏩ Duplo clique: abrir detalhes (se houver personagem nesse slot)
      const nome = slot.dataset.nome;
      if (!nome) return; // slot vazio
      const p = (typeof characters !== "undefined") && characters.find(x => x.nome === nome);
      if (!p) return;

      // fecha o menu, se estiver aberto
      const sm = document.getElementById("scrollMenu");
      if (sm) sm.style.display = "none";

      // mostra detalhes no painel lateral
      if (typeof showCharacterDetails === "function") {
        showCharacterDetails(p);
      }
      // garante que o painel lateral fique aberto (se você usa esses ids)
      const sidebar = document.getElementById("sidebar");
      const menuBtn = document.getElementById("menuBtn");
      if (sidebar) sidebar.classList.add("open");
      if (menuBtn) menuBtn.style.display = "none";

      return;
    }

    // 1º clique: arma o timer; se não houver 2º clique, abre o menu
    slot.__clickTimer = setTimeout(() => {
      slot.__clickTimer = null;
      // ✅ Clique simples (sem 2º clique): abre o menu de seleção
      if (typeof showMenu === "function") {
        showMenu(slot.dataset.role, slot);
      }
    }, 250); // janela para detectar duplo clique
  });

  // Botão direito: remover personagem (igual antes)
  slot.addEventListener("contextmenu", (e) => {
    e.preventDefault();
    if (typeof removeCharacter === "function") removeCharacter(slot);
  });
});

document.querySelectorAll(".bench-slot").forEach(slot => attachBenchEvents(slot));

/* ====== SIDEBAR NAV ====== */
const sidebarContent = document.getElementById("sidebar-content");
document.querySelectorAll(".menu-link").forEach(btn => {
  btn.addEventListener("click", (e) => {
    e.stopPropagation();
    const section = btn.dataset.section;
    if (section === "characters") {
      showCharacterList();
    } else if (section === "schools") {
      showSchoolsList();             
    } else if (section === "save") {
      showSavedTeams();
    } else if (section === "help") {
    sidebarContent.innerHTML = `
        <h3>Info</h3>
        <div style="display:flex; flex-direction:column; gap:10px;">
            <button id="faqBtn" class="bond-btn">📄 FAQ</button>
            <button id="creditsBtn" class="bond-btn">👥 Credits</button>
            <button id="patchBtn" class="bond-btn">🔄 Patch</button>
        </div>
    `;

    // Botão FAQ
    document.getElementById("faqBtn").addEventListener("click", (e) => {
        e.stopPropagation();
        sidebarContent.innerHTML = `
            <h3>FAQ</h3>
            <p>Player bonds work if one is benched?</p>
            <p>It doesn't, only gonna be applied in game when the bond players are in court</p>
            <p>"X" bond doesn't show, why?</p>
            <p>This version only shows DEPLOYMENT bonds, since "normal" bonds requirements are just to have the characters on the account, meaning they don't have to be in court to activate</p>
            <p>How can i help with team builderr?</p>
            <p>Contact goN6 on discord, to send ideas, fixes to erros, new information, etc.</p>
            <button id="backToHelp" class="bond-btn">← Back</button>
        `;
        document.getElementById("backToHelp").addEventListener("click", (e) => {
            e.stopPropagation();
            document.querySelector('.menu-link[data-section="help"]').click();
            sidebar.classList.add("open");
            menuBtn.style.display = "none";
        });
    });

    // Botão Credits
    document.getElementById("patchBtn").addEventListener("click", (e) => {
        e.stopPropagation();
        sidebarContent.innerHTML = `
            <h3>Patch notes</h3>
            <p>Patch 1.2 Added:</p>
            <p>Drag/drop players to bench and to starting line up</p>
            <p>Filter players by type (quick/power/etc)</p>
            <p>Team recommendations based on most synergies</p>
            <p>Memory and potential sets on character</p>
            <p>School page with all characters from each school and its buff</p>
            <p>Fixed:</p>
            <p>Some synergies that required 3 players were not being displayed correctly</p>
            <p>Some bench rules were not working correctly, EX: couldnt add more than 2 MB's on bench</p>
            <p>Added:</p>
            <p>Double click opens character details</p>
            <p>Bench filter per positions</p>
            <p>Side menu</p>
            <p>Save and Load teams</p>
            <p>Clear all button</p>
            <p>Filter characters on side menu</p>
            <p>Character Skills description</p>
            <p>Character Stats</p>
            <p>Expected release date</p>
            <button id="backToHelp" class="bond-btn">← Back</button>
        `;
        document.getElementById("backToHelp").addEventListener("click", (e) => {
            e.stopPropagation();
            document.querySelector('.menu-link[data-section="help"]').click();
            sidebar.classList.add("open");
            menuBtn.style.display = "none";
        });
    });
               // Botão FAQ
    document.getElementById("creditsBtn").addEventListener("click", (e) => {
        e.stopPropagation();
        sidebarContent.innerHTML = `
            <h3>Credits</h3>
            <p>Devoy Aces: goN6 , Kari, Marin, Kaito</p>
            <p>Translation by KRILL group https://discord.gg/EEBqSKvAsp</p>
            <button id="backToHelp" class="bond-btn">← Back</button>
            
        `;
        document.getElementById("backToHelp").addEventListener("click", (e) => {
            e.stopPropagation();
            document.querySelector('.menu-link[data-section="help"]').click();
            sidebar.classList.add("open");
            menuBtn.style.display = "none";
        });
    });
}
    });
});

/* ====== LISTA / FILTROS DE characters (mantida com stopPropagation nos clicks) ====== */
function showCharacterList() {
    const funcoes = [...new Set(characters.map(p => p.funcao))];
    const escolas = [...new Set(characters.map(p => p.School))];
    const StatsKeys = [...new Set(characters.flatMap(p => Object.keys(p.Stats || {})))];
    function symbolToType(sym){
  const s = String(sym||"").toLowerCase();
  if (s.includes("quicksymbol"))   return "quick";
  if (s.includes("powersymbol"))   return "power";
  if (s.includes("servesymbol"))   return "serve";
  if (s.includes("settersymbol"))  return "setter";
  if (s.includes("receivesymbol")) return "receive";
  if (s.includes("blocksymbol"))   return "block";
  if (s.includes("savesymbol"))    return "save";
  return null;
}

// tipos únicos lendo characters[*].symbols
const allTypes = [...new Set(
  characters.flatMap(p => (Array.isArray(p.symbols) ? p.symbols : [])
    .map(symbolToType).filter(Boolean))
)].sort();

    let html = `
    <h3>Characters</h3>
    <div class="filtros">
        <div>
            <label>Position:</label>
            <select id="filtroFuncao">
                <option value="">All</option>
                ${funcoes.map(f => `<option value="${f}">${f}</option>`).join('')}
            </select>
        </div>
        <div>
            <label>School:</label>
            <select id="filtroEscola">
                <option value="">All</option>
                ${escolas.map(e => `<option value="${e}">${e}</option>`).join('')}
            </select>
        </div>
        <div>
            <label>Stats:</label>
            <select id="filtroStats">
                <option value="">All</option>
                ${StatsKeys.map(s => `<option value="${s}">${s}</option>`).join('')}
            </select>
        </div>
                <div>
            <label>Expected Release Date:</label>
            <select id="filtroDataOrdem" title="Ordenar pela data (ignora quem não tem data)">
                <option value="">Ignore</option>
                <option value="asc">Ascending (MM/DD/YY)</option>
                <option value="desc">Descending (MM/DD/YY)</option>
            </select>
        </div>
        <div>
             <label>Type:</label>
             <div id="filtroType">
             ${allTypes.map(t => `
             <label style="display:inline-flex;align-items:center;gap:6px;margin:2px 8px 2px 0;">
             <input type="checkbox" name="typeFilter" value="${t}"> ${t.toUpperCase()}
             </label>
             `).join("")}
             </div>
        </div>
<button id="limparFiltros">Clear</button>
    </div>
<div class='char-list' id="charList"></div>
    `;

    sidebarContent.innerHTML = html;
    const list = document.getElementById('charList');
if (list) list.classList.remove('is-hidden');
    enableCloseOutsideCharList();

    // Helpers de data (MM/DD/YY)
    function parseDateMMDDYY(s) {
        if (typeof s !== "string") return null;
        const m = s.match(/^(\d{2})\/(\d{2})\/(\d{2})$/);
        if (!m) return null;
        const mm = parseInt(m[1], 10), dd = parseInt(m[2], 10), yy = 2000 + parseInt(m[3], 10);
        const d = new Date(yy, mm - 1, dd);
        return Number.isNaN(d.getTime()) ? null : d;
    }
    function hasValidDate(p) {
        return !!parseDateMMDDYY(p?.data);
    }

function getStatsSafe(p, key) {
  const v = p?.Stats?.[key];
  return (typeof v === "number") ? v : "-";
}


   function renderLista() {
  const listaEl   = document.getElementById("charList");
  if (listaEl) listaEl.classList.remove('is-hidden');

  const funcaoSel = (document.getElementById("filtroFuncao").value || "").trim();
  const escolaSel = (document.getElementById("filtroEscola").value || "").trim();
  let   StatsSel = (document.getElementById("filtroStats").value || "").trim();
  const dataOrdem = (document.getElementById("filtroDataOrdem")?.value || "").trim();
  const typeSel = Array.from(
  document.querySelectorAll('#filtroType input[name="typeFilter"]:checked')
).map(el => el.value);
  const typeBox = document.getElementById('filtroType');
if (typeBox) typeBox.addEventListener('change', renderLista);

  function getCharTypes(p){
  const arr = Array.isArray(p?.symbols) ? p.symbols : [];
  const types = new Set(arr.map(symbolToType).filter(Boolean));
  return [...types];
}

  if (StatsSel.toLowerCase() === "todos") StatsSel = "";

  // 1) filtro base
  let filtrados = characters.filter(p =>
    (funcaoSel === "" || p.funcao === funcaoSel) &&
    (escolaSel === "" || p.School === escolaSel) &&
    (typeSel.length === 0 || typeSel.every(t => getCharTypes(p).includes(t)))
  );

  // 2) ordenar por data quando escolhido (e ignorar sem data)
  if (dataOrdem === "asc" || dataOrdem === "desc") {
    filtrados = filtrados
      .filter(hasValidDate)
      .sort((a, b) => {
        const da = parseDateMMDDYY(a.data);
        const db = parseDateMMDDYY(b.data);
        return dataOrdem === "asc" ? (da - db) : (db - da);
      });
  } else if (StatsSel) {
    // 3) ordenar por Stats quando data está em "Ignorar"
    filtrados.sort((a, b) => {
      const bv = (b.Stats && typeof b.Stats[StatsSel] === "number") ? b.Stats[StatsSel] : -Infinity;
      const av = (a.Stats && typeof a.Stats[StatsSel] === "number") ? a.Stats[StatsSel] : -Infinity;
      return bv - av;
    });
  }

  // 4) render (agora em <li>)
  const html = filtrados.map((p, i) => {
    const metaLine =
      (dataOrdem === "asc" || dataOrdem === "desc")
        ? (hasValidDate(p) ? `<div class="card-sub">Expected Release Date: ${p.data}</div>` : "")
        : (StatsSel ? `<div class="card-sub">${StatsSel}: ${getStatsSafe(p, StatsSel)}</div>` : "");

    return `
      <li class="person-card" data-idx="${i}">
        <img src="${p.img}" alt="${p.nome}">
        <div class="card-name">${p.nome}</div>
        ${metaLine}
      </li>
    `;
  }).join("");

  listaEl.innerHTML = html;

  // 5) clique abre detalhes
  listaEl.querySelectorAll(".person-card").forEach(card => {
    card.addEventListener("click", (ev) => {
      ev.stopPropagation();  
      const idx = +card.getAttribute("data-idx");
      const person = filtrados[idx];
      if (person) showCharacterDetails(person);
    });
  });
}

    // listeners dos filtros
document.getElementById("filtroFuncao").addEventListener("change", renderLista);
document.getElementById("filtroEscola").addEventListener("change", renderLista);
document.getElementById("filtroStats").addEventListener("change", renderLista);
document.getElementById("filtroDataOrdem").addEventListener("change", renderLista);


// botão Limpar
document.getElementById("limparFiltros").addEventListener("click", () => {
  document.getElementById("filtroFuncao").value = "";
  document.getElementById("filtroEscola").value = "";
  document.getElementById("filtroStats").value = "";
  document.querySelectorAll('#filtroType input[name="typeFilter"]').forEach(cb => cb.checked = false);
  const selData = document.getElementById("filtroDataOrdem");
  if (selData) selData.value = "";
  renderLista();
});

// ⬇️ AQUI (fora do botão, depois dos listeners)
const listaEl = document.getElementById("charList");
if (listaEl && !listaEl.dataset.stopCloseBound) {
  listaEl.addEventListener("click", (ev) => ev.stopPropagation());
  listaEl.dataset.stopCloseBound = "1";
}

// primeira renderização
renderLista();
}

function showSchoolsList(){
  const sidebar = document.getElementById("sidebar");
  const menuBtn  = document.getElementById("menuBtn");

  const schools = [...new Set(characters.map(p => p.School))].sort((a,b)=>a.localeCompare(b));

  sidebarContent.innerHTML = `
    <h3>Schools</h3>
    <div style="display:flex; flex-direction:column; gap:8px;">
      ${schools.map(s => `
        <button class="bond-btn school-open" data-school="${s}">
           ${s}
        </button>
      `).join("")}
    </div>
  `;

  // abre e esconde o botão verde
  if (sidebar) sidebar.classList.add("open");
  if (menuBtn) menuBtn.style.display = "none";

  // clique de cada escola abre a página detalhada
  sidebarContent.querySelectorAll(".school-open").forEach(btn=>{
    btn.addEventListener("click", (e)=>{
      e.stopPropagation();
      showSchoolDetail(btn.dataset.school);
    });
  });
}

// Página de uma escola específica: descrição + personagens
function showSchoolDetail(schoolName){
  const sidebar = document.getElementById("sidebar");
  const menuBtn  = document.getElementById("menuBtn");

  const relacionados = characters.filter(p => p.School === schoolName);
  const desc = (typeof descricoesSinergia === "object" && descricoesSinergia[schoolName])
             ? descricoesSinergia[schoolName]
             : "No description available.";

  sidebarContent.innerHTML = `
    <h3>School: ${schoolName}</h3>
    <p>${desc}</p>
    <div class="char-list">
      ${relacionados.map(r => `
        <div class="char-card" data-nome="${r.nome}">
          <img src="${r.img}" alt="${r.nome}">
          <p>${r.nome}</p>
        </div>
      `).join("")}
    </div>
    <button id="backToSchools" class="bond-btn">← Back</button>
  `;

  if (sidebar) sidebar.classList.add("open");
  if (menuBtn) menuBtn.style.display = "none";

  // voltar para a lista de Schools
  document.getElementById("backToSchools").addEventListener("click", (e)=>{
    e.stopPropagation();
    showSchoolsList();
  });

  // clicar num personagem abre os detalhes dele (já existe showCharacterDetails)
  sidebarContent.querySelectorAll(".char-card").forEach(card=>{
    card.addEventListener("click", (e)=>{
      e.stopPropagation();
      const nome = card.dataset.nome;
      const p = characters.find(x => x.nome === nome);
      if (p && typeof showCharacterDetails === "function") {
        showCharacterDetails(p);
      }
    });
  });
}

function showCharacterDetails(p) {
  // Normalize fields so we can safely render
  const bonds   = Array.isArray(p?.vinculo) ? p.vinculo.filter(Boolean)
                : (p?.vinculo ? [p.vinculo] : []);
  const skills  = Array.isArray(p?.habilidades) ? p.habilidades : [];
  const symbols = Array.isArray(p?.symbols) ? p.symbols : [];
  const Stats  = Array.isArray(p?.Stats) ? p.Stats : [];

  sidebarContent.innerHTML = `
    <h3>${p.nome}</h3>
    <img src="${p.img}" alt="${p.nome}" style="width:100%;">

    ${symbols.length ? `
      <div class="person-symbols">
        ${symbols.map(sym => `<img src="${sym}" class="symbol-icon">`).join("")}
      </div>` : ""}

    ${p.data ? `<p><b>Expected Release Date:</b> ${p.data}</p>` : ""}
    <p><b>Position:</b> ${p.funcao || "-"}</p>
    <p><b>School:</b> ${p.School || "-"}</p>

    ${bonds.length ? `
      <p><b>Bonds:</b></p>
      <ul>
        ${bonds.map(v => `<li><button class="bond-btn bond-link" data-bond="${v}">${v}</button></li>`).join("")}
      </ul>` : `<p><b>Bonds:</b> <i>None</i></p>`}

    ${skills.length ? `
      <h4>Skills</h4>
      <ul>
        ${skills.map(h => `<li><button class="skill-btn" data-skill="${h.nome}">${h.nome}</button></li>`).join("")}
      </ul>` : ""}

    ${p.descricao ? `<p style="margin-top:8px;">${p.descricao}</p>` : ""}
    <ul>
            <li><b>Serve:</b> ${p.Stats.Serve}</li>
            <li><b>Spike:</b> ${p.Stats.Spike}</li>
            <li><b>Set:</b> ${p.Stats.Set}</li>
            <li><b>Receive:</b> ${p.Stats.Receive}</li>
            <li><b>Block:</b> ${p.Stats.Block}</li>
            <li><b>Save:</b> ${p.Stats.Save}</li>
        </ul>

    <button id="backToList" class="bond-btn">← Back</button>
  `;

  // Keep sidebar open
  sidebar.classList.add("open");
  menuBtn.style.display = "none";

  // Back to character list
  document.getElementById("backToList").addEventListener("click", (e) => {
    e.stopPropagation();
    showCharacterList();
  });

  // Open a Bond page
  sidebarContent.querySelectorAll(".bond-link").forEach(btn => {
    btn.addEventListener("click", (e) => {
      e.stopPropagation();
      const bondName = btn.dataset.bond;

      const relacionados = characters.filter(pers =>
        Array.isArray(pers.vinculo) ? pers.vinculo.includes(bondName)
                                    : pers.vinculo === bondName
      );

      sidebarContent.innerHTML = `
        <h3>Bond: ${bondName}</h3>
        <p>${descricoesSinergia[bondName] || "Sem descrição disponível"}</p>
        <div class="char-list">
          ${relacionados.map(r => `
            <div class="char-card" data-nome="${r.nome}">
              <img src="${r.img}" alt="${r.nome}">
              <p>${r.nome}</p>
            </div>
          `).join("")}
        </div>
        <button id="backToChar" class="bond-btn">← Back</button>
      `;

      sidebar.classList.add("open");
      menuBtn.style.display = "none";

      // Back to THIS character's details
      document.getElementById("backToChar").addEventListener("click", (e) => {
        e.stopPropagation();
        showCharacterDetails(p);
      });

      // Jump from bond list to another character
      sidebarContent.querySelectorAll(".char-card").forEach(card => {
        card.addEventListener("click", (e) => {
          e.stopPropagation();
          const nome = card.dataset.nome;
          const personagem = characters.find(x => x.nome === nome);
          if (personagem) showCharacterDetails(personagem);
        });
      });
    });
  });

  // Open a Skill page
  sidebarContent.querySelectorAll(".skill-btn").forEach(btn => {
    btn.addEventListener("click", (e) => {
      e.stopPropagation();
      const skillName = btn.dataset.skill;
      const habilidade = skills.find(h => h.nome === skillName);
      if (!habilidade) return;

      sidebarContent.innerHTML = `
        <h3>Skill: ${habilidade.nome}</h3>
        <p>${habilidade.descricao || ""}</p>
        <button id="backToChar" class="bond-btn">← Back</button>
      `;
      document.getElementById("backToChar").addEventListener("click", (e) => {
        e.stopPropagation();
        showCharacterDetails(p);
      });
    });
  });
}

/* ====== SALVAR / Load TIMES (localStorage) ====== */

// pega composição atual por NOME do personagem (não por src)
function getCurrentTeamByName() {
    // titulares: procuramos .hex dentro de .player-slot (apenas as hex)
    const mainHexes = Array.from(document.querySelectorAll(".hex"));
    const main = mainHexes.map(h => h.dataset.nome || null);

    // bench: cada .bench-slot
    const benches = Array.from(document.querySelectorAll(".bench-slot"));
    const benchNames = benches.map(b => b.dataset.nome || null);

    return { main, bench: benchNames };
}

const saveTeamBtn = document.getElementById("saveTeamBtn");
saveTeamBtn.addEventListener("click", (e) => {
    e.stopPropagation();
    const teamName = prompt("Type team name:");
    if (!teamName) return;

    let teams = JSON.parse(localStorage.getItem("savedTeams") || "{}");

    if (teams[teamName]) {
        if (!confirm(`Team "${teamName}" is already saved. Do you want to replace?`)) {
            return;
        }
    }

    const savePayload = {
  ...getCurrentTeamByName(),   // { main: [...], bench: [...] }
  items: serializeTeamItems()  // <- memories / potentials por slot
};

teams[teamName] = savePayload;
localStorage.setItem("savedTeams", JSON.stringify(teams));
    alert(`Team "${teamName}" saved!`);

    showSavedTeams();
    sidebar.classList.add("open");
    menuBtn.style.display = "none";
});

    // wrapper: um passo no sentido horário + housekeeping
  function rotateMainGridClockwise() {
  rotateRingClockwise(1);           // gira o anel (L fica parado)
  const sm = document.getElementById("scrollMenu");
  if (sm) sm.style.display = "none";
  if (typeof updateSynergies === "function") updateSynergies();
  }
    const rotateBtn = document.getElementById("rotateBtn");
  if (rotateBtn) {
  rotateBtn.addEventListener("click", (e) => {
      e.stopPropagation();
      rotateMainGridClockwise();
    });
  }
/* mostra lista de times salvos no painel lateral */
function showSavedTeams() {
    const teams = JSON.parse(localStorage.getItem("savedTeams") || "{}");
    let html = "<h3>Saved teams</h3>";

    if (Object.keys(teams).length === 0) {
        html += "<p>No saved teams</p>";
    } else {
        html += `<div class="saved-list">`;
        for (const [name, team] of Object.entries(teams)) {
            html += `
                <div style="margin-bottom:8px; display:flex; align-items:center; justify-content:space-between;">
                    <div style="text-align:left;">
                        <b>${name}</b>
                    </div>
                    <div>
                        <button class="load-btn" data-name="${name}">Load</button>
                        <button class="del-btn" data-name="${name}">Delete</button>
                    </div>
                </div>
            `;
        }
        html += `</div>`;
    }

    sidebarContent.innerHTML = html;


    document.querySelectorAll(".load-btn").forEach(btn => {
        btn.addEventListener("click", (e) => {
        e.stopPropagation();
        const name = btn.dataset.name;
        loadTeam(name);

        // Atualiza sinergias e mantém menu aberto na lista
        updateSynergies();
        sidebar.classList.add("open");
        menuBtn.style.display = "none";
        });
    });

    document.querySelectorAll(".del-btn").forEach(btn => {
        btn.addEventListener("click", (e) => {
            e.stopPropagation();
            const name = btn.dataset.name;
            if (confirm(`Delete team "${name}"?`)) {
                deleteTeam(name);
                showSavedTeams();
            }
        });
    });
}

function deleteTeam(name) {
    let teams = JSON.parse(localStorage.getItem("savedTeams") || "{}");
    delete teams[name];
    localStorage.setItem("savedTeams", JSON.stringify(teams));
}

/* Carrega time — monta usando setCharacter... */
function loadTeam(name) {
  equipState.clear();  // evita lixo de items grudado em slots antigos
  const teams = JSON.parse(localStorage.getItem("savedTeams") || "{}");
  const team = teams[name];
  if (!team) return;

  selecionados = [];

  // limpa grid e bench
  document.querySelectorAll(".hex, .bench-slot").forEach(slot => {
    slot.innerHTML = "";
    delete slot.dataset.nome;
    const infoDiv = slot.parentElement.querySelector('.player-info');
    if (infoDiv) {
      if (slot.classList.contains("bench-slot")) infoDiv.textContent = "Bench"; // ou "Banco"
      else infoDiv.textContent = slot.dataset.role || slot.getAttribute("data-role") || "";
    }
  });

  // 🔧 NOVO: alinhar orientação do grid ao time salvo
  orientGridToSavedTeam(team);

  // agora preenche titulares nos índices do time salvo
  const hexes = Array.from(document.querySelectorAll(".hex"));
  team.main.forEach((nome, i) => {
    if (!nome) return;
    const personagem = characters.find(p => p.nome === nome);
    if (personagem && hexes[i]) {
      setCharacter(hexes[i], personagem, hexes[i].dataset.role || hexes[i].getAttribute("data-role"));
    }
  });

    const benches = Array.from(document.querySelectorAll(".bench-slot"));
    team.bench.forEach((nome, i) => {
        if (!nome) return;
        const personagem = characters.find(p => p.nome === nome);
        if (personagem && benches[i]) {
            setCharacter(benches[i], personagem, 'bench');
            attachBenchEvents(benches[i]);
        }
    });

    equipState.clear();                 // (garante que nada antigo fique no Map)
    restoreTeamItems(team.items);       // <- aplica memories/potentials
    updateSynergies();
}

/* ====== ABRIR / FECHAR MENU ====== */
const menuBtn = document.getElementById("menuBtn");
const sidebar = document.getElementById("sidebar");
const closeSidebar = document.getElementById("closeSidebar");

menuBtn.addEventListener("click", (e) => {
    e.stopPropagation();
    sidebar.classList.add("open");
    menuBtn.style.display = "none";
});

closeSidebar.addEventListener("click", (e) => {
    e.stopPropagation();
    sidebar.classList.remove("open");
    menuBtn.style.display = "block";
});

// Fecha se clicar fora do painel (ignora se clicar dentro)
document.addEventListener("click", (e) => {
    // Clique dentro do sidebar ou no botão de abrir → não fecha
    if (sidebar.contains(e.target) || e.target === menuBtn) {
        return;
    }

    // Clique num personagem → não fecha
   if (e.target.closest(".char-card, .person-card, #charList")) {
  return;
}

    // Clique em botões de voltar (FAQ, Credits, Synergies, Detalhes) → não fecha
    if (
        e.target.closest("#backToHelp") ||
        e.target.closest("#backToSynergies") ||
        e.target.closest("#backToChar")
    ) {
        return;
    }

    // Fecha apenas se realmente foi fora
    if (sidebar.classList.contains("open")) {
        sidebar.classList.remove("open");
        menuBtn.style.display = "block";
    }
});
    // Botão para limpar todo o time e resetar o banco
    document.getElementById("clearTeamBtn").addEventListener("click", (e) => {
    e.stopPropagation();
    if (!confirm("Are you sure you want to reset court and bench?")) return;

    // Fecha o Side Menu se estiver aberto
    sidebar.classList.remove("open");
    menuBtn.style.display = "block";

    // Limpa seleção
    selecionados = [];
    equipState.clear();
    document.querySelectorAll('.hex, .bench-slot')
   .forEach(el => el.querySelectorAll('.item-badge,.item-gear').forEach(n => n.remove()));

    clearAllEquips();
    document.querySelectorAll('.hex, .bench-slot').forEach(el => {
    if (el.dataset.nome || el.dataset.charName) removeCharacter(el);
});
    // Reseta todos os slots principais
    document.querySelectorAll(".hex").forEach(slot => {
        slot.innerHTML = "";
        delete slot.dataset.nome;
        const infoDiv = slot.parentElement.querySelector('.player-info');
        infoDiv.textContent = slot.dataset.role || slot.getAttribute("data-role") || "";
    });

    // Reseta banco para 3 slots
    const benchRow = document.getElementById("bench-row");
    benchRow.querySelectorAll(".player-slot.bench").forEach((benchSlot, index) => {
        if (index >= 3) {
            benchSlot.remove();
        } else {
            const slot = benchSlot.querySelector(".bench-slot");
            slot.innerHTML = "";
            delete slot.dataset.nome;
            const infoDiv = benchSlot.querySelector('.player-info');
            infoDiv.textContent = "Bench";
        }
    });
    updateSynergies();
    });
    /* ===================== ITEMS: Memory + Potential (4p/2p) ===================== */

/** Estat keys do seu dataset */
const STAT_KEYS = ["Serve","Spike","Set","Receive","Block","Save"];

/** Estado por slot: { memoryId, set4, set2 } */
const equipState = new Map();

/** Utils de slot */
function getSlotId(el){
  if(!el.dataset.slotId){
    const prefix = el.classList.contains('bench-slot') ? 'bench' : 'court';
    const all = [...document.querySelectorAll('.hex, .bench-slot')];
    const idx = all.indexOf(el);
    el.dataset.slotId = `${prefix}-${idx >= 0 ? idx : Math.random().toString(36).slice(2,8)}`;
  }
  return el.dataset.slotId;
}
function getSlotChar(el){ return el?.dataset?.charName || null; }
function findCharacterByName(name){ return characters.find(c => c.nome === name) || null; }

/** Aplicadores de bônus */
function applyBonus(twoPiece, bonus){
  if(!bonus) return;
  for(const [stat, mod] of Object.entries(bonus)){
    if(twoPiece[stat] == null) continue;
    if(mod.pct)  twoPiece[stat] = Math.round(twoPiece[stat]*(1+mod.pct/100));
    if(mod.flat) twoPiece[stat] = Math.max(0, twoPiece[stat]+mod.flat);
  }
}
function computeEffectiveStats(baseStats, memoryId, set4Id, set2Id){
  const out = {...baseStats};
  // Memory
  if(memoryId){
    const mem = memoryCatalog.find(m=>m.id===memoryId);
    if(mem) applyBonus(out, mem.bonus);
  }
  // Potential (sets)
  if(set2Id){
    const s2 = setCatalog.find(s=>s.id===set2Id);
    if(s2) applyBonus(out, s2.twoPiece);
  }
  if(set4Id){
    const s4 = setCatalog.find(s=>s.id===set4Id);
    if(s4){
      // comportamento comum: 4p também concede o 2p do mesmo set
      if(!set2Id || set2Id===set4Id) applyBonus(out, s4.twoPiece);
      applyBonus(out, s4.fourPiece);
    }
  }
  return out;
}


// normaliza função (role) do personagem para os códigos do catálogo
function normalizeRole(role){
  const r = String(role||"").toLowerCase();
  if (["s","setter","levantador"].includes(r)) return "S";
  if (["mb","middle","middle blocker","central","meio"].includes(r)) return "MB";
  if (["ws","wing","wing spiker","ponteiro","ponta"].includes(r)) return "WS";
  if (["op","opposite","oposto"].includes(r)) return "OP";
  if (["l","libero","líbero","libero"].includes(r)) return "L";
  return role || "WS"; // fallback
}

// pega % de um bônus {pct} dado um stat
function pctOf(obj, key){
  return (obj && obj[key] && typeof obj[key].pct === "number") ? obj[key].pct : 0;
}

// normaliza nomes p/ casar personagem com memória
function norm(s){
  return (s||"").toLowerCase()
    .normalize('NFD').replace(/[\u0300-\u036f]/g,'') // sem acento
    .replace(/[^\p{L}\p{N}]+/gu,' ')                 // sem pontuação
    .trim();
}
function recommendMemoryForCharacter(ch, allowedMem){
  if (!allowedMem || allowedMem.length === 0) return null;
  const cname = norm(ch.nome || ch.name);

  // 1) owner explícito (se você usa esse campo)
  let cand = allowedMem.find(m => m.owner && norm(m.owner) === cname);
  if (cand) return cand.id;

  // 2) nome/id contém o nome do personagem (ex.: "Ushijima UR")
  cand = allowedMem.find(m => norm(m.name).includes(cname) || norm(m.id).includes(cname.replace(/\s+/g,'_')));
  if (cand) return cand.id;

  // 3) todos os tokens do nome do personagem aparecem no nome da memória
  const tokens = cname.split(' ').filter(Boolean);
  cand = allowedMem.find(m => tokens.every(t => norm(m.name).includes(t)));
  if (cand) return cand.id;

  // 4) fallback: primeira compatível
  return allowedMem[0]?.id || null;
}


function topStatKey(stats){
  let bestK=null, bestV=-Infinity;
  for(const k of STAT_KEYS){
    const v = typeof stats?.[k] === "number" ? stats[k] : -Infinity;
    if (v > bestV){ bestV=v; bestK=k; }
  }
  return bestK;
}

function totalPctForCombo(set4, set2, statKey){
  let total = 0;
  if (set4){
    // 4p concede 2p do mesmo set quando não há 2p selecionado ou quando é o mesmo set
    if ((!set2 || set2.id === set4.id) && set4.twoPiece) total += pctOf(set4.twoPiece, statKey);
    if (set4.fourPiece) total += pctOf(set4.fourPiece, statKey);
  }
  if (set2 && (!set4 || set2.id !== set4.id) && set2.twoPiece){
    total += pctOf(set2.twoPiece, statKey);
  }
  return total;
}

// util: pega % de um bônus para um stat
function pctOf(obj, key){
  return (obj && obj[key] && typeof obj[key].pct === 'number') ? obj[key].pct : 0;
}
// util: qual o maior stat base do personagem
function topStatKey(stats){
  let bestK=null, bestV=-Infinity;
  for(const k of STAT_KEYS){
    const v = typeof stats?.[k] === "number" ? stats[k] : -Infinity;
    if (v > bestV){ bestV=v; bestK=k; }
  }
  return bestK;
}

function recommendSetsByTopStat(ch, allowedSet){
  if (!allowedSet || allowedSet.length === 0) return { set4:null, set2:null };

  // helpers locais
  const findSetIdByName = (arr, name) => {
    const n = (name||"").toLowerCase();
    const hit = arr.find(s =>
      (s.name && s.name.toLowerCase() === n) ||
      (s.id   && s.id.toLowerCase()   === n)
    );
    return hit ? hit.id : null;
  };
  const hasSymbol = (sym) => Array.isArray(ch.symbols) && ch.symbols.includes(sym);

  // escolhe o melhor 4p e 2p para um stat (mantém a sua regra anterior)
  const bestByStat = (statKey) => {
    let best4 = null, best4Score = -Infinity;
    for (const s4 of allowedSet){
      const score = pctOf(s4.twoPiece, statKey) + pctOf(s4.fourPiece, statKey);
      if (score > best4Score){ best4Score = score; best4 = s4; }
    }
    let best2 = null, best2Score = -Infinity;
    for (const s2 of allowedSet){
      if (best4 && s2.id === best4.id) continue;      // 2p diferente do 4p
      const score = pctOf(s2.twoPiece, statKey);
      if (score > best2Score){ best2Score = score; best2 = s2; }
    }
    return { set4: best4?.id || null, set2: best2?.id || null };
  };

  const role = normalizeRole(ch.funcao); // já existe no seu código
  const top  = topStatKey(ch.Stats || {}); // já existe no seu código

  // --- Regra 1: Setters (S) têm recomendação fixa
  if (role === 'S'){ // Ex.: é montado a partir de ch.funcao na abertura do modal
    const s4 = findSetIdByName(allowedSet, 'Precise Set');
    const s2 = findSetIdByName(allowedSet, 'Precise Serve');
    return { set4: s4, set2: (s2 && s2 !== s4) ? s2 : null };
  }

  // --- Regra 3: maior atributo = Spike -> símbolos "quick" ou "power"
  if (top === 'Spike'){
    if (hasSymbol('img/quicksymbol.png')){
      const s4 = findSetIdByName(allowedSet, 'Rapid Quick Attack');
      const s2 = findSetIdByName(allowedSet, 'Sharp Sense');
      if (s4 || s2) return { set4: s4, set2: (s2 && s2 !== s4) ? s2 : null };
      // se não achar pelos nomes (catálogo diferente), cai no fallback
    }
    if (hasSymbol('img/powersymbol.png')){
      const s4 = findSetIdByName(allowedSet, 'Power Vibe');
      const s2 = findSetIdByName(allowedSet, 'Power Rise');
      if (s4 || s2) return { set4: s4, set2: (s2 && s2 !== s4) ? s2 : null };
    }
  }

  // --- Regra 2 (fallback): como antes, escolher pelo maior atributo
  return bestByStat(top || 'Spike'); // se não houver top claro, Spike como padrão
}

// helper p/ gerar HTML de um ícone com etiqueta opcional
function badgeIconHTML(src, title, tagText){
  if(!src) return "";
  return `
    <span class="ico" title="${title || ""}">
      <img src="${src}" alt="">
      ${tagText ? `<span class="tag">${tagText}</span>` : ""}
    </span>`;
}

function updateItemBadge(slotEl){
  // remove a badge anterior
  slotEl.querySelectorAll('.item-badge').forEach(n=>n.remove());

  // não mostra badge se o slot estiver vazio
  if(!slotEl.dataset.charName) return;

  const slotId = getSlotId(slotEl);
  const eq = equipState.get(slotId);
  if(!eq) return;

  const mem = eq.memoryId ? memoryCatalog.find(m=>m.id===eq.memoryId) : null;
  const s4  = eq.set4      ? setCatalog.find(s=>s.id===eq.set4)       : null;
  const s2  = eq.set2      ? setCatalog.find(s=>s.id===eq.set2)       : null;

  if(!mem && !s4 && !s2) return;

  const badge = document.createElement('div');
  badge.className = 'item-badge';

  // ÍCONES (sem texto). Etiqueta pequena: "M", "4", "2" (remova se não quiser nada)
  const parts = [];
  if(mem) parts.push(badgeIconHTML(mem.img,  `Memory: ${mem.name}`,          "M"));
  if(s4)  parts.push(badgeIconHTML(s4.img,   `Potential 4-Piece: ${s4.name}`, "4"));
  if(s2)  parts.push(badgeIconHTML(s2.img,   `Potential 2-Piece: ${s2.name}`, "2"));

  badge.innerHTML = parts.join("");
  slotEl.appendChild(badge);
}

/** Botão ⚙️ para abrir o modal (não conflita com seu dblclick de Details) */
function ensureItemGear(slotEl){
  if(slotEl.querySelector('.item-gear')) return;
  if(!slotEl.dataset.charName) return;
  const btn = document.createElement('button');
  btn.type = 'button';
  btn.className = 'item-gear';
  btn.title = 'Items (Memory + Potential)';
  btn.innerHTML = '⚙️';
  btn.addEventListener('click', (e)=>{ e.stopPropagation(); e.preventDefault(); openItemModal(slotEl); });
  slotEl.appendChild(btn);
}
function removeItemGear(slotEl){ slotEl.querySelectorAll('.item-gear').forEach(n=>n.remove()); }

/** MODAL com Memory + Potential (4p/2p) */
function openItemModal(slotEl){
  const charName = getSlotChar(slotEl);
  if(!charName){ alert('Coloque um personagem no slot antes de equipar.'); return; }
  const ch = findCharacterByName(charName);
  if(!ch){ alert('Personagem não encontrado.'); return; }

  const slotId = getSlotId(slotEl);
  const current = equipState.get(slotId) || { memoryId:null, set4:null, set2:null };

  const role = normalizeRole(ch.funcao);
const allowedMem = memoryCatalog.filter(m => m.positions?.includes(role));
const allowedSet = setCatalog.filter(s => !s.positions || s.positions.includes(role));

  const $back = document.createElement('div'); $back.className = 'item-modal-backdrop';
  const $box  = document.createElement('div'); $box.className  = 'item-modal';
  $back.appendChild($box);

  $box.innerHTML = `
  <h3>Items for <b>${ch.nome}</b> (${ch.funcao})</h3>

   <div class="items-3col">
    <div class="row-3col">
      <div class="label">Memory</div>
      <img id="memThumb" class="big-thumb" src="" alt="">
      <div>
        <select id="memSel" class="select-wide">
          <option value="">— none —</option>
          ${allowedMem.map(m=>`<option value="${m.id}" ${m.id===current.memoryId?'selected':''}>${m.name}</option>`).join('')}
        </select>
        <div id="memDesc" class="subdesc"></div>
      </div>
    </div>

    <div class="row-3col">
      <div class="label">4-Piece</div>
      <img id="set4Thumb" class="big-thumb" src="" alt="">
      <div>
        <select id="set4Sel" class="select-wide">
          <option value="">— none —</option>
          ${allowedSet.map(s=>`<option value="${s.id}" ${s.id===current.set4?'selected':''}>${s.name}</option>`).join('')}
        </select>
        <div id="set4Desc" class="subdesc"></div>
      </div>
    </div>

    <div class="row-3col">
      <div class="label">2-Piece</div>
      <img id="set2Thumb" class="big-thumb" src="" alt="">
      <div>
        <select id="set2Sel" class="select-wide">
          <option value="">— none —</option>
          ${allowedSet.map(s=>`<option value="${s.id}" ${s.id===current.set2?'selected':''}>${s.name}</option>`).join('')}
        </select>
        <div id="set2Desc" class="subdesc"></div>
      </div>
    </div>

    <div class="row-3col">
      <div class="label">Stats</div>
      <div></div>
      <div><ul id="statsList" class="stats-list"></ul></div>
    </div>
  </div>

  <div class="item-actions">
    <button class="item-btn" id="btnRec">Recommend</button>
    <button class="item-btn" id="btnClear">Clear</button>
    <button class="item-btn" id="btnSave">Save</button>
    <button class="item-btn" id="btnClose">Close</button>
  </div>
`;
  document.body.appendChild($back);

  const $mem  = $box.querySelector('#memSel');
  const $mD   = $box.querySelector('#memDesc');
  const $set4 = $box.querySelector('#set4Sel');
  const $set2 = $box.querySelector('#set2Sel');
  const $d4   = $box.querySelector('#set4Desc');
  const $d2   = $box.querySelector('#set2Desc');
  const $statsList = $box.querySelector('#statsList');
  const $memThumb  = $box.querySelector('#memThumb');
  const $set4Thumb = $box.querySelector('#set4Thumb');
  const $set2Thumb = $box.querySelector('#set2Thumb');

  function getSetBonusPct(statKey){
  let total = 0;
  const s4 = setCatalog.find(s => s.id === $set4.value);
  const s2 = setCatalog.find(s => s.id === $set2.value);

  if (s4){
    if (s4.twoPiece && s4.twoPiece[statKey] && typeof s4.twoPiece[statKey].pct === "number")
      total += s4.twoPiece[statKey].pct;   // 2p “embutido” no 4p
    if (s4.fourPiece && s4.fourPiece[statKey] && typeof s4.fourPiece[statKey].pct === "number")
      total += s4.fourPiece[statKey].pct;  // 4p
  }
  // só soma 2p diferente do 4p
  if (s2 && (!s4 || s2.id !== s4.id)){
    if (s2.twoPiece && s2.twoPiece[statKey] && typeof s2.twoPiece[statKey].pct === "number")
      total += s2.twoPiece[statKey].pct;
  }
  return total;
}

  function refreshThumbs(){
  const mem = memoryCatalog.find(m=>m.id===$mem.value);
  const s4  = setCatalog.find(s=>s.id===$set4.value);
  const s2  = setCatalog.find(s=>s.id===$set2.value);
  $memThumb.src  = mem?.img  || "";
  $set4Thumb.src = s4?.img   || "";
  $set2Thumb.src = s2?.img   || "";
}

  function renderChoice($el, item, fallbackTitle){
  if(item){
    $el.classList.remove('empty');
    $el.querySelector('img').src = item.img || "";
    $el.querySelector('.title').textContent = item.name;
    $el.querySelector('.subtitle').textContent = item.short || ""; // opcional
  }else{
    $el.classList.add('empty');
    $el.querySelector('img').src = "";
    $el.querySelector('.title').textContent = fallbackTitle || "— none —";
    $el.querySelector('.subtitle').textContent = "";
  }
}

function refreshChoices(){
  const mem = memoryCatalog.find(m=>m.id===$mem.value);
  const s4  = setCatalog.find(s=>s.id===$set4.value);
  const s2  = setCatalog.find(s=>s.id===$set2.value);
  renderChoice($box.querySelector('#memChoice'),  mem, "— none —");
  renderChoice($box.querySelector('#set4Choice'), s4,  "— none —");
  renderChoice($box.querySelector('#set2Choice'), s2,  "— none —");
}
  function updateSetLocks(){
  const v4 = $set4.value, v2 = $set2.value;
  [...$set2.options].forEach(o => o.disabled = !!v4 && o.value === v4 && o.value !== "");
  [...$set4.options].forEach(o => o.disabled = !!v2 && o.value === v2 && o.value !== "");
}
$set4.addEventListener('change', ()=>{ updateSetLocks(); refreshDescs(); renderStats(); });
$set2.addEventListener('change', ()=>{ updateSetLocks(); refreshDescs(); renderStats(); });
updateSetLocks();

  function refreshDescs(){
  const mem = memoryCatalog.find(m=>m.id===$mem.value);
  const s4  = setCatalog.find(s=>s.id===$set4.value);
  const s2  = setCatalog.find(s=>s.id===$set2.value);
  $mD.textContent = mem ? (mem.desc || '') : '';
  $d4.textContent = s4 ? (s4.desc4 || '') : '';
  $d2.textContent = s2 ? (s2.desc2 || '') : '';
  refreshThumbs();
}
// Retorna quanto a Memory soma EM PONTOS para um stat específico
function getMemoryBonusAbs(statKey){
  const mem = memoryCatalog.find(m=>m.id===$mem.value);
  if(!mem || !mem.bonus || !mem.bonus[statKey]) return 0;
  const base = ch.Stats[statKey] || 0;
  const mod  = mem.bonus[statKey];
  const pct  = mod.pct ? Math.round(base * (mod.pct/100)) : 0;
  const flat = mod.flat ? mod.flat : 0;
  return pct + flat; // valor absoluto adicionado pela memória
}

// Retorna o TOTAL de % dos sets (2p/4p) efetivamente aplicados para o stat
function getSetBonusPct(statKey){
  let total = 0;

  const s4 = setCatalog.find(s=>s.id===$set4.value);
  const s2 = setCatalog.find(s=>s.id===$set2.value);

  // 4p selecionado: normalmente concede o 2p do mesmo set se o 2p não estiver escolhido
  if(s4){
    // aplica 2p do 4p quando NÃO há set2 OU quando set2 é o mesmo set
    if((!s2 || s2.id === s4.id) && s4.twoPiece && s4.twoPiece[statKey]?.pct){
      total += s4.twoPiece[statKey].pct;
    }
    // aplica 4p
    if(s4.fourPiece && s4.fourPiece[statKey]?.pct){
      total += s4.fourPiece[statKey].pct;
    }
  }

  // 2p de um set diferente do 4p
  if(s2 && (!s4 || s2.id !== s4.id)){
    if(s2.twoPiece && s2.twoPiece[statKey]?.pct){
      total += s2.twoPiece[statKey].pct;
    }
  }

  return total; // só porcentagem
}

  // helper para considerar 0, 0.0, null etc.
function zeroish(x){ return !x || Math.abs(x) < 1e-6; }

function renderStats(){
  const rows = STAT_KEYS.map((k)=>{
    const base   = ch.Stats[k] || 0;
    const memAbs = getMemoryBonusAbs(k);   // pontos absolutos da Memory
    const setPct = getSetBonusPct(k);      // % total dos sets para esse stat

    const parts = [String(base)];
    if (!zeroish(memAbs)) parts.push(`+ ${memAbs}`);
    if (!zeroish(setPct)) parts.push(`+ ${setPct}%`); // só mostra se > 0%

    return `<li><b>${k}:</b> ${parts.join(' ')}</li>`;
  }).join('');
  $statsList.innerHTML = rows;
}

  $mem.addEventListener('change', ()=>{ refreshDescs(); renderStats(); });
  $set4.addEventListener('change', ()=>{ updateSetLocks(); refreshDescs(); renderStats(); });
  $set2.addEventListener('change', ()=>{ updateSetLocks(); refreshDescs(); renderStats(); });
  updateSetLocks();refreshDescs(); renderStats();

  $box.querySelector('#btnClose').onclick = ()=> $back.remove();
  $box.querySelector('#btnClear').onclick = ()=>{
    $mem.value=""; $set4.value=""; $set2.value="";
    refreshDescs(); renderStats();
  };
  $box.querySelector('#btnSave').onclick = ()=>{
    const data = { memoryId: $mem.value || null, set4: $set4.value || null, set2: $set2.value || null };
    equipState.set(slotId, data);
    updateItemBadge(slotEl);
    $back.remove();
  };
  $box.querySelector('#btnRec').onclick = ()=>{
  const memId = recommendMemoryForCharacter(ch, allowedMem);
  const rec   = recommendSetsByTopStat(ch, allowedSet);

  if (memId) $mem.value = memId;
  if (rec.set4) $set4.value = rec.set4;
  $set2.value = rec.set2 || "";           // sempre tenta diferente; se não houver, fica vazio

  updateSetLocks();                        // mantém 4p/2p mutuamente exclusivos na UI
  refreshDescs();
  renderStats();
};
}

/** Hooks para seu fluxo atual */
window.afterAssignCharacter = function(slotEl, charName){
  slotEl.dataset.charName = charName;
  updateItemBadge(slotEl);
  ensureItemGear(slotEl); // botão ⚙️ para abrir o modal (não conflita com dblclick de detalhes)
};
window.afterRemoveCharacter = function(slotEl){
  delete slotEl.dataset.charName;   // mantém compatibilidade com suas badges
  clearSlotEquip(slotEl);           // <- limpa Map + badges/engrenagem
  updateItemBadge(slotEl);          // defensivo (como já faz no assign)
};

// Guarda por slot, mas também salva o nome do char para restaurar por nome
function serializeTeamItems(){
  const data = {};
  document.querySelectorAll('.hex, .bench-slot').forEach(el=>{
    const id = getSlotId(el);
    const charName = el.dataset.charName || el.dataset.nome || null;
    if (!charName) return;
    const eq = equipState.get(id) || { memoryId:null, set4:null, set2:null };
    data[id] = { charName, ...eq };
  });
  return data;
}

// Ao carregar: 1) limpa tudo; 2) tenta aplicar itens pelo NOME do char.
// Se não achar o nome no grid atual, cai no slot salvo (fallback).
function restoreTeamItems(saved){
  clearAllEquips();
  if (!saved) return;

  const allSlots = Array.from(document.querySelectorAll('.hex, .bench-slot'));

  // mapa rápido: nome -> slot atual
  const byName = new Map();
  allSlots.forEach(el=>{
    const n = el.dataset.charName || el.dataset.nome || null;
    if (n) byName.set(n, el);
  });

  for (const [slotId, payload] of Object.entries(saved)){
    const target =
      byName.get(payload.charName) ||
      allSlots.find(e => getSlotId(e) === slotId);

    if (!target) continue;

    const id = getSlotId(target);
    equipState.set(id, {
      memoryId: payload.memoryId || null,
      set4:     payload.set4     || null,
      set2:     payload.set2     || null
    });
    updateItemBadge(target);
    ensureItemGear(target);
  }
}
// ========= DRAG & DROP (compatível com sua estrutura) =========
(function(){
  if (window.__dndFix) return; window.__dndFix = true;

  const getChar = n => characters.find(c => c.nome === n);
  let dragCtx = null; // {type:'character'|'slot', nome?, id?}

  function setDragCtx(obj, e){
    dragCtx = obj;
    try { e.dataTransfer.setData('application/json', JSON.stringify(obj)); } catch(_) {}
    try { e.dataTransfer.setData('text/plain', JSON.stringify(obj)); } catch(_) {}
    e.dataTransfer.effectAllowed = (obj.type === 'slot') ? 'move' : 'copyMove';
  }

  function canDropCharOn(slot, p){
    const isBench = slot.classList.contains('bench-slot');
    if (isBench) return respeitaLimiteBench(p, slot);
    const role = slot.dataset.role || slot.getAttribute('data-role');
    return p.funcao === role;
  }

  function dropCharacterOn(slot, p) {
  // zera items pendurados nesse slot (é um overwrite vindo do menu)
  equipState.delete(getSlotId(slot));

  const isBench = slot.classList.contains('bench-slot');
  const role = isBench ? 'bench' : (slot.dataset.role || slot.getAttribute('data-role'));
  setCharacter(slot, p, role);

  const sm = document.getElementById("scrollMenu");
  if (sm) sm.style.display = "none";
}

  function moveBetweenSlots(srcEl, dstEl){
  if (srcEl === dstEl) return;

  const pSrc = characters.find(x => x.nome === srcEl.dataset.nome);
  const pDst = dstEl.dataset.nome ? characters.find(x => x.nome === dstEl.dataset.nome) : null;

  const dstIsBench = dstEl.classList.contains('bench-slot');
  const srcIsBench = srcEl.classList.contains('bench-slot');
  const dstRole = dstIsBench ? 'bench' : (dstEl.dataset.role || dstEl.getAttribute('data-role'));
  const srcRole = srcIsBench ? 'bench' : (srcEl.dataset.role || srcEl.getAttribute('data-role'));

  // 🔒 TRAVAS: destino precisa aceitar o personagem
  if (!dstIsBench && pSrc.funcao !== dstRole) return;
  if (dstIsBench && !respeitaLimiteBench(pSrc, dstEl)) return;

  // --- MIGRAÇÃO/SWAP DE ITENS (equipState) ---
  const srcId = getSlotId(srcEl);
  const dstId = getSlotId(dstEl);
  const srcEq = equipState.get(srcId) || null;
  const dstEq = equipState.get(dstId) || null;

  if (pDst){
    // 🔒 TRAVAS simétricas para a volta
    if (!srcIsBench && pDst.funcao !== srcRole) return;
    if (srcIsBench && !respeitaLimiteBench(pDst, srcEl)) return;

    // swap de itens
    if (srcEq) equipState.set(dstId, srcEq); else equipState.delete(dstId);
    if (dstEq) equipState.set(srcId, dstEq); else equipState.delete(srcId);

    setCharacter(dstEl, pSrc, dstRole);
    setCharacter(srcEl, pDst, srcRole);
  } else {
    // mover p/ slot vazio: leva os itens juntos
    const keep = srcEq ? { ...srcEq } : null;
    equipState.delete(srcId);
    if (keep) equipState.set(dstId, keep);

    removeCharacter(srcEl);
    setCharacter(dstEl, pSrc, dstRole);
  }
}

  function decorateDropTarget(slot){
    slot.addEventListener('dragover', (e)=>{
      // permita o drop SEM depender de getData()
      e.preventDefault();
      const ctx = dragCtx;
      let ok = false;
      if (ctx?.type === 'character'){
        const p = getChar(ctx.nome);
        ok = !!p && canDropCharOn(slot, p);
      } else if (ctx?.type === 'slot'){
        const srcEl = Array.from(document.querySelectorAll('.hex, .bench-slot')).find(el => getSlotId(el) === ctx.id);
        const p = srcEl?.dataset.nome ? getChar(srcEl.dataset.nome) : null;
        ok = !!p && (slot === srcEl || canDropCharOn(slot, p));
      }
      slot.classList.toggle('drop-ok', ok);
      slot.classList.toggle('drop-bad', ctx && !ok);
    });

    slot.addEventListener('dragleave', ()=> slot.classList.remove('drop-ok','drop-bad'));

    slot.addEventListener('drop', (e)=>{
      e.preventDefault();
      slot.classList.remove('drop-ok','drop-bad');
      const ctx = dragCtx; dragCtx = null; // consome o contexto

      if (!ctx) return;
      if (ctx.type === 'character'){
        const p = getChar(ctx.nome);
        if (p && canDropCharOn(slot, p)) dropCharacterOn(slot, p);
      } else if (ctx.type === 'slot'){
        const srcEl = Array.from(document.querySelectorAll('.hex, .bench-slot')).find(el => getSlotId(el) === ctx.id);
        if (srcEl) moveBetweenSlots(srcEl, slot);
      }
    });

    // habilita arrastar a partir do slot quando tiver personagem
    const refresh = ()=> slot.setAttribute('draggable', slot.dataset.nome ? 'true' : 'false');
    refresh();
    slot.addEventListener('dragstart', (e)=>{
      if (!slot.dataset.nome) return;
      setDragCtx({ type:'slot', id:getSlotId(slot), nome:slot.dataset.nome }, e);
    });

    // atualiza o draggable quando setar/remover
    const oldAssign = window.afterAssignCharacter;
    window.afterAssignCharacter = function(el, name){
      if (typeof oldAssign === 'function') oldAssign(el, name);
      if (el === slot) slot.setAttribute('draggable','true');
    };
    const oldRemove = window.afterRemoveCharacter;
    window.afterRemoveCharacter = function(el){
      if (typeof oldRemove === 'function') oldRemove(el);
      if (el === slot) slot.setAttribute('draggable','false');
    };
  }

  function decorateAll(){ document.querySelectorAll('.hex, .bench-slot').forEach(decorateDropTarget); }

  function initDnd(){
    // 1) Fontes: **#charList** (lista do menu lateral)
    const list = document.getElementById('charList');
    if (list){
      list.addEventListener('dragstart', (e)=>{
        const img = e.target.closest('img'); if (!img) return;
        const nome = img.alt || img.title;
        if (getChar(nome)) { img.setAttribute('draggable','true'); setDragCtx({type:'character', nome}, e); }
      });
      list.querySelectorAll('img').forEach(img => img.setAttribute('draggable','true'));
    }

    // 2) Fontes: #scrollMenu (seu menu flutuante por posição)
    const sm = document.getElementById('scrollMenu');
    if (sm){
      sm.addEventListener('dragstart', (e)=>{
        const img = e.target.closest('img'); if (!img) return;
        const nome = img.alt || img.title;
        if (getChar(nome)) { img.setAttribute('draggable','true'); setDragCtx({type:'character', nome}, e); }
      });
      sm.querySelectorAll('img').forEach(img => img.setAttribute('draggable','true'));
    }

    // 3) Alvos e fontes: quadra + banco
    decorateAll();

    // redecorar após rotacionar (se você rotaciona os hex com innerHTML)
    if (typeof window.rotateRingClockwise === 'function' && !window.__dndWrapRot){
      const old = window.rotateRingClockwise;
      window.rotateRingClockwise = function(){
        const r = old.apply(this, arguments);
        try { RING_IDX.map(i => document.querySelectorAll('.hex')[i]).forEach(decorateDropTarget); }
        catch(_) { decorateAll(); }
        return r;
      };
      window.__dndWrapRot = true;
    }

    // redecorar após adicionar novo slot de bench
    if (typeof window.addBenchSlot === 'function' && !window.__dndWrapAdd){
      const old = window.addBenchSlot;
      window.addBenchSlot = function(){
        const r = old.apply(this, arguments);
        const last = Array.from(document.querySelectorAll('.bench-slot')).pop();
        if (last) decorateDropTarget(last);
        return r;
      };
      window.__dndWrapAdd = true;
    }
  }

  if (document.readyState === 'loading'){
    document.addEventListener('DOMContentLoaded', initDnd);
  } else {
    initDnd();
  }
})();

// === fechar #charList ao clicar fora / ESC, ligado sob demanda ===
(function(){
  let off = null; // guard para remover handlers antigos

  function enableCloseOutsideCharList(){
  if (off) { off(); off = null; }

  const list = document.getElementById('charList');
  if (!list) return;

  const onDown = (e) => {
    // ✅ qualquer clique dentro do sidebar (filtros + lista) NÃO fecha
    if (e.target.closest('#sidebar-content')) return;

    // cliques no link que abre Characters também não fecham
    if (e.target.closest("[data-section='characters'], [data-open-charlist]")) return;

    // ❌ clique realmente fora => fecha
    list.classList.add('is-hidden');
    cleanup();
  };

    const onEsc = (e)=>{
      if (e.key === "Escape") {
        list.classList.add('is-hidden');
        cleanup();
      }
    };

    function cleanup(){
      document.removeEventListener('pointerdown', onDown, true);
      document.removeEventListener('keydown', onEsc);
      off = null;
    }

    document.addEventListener('pointerdown', onDown, true); // captura cedo
    document.addEventListener('keydown', onEsc);

    // fornece um “desligar” externo para quando trocar de seção
    off = cleanup;
  }

  // deixa acessível para chamar ao montar a seção
  window.enableCloseOutsideCharList = enableCloseOutsideCharList;
})();

function clearSlotEquip(slotEl){
  const id = getSlotId(slotEl);
  equipState.delete(id);
  slotEl.querySelectorAll('.item-badge,.item-gear').forEach(n=>n.remove());
}

function clearAllEquips(){
  equipState.clear();
  document.querySelectorAll('.hex, .bench-slot')
    .forEach(el => el.querySelectorAll('.item-badge,.item-gear').forEach(n=>n.remove()));
}

// mover o “equip” junto com o personagem (A -> B), trocando se B já tiver algo
function transferEquipState(fromEl, toEl){
  const a = getSlotId(fromEl);
  const b = getSlotId(toEl);
  const aEq = equipState.get(a) || null;
  const bEq = equipState.get(b) || null;

  if (aEq == null && bEq == null) return;

  // se B já tem alguém, trocamos; se B estava vazio, apenas movemos
  if (bEq != null && aEq != null){
    equipState.set(a, bEq);
    equipState.set(b, aEq);
  } else if (aEq != null){
    equipState.delete(a);
    equipState.set(b, aEq);
  } else { // bEq != null
    equipState.set(a, bEq);
    equipState.delete(b);
  }

  updateItemBadge(fromEl);
  updateItemBadge(toEl);
}
// ===== Recommend: preenche os slots vazios maximizando sinergias =====

// Soma total dos Stats do personagem
function sumStats(p){
  const S = p.Stats || {};
  let total = 0;
  for (const k in S) total += (S[k] || 0);
  return total;
}

// Coleta nomes atuais (starters e bench)
function getCurrentTeamNames(){
  const main = [...document.querySelectorAll('.hex')]
    .map(s => s.dataset.nome).filter(Boolean);
  const bench = [...document.querySelectorAll('.bench-slot')]
    .map(s => s.dataset.nome).filter(Boolean);
  return { main, bench };
}

// Quais slots de titulares estão vazios
function getEmptyStarterSlots(){
  return [...document.querySelectorAll('.hex')].filter(s => !s.dataset.nome);
}

// === Índices de sinergias (construídos 1x) ===
let BOND_INDEX = null;    // { bondName -> Set(nomes) }
let SCHOOL_INDEX = null;  // { schoolName -> Set(nomes) }

function buildSynergyIndices(){
  if (BOND_INDEX && SCHOOL_INDEX) return;
  BOND_INDEX = {};
  SCHOOL_INDEX = {};

  for (const p of characters){
    // Schools
    if (p.School){
      if (!SCHOOL_INDEX[p.School]) SCHOOL_INDEX[p.School] = new Set();
      SCHOOL_INDEX[p.School].add(p.nome);
    }
    // Bonds (vinculo pode ser string ou array)
    const vs = Array.isArray(p.vinculo) ? p.vinculo : (p.vinculo ? [p.vinculo] : []);
    for (const v of vs){
      if (!BOND_INDEX[v]) BOND_INDEX[v] = new Set();
      BOND_INDEX[v].add(p.nome);
    }
  }
}

// Conta quantas sinergias ativas (Schools + Bonds) do time final
// incluem ao menos 1 dos titulares que já estavam no grid (âncora).
function anchoredSynergyScore(activeSchools, activeBonds, oldMainSet){
  let score = 0;

  // Schools: se a school ativa tem pelo menos 1 membro já presente no grid original
  for (const sch of activeSchools){
    const members = SCHOOL_INDEX[sch];
    if (!members) continue;
    for (const name of members){
      if (oldMainSet.has(name)){
        score++;
        break;
      }
    }
  }
  // Bonds: se o bond ativo tem pelo menos 1 participante que já estava no grid original
  for (const bond of activeBonds){
    const members = BOND_INDEX[bond];
    if (!members) continue;
    for (const name of members){
      if (oldMainSet.has(name)){
        score++;
        break;
      }
    }
  }
  return score;
}

// Conta quantas sinergias ficariam ativas com os nomes passados
// (mesma regra do updateSynergies: Schools=starter-only com 4+, Bonds=starter+bench com 2+, exceto algumas que pedem 3)
function computeActivatedSynergyCount(mainNames, benchNames){
  // Mesmas exceções do seu painel
  const bondsRequire3 = new Set(["Swimming","Twin Heads"]);  // idem ao updateSynergies
  const DEFAULT_BOND_MIN = 2;
  const SCHOOL_MIN = 4;

  const SchoolsCount = {};
  const vinculosCount = {};

  // Contagem de School: só starters
  for (const nome of mainNames){
    const p = characters.find(x => x.nome === nome);
    if (!p) continue;
    SchoolsCount[p.School] = (SchoolsCount[p.School] || 0) + 1;
  }

  // Contagem de Bonds: starters + bench
  const allForBonds = [...mainNames, ...benchNames];
  for (const nome of allForBonds){
    const p = characters.find(x => x.nome === nome);
    if (!p) continue;
    const vs = Array.isArray(p.vinculo) ? p.vinculo : (p.vinculo ? [p.vinculo] : []);
    for (const v of vs){
      vinculosCount[v] = (vinculosCount[v] || 0) + 1;
    }
  }

  let count = 0;
  const activeSchools = new Set();
  const activeBonds = new Set();

  // Schools
  for (const school in SchoolsCount){
    if (SchoolsCount[school] >= SCHOOL_MIN){
      count++;
      activeSchools.add(school);
    }
  }
  // Bonds
  for (const v in vinculosCount){
    const required = bondsRequire3.has(v) ? 3 : DEFAULT_BOND_MIN;
    if (vinculosCount[v] >= required){
      count++;
      activeBonds.add(v);
    }
  }

  return { count, activeSchools, activeBonds };
}

// Gera todas as combinações escolhendo 1 candidato por slot (sem repetir nomes)
function* cartesianByIndex(lists){
  // lists: array de arrays (candidatos por slot)
  const idx = lists.map(()=>0);
  const lens = lists.map(l=>l.length);
  if (lens.some(len => len===0)) return;

  while (true){
    // combinação atual
    const combo = lists.map((l,i)=>l[idx[i]]);
    // valida duplicados de nomes
    const names = new Set(combo.map(c=>c.nome));
    if (names.size === combo.length) yield combo;

    // próximo índice (odômetro)
    let k = lists.length - 1;
    while (k >= 0){
      idx[k]++;
      if (idx[k] < lens[k]) break;
      idx[k] = 0;
      k--;
    }
    if (k < 0) break;
  }
}

// Principal
function recommendFill(){
  buildSynergyIndices();
  const emptySlots = getEmptyStarterSlots();
  if (emptySlots.length === 0){
    alert("No free slots available.");
    return;
  }

  const roles = emptySlots.map(s => s.dataset.role || s.getAttribute('data-role') || "");
  const { main: mainNow, bench: benchNow } = getCurrentTeamNames();
  const used = new Set([...mainNow, ...benchNow]);

  // Lista de candidatos por índice de slot (respeita função e evita duplicados já em uso)
  let lists = roles.map(role =>
    characters.filter(p => p.funcao === role && !used.has(p.nome))
  );

  // Se faltar candidato pra alguma posição, avisa
  if (lists.some(l => l.length === 0)){
    alert("Não há candidatos para pelo menos uma das posições restantes.");
    return;
  }

  // Base de sinergias atuais
  const base = computeActivatedSynergyCount(mainNow, benchNow).count;

  // Heurística de limitação: se <=3 slots vazios, busca exaustiva;
  // senão, poda pra top-N por potencial + stats pra não explodir combinatórias.
  const MAX_PER_ROLE = 8;
  if (emptySlots.length > 3){
    lists = lists.map(list => {
      // “delta sozinho”: o quanto ativaria se colocar só este personagem
      const scored = list.map(p => {
        const m = [...mainNow, p.nome];
        const c = computeActivatedSynergyCount(m, benchNow).count - base;
        return { p, delta: c, stats: sumStats(p) };
      });
      scored.sort((a,b) => (b.delta - a.delta) || (b.stats - a.stats));
      // pega top por delta/Stats; completa com top Stats se necessário
      const top = scored.slice(0, MAX_PER_ROLE).map(x => x.p);
      if (top.length < Math.min(MAX_PER_ROLE, list.length)){
        const restByStats = [...list]
          .filter(p => !top.includes(p))
          .sort((a,b)=>sumStats(b)-sumStats(a))
          .slice(0, MAX_PER_ROLE - top.length);
        return [...top, ...restByStats];
      }
      return top;
    });
  }

  // Se o produto das listas ficar absurdo, aplica um teto simples
  const totalComb = lists.reduce((acc, l)=>acc * l.length, 1);
  if (totalComb > 60000){
    lists = lists.map(list =>
      list.sort((a,b)=>sumStats(b)-sumStats(a)).slice(0, MAX_PER_ROLE)
    );
  }

  // Busca melhor combinação
  let best = { improvement: -Infinity, stats: -Infinity, combo: null };

  for (const combo of cartesianByIndex(lists)){
  if (combo.some(p => used.has(p.nome))) continue;

  const newMain = [...mainNow, ...combo.map(c=>c.nome)];
  const res = computeActivatedSynergyCount(newMain, benchNow);
  const improvement = res.count - base;
  const stats = combo.reduce((s,p)=>s+sumStats(p),0);
  const anchored = anchoredSynergyScore(res.activeSchools, res.activeBonds, new Set(mainNow));

  // ordem de prioridade: 1) melhoria de sinergias  2) sinergias ancoradas  3) soma de stats
  if (
    improvement > best.improvement ||
    (improvement === best.improvement && anchored > best.anchored) ||
    (improvement === best.improvement && anchored === best.anchored && stats > best.stats)
  ){
    best = { improvement, stats, combo, res, anchored };
  }
}

  if (!best.combo){
    alert("Não foi possível calcular uma recomendação.");
    return;
  }

  // Regra: se não aumentar sinergia, escolhe por maior soma de Stats (já é o desempate acima)
  // Aplicar no grid
  best.combo.forEach((person, i) => {
    const slot = emptySlots[i];
    const role = roles[i];
    setCharacter(slot, person, role); // usa sua função; atualiza infos e sinergias automaticamente
  });

  // Opcional: feedback
  const picked = best.combo.map(p=>p.nome).join(", ");
  if (best.improvement > 0){
    console.log(`Recommend: +${best.improvement} sinergias → ${picked}`);
  } else {
    console.log(`Recommend (Stats): ${picked}`);
  }
}


// Liga o botão
const $rec = document.getElementById("recommendBtn");
if ($rec) $rec.addEventListener("click", recommendFill);


</script>

</body>
</html>
